var u=class{constructor(t){if(!t)throw TypeError("options argument is required");if(!t.sampleRate)throw TypeError("options.sampleRate is required");if(t.sampleRate<3e3||t.sampleRate>768e3)throw TypeError("options.sampleRate must be within 3000..768000");if(!t.length)throw TypeError("options.length must be more than 0");this.sampleRate=t.sampleRate,this.numberOfChannels=t.numberOfChannels||1,this.length=t.length|0,this.duration=this.length/this.sampleRate,this._data=new Float32Array(this.length*this.numberOfChannels),this._channelData=[];for(let n=0;n<this.numberOfChannels;n++)this._channelData.push(this._data.subarray(n*this.length,(n+1)*this.length))}getChannelData(t){if(t>=this.numberOfChannels||t<0||t==null)throw Error("Cannot getChannelData: channel number ("+t+") exceeds number of channels ("+this.numberOfChannels+")");return this._channelData[t]}copyFromChannel(t,n,r){r==null&&(r=0);for(var h=this._channelData[n],a=r,l=0;a<this.length&&l<t.length;a++,l++)t[l]=h[a]}copyToChannel(t,n,r){var h=this._channelData[n];r||(r=0);for(var a=r,l=0;a<this.length&&l<t.length;a++,l++)h[a]=t[l]}};function x(e){if(e){if(e=new Uint8Array(e.buffer||e),v(e))return"wav";if(E(e))return"mp3";if(M(e))return"flac";if(_(e))return"m4a";if(B(e))return"opus";if(T(e))return"oga";if(F(e))return"qoa"}}function E(e){if(!(!e||e.length<3))return e[0]===73&&e[1]===68&&e[2]===51||e[0]===255&&(e[1]&224)===224||e[0]===84&&e[1]===65&&e[2]===71}function v(e){if(!(!e||e.length<12))return e[0]===82&&e[1]===73&&e[2]===70&&e[3]===70&&e[8]===87&&e[9]===65&&e[10]===86&&e[11]===69}function T(e){if(!(!e||e.length<4))return e[0]===79&&e[1]===103&&e[2]===103&&e[3]===83}function M(e){if(!(!e||e.length<4))return e[0]===102&&e[1]===76&&e[2]===97&&e[3]===67}function _(e){if(!(!e||e.length<8))return e[4]===102&&e[5]===116&&e[6]===121&&e[7]===112||e[0]===77&&e[1]===52&&e[2]===65&&e[3]===32}function B(e){if(!(!e||e.length<36))return e[0]===79&&e[1]===103&&e[2]===103&&e[3]===83&&e[28]===79&&e[29]===112&&e[30]===117&&e[31]===115&&e[32]===72&&e[33]===101&&e[34]===97&&e[35]===100}function F(e){if(e)return e[0]===113&&e[1]===111&&e[2]===97&&e[3]===102}var L=globalThis.AudioBuffer||u;async function O(e){if(!e)throw Error("No decode target");e=new Uint8Array(e.buffer||e);let t=x(e);if(!t)throw Error("Cannot detect audio format");if(!p[t])throw Error("Missing decoder for "+t+" format");return p[t](e)}var p={async oga(e){let{OggVorbisDecoder:t}=await import("./ogg-vorbis-I4RMTXRD.js"),n=new t;return await n.ready,(p.oga=async r=>r&&w(await n.decodeFile(r)))(e)},async mp3(e){let{MPEGDecoder:t}=await import("./mpg123-decoder-UBRSS5IY.js"),n=new t;return await n.ready,(p.mp3=r=>r&&w(n.decode(r)))(e)},async flac(e){let{FLACDecoder:t}=await import("./flac-ZGCWAMZE.js"),n=new t;return await n.ready,(p.mp3=async r=>r&&w(await n.decode(r)))(e)},async opus(e){let{OggOpusDecoder:t}=await import("./ogg-opus-decoder-GNKUO3CE.js"),n=new t;return await n.ready,(p.opus=async r=>r&&w(await n.decodeFile(r)))(e)},async wav(e){let t=await import("./node-wav-6T5M4VPY.js"),{decode:n}=t.default;return(p.wav=r=>r&&w(n(r)))(e)},async qoa(e){let{decode:t}=await import("./qoa-format-5YQ5ZETV.js");return(p.qoa=n=>n&&w(t(n)))(e)}};function w({channelData:e,sampleRate:t}){let n=new L({sampleRate:t,length:e[0].length,numberOfChannels:e.length});for(let r=0;r<e.length;r++)n.getChannelData(r).set(e[r]);return n}async function Z(e){console.time("fetch");let t=await fetch(e,{cache:"force-cache"});if(console.timeEnd("fetch"),!t.ok)throw new Error(`HTTP error: status=${t.status}`);let n=await t.arrayBuffer();return O(n)}async function H(...e){console.time("wav encode");let t=e[0]?.sampleRate||44100,n=32,r=e[0]?.numberOfChannels||1,h=0;for(let o of e)h+=o.length;let a=new ArrayBuffer(44+h*r*(n>>3)),l=new DataView(a),c=0,y=o=>l.setUint8(c++,o),s=o=>(l.setUint16(c,o,!0),c+=2),d=o=>(l.setUint32(c,o,!0),c+=4),g=o=>{for(var i=0;i<o.length;++i)y(o.charCodeAt(i))};g("RIFF"),d(a.byteLength-8),g("WAVE"),g("fmt "),d(16),s(3),s(r),d(t),d(t*r*(n>>3)),s(r*(n>>3)),s(n),g("data"),d(a.byteLength-44);let C=new Float32Array(a,c);for(let o of e){let i=o.numberOfChannels,A=Array(i),D=o.length;for(let m=0;m<i;++m)A[m]=o.getChannelData(m);for(let m=0;m<D;++m)for(let f=0;f<i;++f)C[c++]=A[f][m]}return console.timeEnd("wav encode"),a}function Q(e){if(!e)return"";if(e._wf)return e._wf;let t=e.getChannelData(0),n="",r=2,h=128;for(let a=0,l=1024;a<t.length;){let c=0,y=0,s,d,g,C,o=-1,i=1;for(;a<l;a++)s=a>=t.length?0:t[a],y+=s,o=Math.max(o,s),i=Math.min(i,s);g=Math.min(h,Math.ceil(h*(o-i)/2))||0,C=Math.round(h*(o+i)/2),n+=String.fromCharCode(256+g),n+=(C>0?"\u0301":"\u0300").repeat(Math.abs(C)),l+=1024}return e._wf=n,n}var $=e=>new Promise((t,n)=>{let r=new FileReader;r.addEventListener("loadend",h=>{t(h.target.result)}),r.addEventListener("error",n),r.readAsArrayBuffer(e)});export{u as a,O as b,Z as c,H as d,Q as e,$ as f};
//# sourceMappingURL=chunk-ZZPGCUWV.js.map
