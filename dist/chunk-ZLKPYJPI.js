var u=class{constructor(t){if(!t)throw TypeError("options argument is required");if(!t.sampleRate)throw TypeError("options.sampleRate is required");if(t.sampleRate<3e3||t.sampleRate>768e3)throw TypeError("options.sampleRate must be within 3000..768000");if(!t.length)throw TypeError("options.length must be more than 0");this.sampleRate=t.sampleRate,this.numberOfChannels=t.numberOfChannels||1,this.length=t.length|0,this.duration=this.length/this.sampleRate,this._data=new Float32Array(this.length*this.numberOfChannels),this._channelData=[];for(let n=0;n<this.numberOfChannels;n++)this._channelData.push(this._data.subarray(n*this.length,(n+1)*this.length))}getChannelData(t){if(t>=this.numberOfChannels||t<0||t==null)throw Error("Cannot getChannelData: channel number ("+t+") exceeds number of channels ("+this.numberOfChannels+")");return this._channelData[t]}copyFromChannel(t,n,r){r==null&&(r=0);for(var s=this._channelData[n],o=r,l=0;o<this.length&&l<t.length;o++,l++)t[l]=s[o]}copyToChannel(t,n,r){var s=this._channelData[n];r||(r=0);for(var o=r,l=0;o<this.length&&l<t.length;o++,l++)s[o]=t[l]}};function A(e){if(e){if(e=new Uint8Array(e.buffer||e),v(e))return"wav";if(E(e))return"mp3";if(M(e))return"flac";if(_(e))return"m4a";if(B(e))return"opus";if(T(e))return"oga";if(F(e))return"qoa"}}function E(e){if(!(!e||e.length<3))return e[0]===73&&e[1]===68&&e[2]===51||e[0]===255&&(e[1]&224)===224||e[0]===84&&e[1]===65&&e[2]===71}function v(e){if(!(!e||e.length<12))return e[0]===82&&e[1]===73&&e[2]===70&&e[3]===70&&e[8]===87&&e[9]===65&&e[10]===86&&e[11]===69}function T(e){if(!(!e||e.length<4))return e[0]===79&&e[1]===103&&e[2]===103&&e[3]===83}function M(e){if(!(!e||e.length<4))return e[0]===102&&e[1]===76&&e[2]===97&&e[3]===67}function _(e){if(!(!e||e.length<8))return e[4]===102&&e[5]===116&&e[6]===121&&e[7]===112||e[0]===77&&e[1]===52&&e[2]===65&&e[3]===32}function B(e){if(!(!e||e.length<36))return e[0]===79&&e[1]===103&&e[2]===103&&e[3]===83&&e[28]===79&&e[29]===112&&e[30]===117&&e[31]===115&&e[32]===72&&e[33]===101&&e[34]===97&&e[35]===100}function F(e){if(e)return e[0]===113&&e[1]===111&&e[2]===97&&e[3]===102}var L=globalThis.AudioBuffer||u;async function R(e){if(!e)throw Error("No decode target");e=new Uint8Array(e.buffer||e);let t=A(e);if(!t)throw Error("Cannot detect audio format");if(!g[t])throw Error("Missing decoder for "+t+" format");return g[t](e)}var g={async oga(e){let{OggVorbisDecoder:t}=await import("./ogg-vorbis-I4RMTXRD.js"),n=new t;return await n.ready,(g.oga=async r=>r&&w(await n.decodeFile(r)))(e)},async mp3(e){let{MPEGDecoder:t}=await import("./mpg123-decoder-UBRSS5IY.js"),n=new t;return await n.ready,(g.mp3=r=>r&&w(n.decode(r)))(e)},async flac(e){let{FLACDecoder:t}=await import("./flac-ZGCWAMZE.js"),n=new t;return await n.ready,(g.mp3=async r=>r&&w(await n.decode(r)))(e)},async opus(e){let{OggOpusDecoder:t}=await import("./ogg-opus-decoder-GNKUO3CE.js"),n=new t;return await n.ready,(g.opus=async r=>r&&w(await n.decodeFile(r)))(e)},async wav(e){let t=await import("./node-wav-6T5M4VPY.js"),{decode:n}=t.default;return(g.wav=r=>r&&w(n(r)))(e)},async qoa(e){let{decode:t}=await import("./qoa-format-5YQ5ZETV.js");return(g.qoa=n=>n&&w(t(n)))(e)}};function w({channelData:e,sampleRate:t}){let n=new L({sampleRate:t,length:e[0].length,numberOfChannels:e.length});for(let r=0;r<e.length;r++)n.getChannelData(r).set(e[r]);return n}async function Z(e){console.time("fetch");let t=await fetch(e,{cache:"force-cache"});if(console.timeEnd("fetch"),!t.ok)throw new Error(`HTTP error: status=${t.status}`);let n=await t.arrayBuffer();return R(n)}async function H(...e){console.time("wav encode");let t=e[0]?.sampleRate||44100,n=32,r=e[0]?.numberOfChannels||1,s=0;for(let a of e)s+=a.length;let o=new ArrayBuffer(44+s*r*(n>>3)),l=new DataView(o),h=0,y=a=>l.setUint8(h++,a),d=a=>(l.setUint16(h,a,!0),h+=2),c=a=>(l.setUint32(h,a,!0),h+=4),m=a=>{for(var i=0;i<a.length;++i)y(a.charCodeAt(i))};m("RIFF"),c(o.byteLength-8),m("WAVE"),m("fmt "),c(16),d(3),d(r),c(t),c(t*r*(n>>3)),d(r*(n>>3)),d(n),m("data"),c(o.byteLength-44);let C=new Float32Array(o,h);for(let a of e){let i=a.numberOfChannels,f=Array(i),D=a.length;for(let p=0;p<i;++p)f[p]=a.getChannelData(p);for(let p=0;p<D;++p)for(let O=0;O<i;++O)C[h++]=f[O][p]}return console.timeEnd("wav encode"),o}function Q(e){if(!e)return"";if(e._wf)return e._wf;let t=e.getChannelData(0),n="",r=2,s=128,o=-1,l=1;for(let h=0,y=1024;h<t.length;){let d=0,c=0,m,C,a;for(;h<y;h++)m=h>=t.length?0:t[h],c+=m,d+=m**2;C=c/1024;let i=Math.sqrt(d/1024);a=Math.min(100,Math.ceil(i*s*r/(l-o)))||0,n+=String.fromCharCode(256+a);let f=Math.abs(Math.round(C*s/2));n+=(C>0?"\u0301":"\u0300").repeat(f),y+=1024}return e._wf=n,n}var $=e=>new Promise((t,n)=>{let r=new FileReader;r.addEventListener("loadend",s=>{t(s.target.result)}),r.addEventListener("error",n),r.readAsArrayBuffer(e)});export{u as a,R as b,Z as c,H as d,Q as e,$ as f};
//# sourceMappingURL=chunk-ZLKPYJPI.js.map
