var M=Object.create;var f=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var H=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var l=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var O=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of G(t))!I.call(e,n)&&n!==r&&f(e,n,{get:()=>t[n],enumerable:!(o=V(t,n))||o.enumerable});return e};var W=(e,t,r)=>(r=e!=null?M(H(e)):{},O(t||!e||!e.__esModule?f(r,"default",{value:e,enumerable:!0}):r,e));var x=l((Q,v)=>{"use strict";v.exports=function(e){return!e||e.length<3?!1:e[0]===73&&e[1]===68&&e[2]===51||e[0]===255&&(e[1]===251||e[1]===250)}});var E=l((S,D)=>{"use strict";D.exports=function(e){return!e||e.length<12?!1:e[0]===82&&e[1]===73&&e[2]===70&&e[3]===70&&e[8]===87&&e[9]===65&&e[10]===86&&e[11]===69}});var A=l((X,U)=>{"use strict";U.exports=function(e){return!e||e.length<4?!1:e[0]===79&&e[1]===103&&e[2]===103&&e[3]===83}});var B=l((Y,y)=>{"use strict";y.exports=function(e){return!e||e.length<4?!1:e[0]===102&&e[1]===76&&e[2]===97&&e[3]===67}});var C=l((Z,q)=>{"use strict";q.exports=function(e){return!e||e.length<8?!1:e[4]===102&&e[5]===116&&e[6]===121&&e[7]===112||e[0]===77&&e[1]===52&&e[2]===65&&e[3]===32}});var _=l((b,L)=>{"use strict";L.exports=function(e){return e?x()(e)?"mp3":E()(e)?"wav":A()(e)?"oga":B()(e)?"flac":C()(e)?"m4a":!1:!1}});var F=W(_()),p={},$=async e=>{let t=new Uint8Array(e),r=(0,F.default)(t),o=await z(r);console.time("decode");let n=await o(e);return console.timeEnd("decode"),n},z=async e=>{if(p[e])return p[e];console.time("load decoder "+e);let t;if(e==="mp3"){let{MPEGDecoder:r}=await j("mp3"),o=new r;await o.ready,t=n=>o.decode(n)}else e==="oga"&&(t=(await j("ogg")).default);if(console.timeEnd("load decoder "+e),!t)throw Error(e?"Unsupported codec "+e:"Unknown codec");return p[e]=t},j=e=>import("./decoder/"+e+".js"),P=$;async function J(e){console.time("fetch "+e);let t=await fetch(e);if(!t.ok)throw new Error(`HTTP error: status=${t.status}`);let r=await t.arrayBuffer();console.timeEnd("fetch "+e);let{channelData:o,sampleRate:n}=await P(r),c=await K(n,o),s=new Blob([c],{type:"audio/wav"}),i=URL.createObjectURL(s);self.postMessage(i)}J("https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg");self.onmessage=e=>{};async function K(e,...t){console.time("wav encode");let r=32,o=t[0].length,n=0;for(let a of t)n+=a[0].length;let c=new ArrayBuffer(44+n*o*(r>>3)),s=new DataView(c),i=0,R=a=>s.setUint8(i++,a),h=a=>(s.setUint16(i,a,!0),i+=2),d=a=>(s.setUint32(i,a,!0),i+=4),w=a=>{for(var g=0;g<a.length;++g)R(a.charCodeAt(g))};w("RIFF"),d(c.byteLength-8),w("WAVE"),w("fmt "),d(16),h(3),h(o),d(e),d(e*o*(r>>3)),h(o*(r>>3)),h(r),w("data"),d(c.byteLength-44);let T=new Float32Array(c,i);for(let a of t){let g=a.length,k=a[0].length;for(let m=0;m<k;++m)for(let u=0;u<g;++u)T[i++]=a[u][m]}return console.timeEnd("wav encode"),c}export{K as encodeAudio};
//# sourceMappingURL=worker.js.map
