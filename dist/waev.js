import{b as ct}from"./chunk-YFDESRXI.js";function re(){throw new Error("Cycle detected")}function ne(){if(E>1)E--;else{for(var e,t=!1;Y!==void 0;){var r=Y;for(Y=void 0,ve++;r!==void 0;){var n=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Me(r))try{r.c()}catch(o){t||(e=o,t=!0)}r=n}}if(ve=0,E--,t)throw e}}function je(e){if(E>0)return e();E++;try{return e()}finally{ne()}}var v=void 0,Y=void 0,E=0,ve=0,te=0;function Ee(e){if(v!==void 0){var t=e.n;if(t===void 0||t.t!==v)return t={i:0,S:e,p:v.s,n:void 0,t:v,e:void 0,x:void 0,r:t},v.s!==void 0&&(v.s.n=t),v.s=t,e.n=t,32&v.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=v.s,t.n=void 0,v.s.n=t,v.s=t),t}}function A(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}A.prototype.h=function(){return!0};A.prototype.S=function(e){this.t!==e&&e.e===void 0&&(e.x=this.t,this.t!==void 0&&(this.t.e=e),this.t=e)};A.prototype.U=function(e){if(this.t!==void 0){var t=e.e,r=e.x;t!==void 0&&(t.x=r,e.e=void 0),r!==void 0&&(r.e=t,e.x=void 0),e===this.t&&(this.t=r)}};A.prototype.subscribe=function(e){var t=this;return ye(function(){var r=t.value,n=32&this.f;this.f&=-33;try{e(r)}finally{this.f|=n}})};A.prototype.valueOf=function(){return this.value};A.prototype.toString=function(){return this.value+""};A.prototype.peek=function(){return this.v};Object.defineProperty(A.prototype,"value",{get:function(){var e=Ee(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){ve>100&&re(),this.v=e,this.i++,te++,E++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{ne()}}}});function Pe(e){return new A(e)}function Me(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function Re(e){for(var t=e.s;t!==void 0;t=t.n){var r=t.S.n;if(r!==void 0&&(t.r=r),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Te(e){for(var t=e.s,r=void 0;t!==void 0;){var n=t.p;t.i===-1?(t.S.U(t),n!==void 0&&(n.n=t.n),t.n!==void 0&&(t.n.p=n)):r=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=n}e.s=r}function _(e){A.call(this,void 0),this.x=e,this.s=void 0,this.g=te-1,this.f=4}(_.prototype=new A).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===te))return!0;if(this.g=te,this.f|=1,this.i>0&&!Me(this))return this.f&=-2,!0;var e=v;try{Re(this),v=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return v=e,Te(this),this.f&=-2,!0};_.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}A.prototype.S.call(this,e)};_.prototype.U=function(e){if(this.t!==void 0&&(A.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};_.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};_.prototype.peek=function(){if(this.h()||re(),16&this.f)throw this.v;return this.v};Object.defineProperty(_.prototype,"value",{get:function(){1&this.f&&re();var e=Ee(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function _e(e){return new _(e)}function Le(e){var t=e.u;if(e.u=void 0,typeof t=="function"){E++;var r=v;v=void 0;try{t()}catch(n){throw e.f&=-2,e.f|=8,me(e),n}finally{v=r,ne()}}}function me(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,Le(e)}function ht(e){if(v!==this)throw new Error("Out-of-order effect");Te(this),v=e,this.f&=-2,8&this.f&&me(this),ne()}function X(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}X.prototype.c=function(){var e=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{e()}};X.prototype.S=function(){1&this.f&&re(),this.f|=1,this.f&=-9,Le(this),Re(this),E++;var e=v;return v=this,ht.bind(this,e)};X.prototype.N=function(){2&this.f||(this.f|=2,this.o=Y,Y=this)};X.prototype.d=function(){this.f|=8,1&this.f||me(this)};function ye(e){var t=new X(e);try{t.c()}catch(r){throw t.d(),r}return t.d.bind(t)}Symbol.observable||=Symbol("observable");var Ie=e=>e&&!!(e[Symbol.observable]||e[Symbol.asyncIterator]||e.call&&e.set||e.subscribe||e.then),dt=new FinalizationRegistry(e=>e.call?.()),pt=e=>e&&(()=>e.unsubscribe?.()),We=(e,t,r,n,o,i)=>e&&(i=pt((e[Symbol.observable]?.()||e).subscribe?.(t,r,n))||e.set&&e.call?.(o,t)||(e.then?.(a=>(!o&&t(a),n?.()),r)||(async a=>{try{for await(a of e){if(o)return;t(a)}n?.()}catch(s){r?.(s)}})())&&(a=>o=1),dt.register(e,i),i);var vt=e=>e&&e.peek,ge=e=>e&&e[Ue],Ue=Symbol("signal-struct");S.isStruct=ge;function S(e,t){if(ge(e)&&!t)return e;if(oe(e)){let r=Object.create(t||Object.getPrototypeOf(e)),n={},o=Object.getOwnPropertyDescriptors(e);for(let i in o){let a=o[i];if(a.get){let s=n[i]=_e(a.get.bind(r));Object.defineProperty(r,i,{get(){return s.value},set:a.set?.bind(r),configurable:!1,enumerable:!0})}else{let s=a.value,u=Ie(s),l=n[i]=vt(s)?s:Pe(u?void 0:oe(s)?Object.seal(S(s)):Array.isArray(s)?S(s):s);u&&We(s,c=>l.value=c),Object.defineProperty(r,i,{get(){return l.value},set(c){if(oe(c)){if(oe(l.value))try{Object.assign(l.value,c);return}catch{}l.value=Object.seal(S(c))}else Array.isArray(c)?l.value=S(c):l.value=c},enumerable:!0,configurable:!1})}}return Object.defineProperty(r,Ue,{configurable:!1,enumerable:!1,value:!0}),r}if(Array.isArray(e)&&!ge(e[0]))for(let r=0;r<e.length;r++)e[r]=S(e[r]);return e}function oe(e){return e&&e.constructor===Object}function Fe(e,t,r,n){let o=new Map,i=new Map,a,s;for(a=0;a<t.length;a++)o.set(t[a],a);for(a=0;a<r.length;a++)i.set(r[a],a);for(a=s=0;a!==t.length||s!==r.length;){var u=t[a],l=r[s];if(u===null)a++;else if(r.length<=s)e.removeChild(t[a]),a++;else if(t.length<=a)e.insertBefore(l,t[a]||n),s++;else if(u===l)a++,s++;else{var c=i.get(u),f=o.get(l);c===void 0?(e.removeChild(t[a]),a++):f===void 0?(e.insertBefore(l,t[a]||n),s++):(e.insertBefore(t[f],t[a]||n),t[f]=null,f>a+1&&a++,s++)}}return r}var F={},mt={},yt={},$e=e=>e===null?mt:e===void 0?yt:typeof e=="number"||e instanceof Number?F[e]||(F[e]=new Number(e)):typeof e=="string"||e instanceof String?F[e]||(F[e]=new String(e)):typeof e=="boolean"||e instanceof Boolean?F[e]||(F[e]=new Boolean(e)):e;var $={},O={};$.if=(e,t)=>{let r=document.createTextNode(""),n=[w(e,t,":if")],o=[e],i=e;for(;(i=e.nextElementSibling)&&i.hasAttribute(":else");)i.removeAttribute(":else"),(t=i.getAttribute(":if"))?(i.removeAttribute(":if"),i.remove(),o.push(i),n.push(w(e,t,":else :if"))):(i.remove(),o.push(i),n.push(()=>1));return e.replaceWith(i=r),a=>{let s=n.findIndex(u=>u(a));o[s]!=i&&((i[Ze]||i).replaceWith(i=o[s]||r),L(i,a))}};$.with=(e,t,r)=>{let n=w(e,t,"with");L(e,S(n(r),r))};var Ze=Symbol(":each");$.each=(e,t)=>{let r=gt(t);if(!r)return ie(new Error,e,t);let n=e[Ze]=document.createTextNode("");e.replaceWith(n);let o=w(e,r[2],":each"),i=e.getAttribute(":key"),a=i?w(null,i):null;e.removeAttribute(":key");let s=new WeakMap,u=new WeakMap,l=[];return c=>{let f=o(c);f?typeof f=="number"?f=Array.from({length:f},(d,b)=>[b,b+1]):Array.isArray(f)?f=f.map((d,b)=>[b+1,d]):typeof f=="object"?f=Object.entries(f):ie(Error("Bad list value"),e,t,":each",f):f=[];let p=[],h=[];for(let[d,b]of f){let k,y,m=a?.({[r[0]]:b,[r[1]]:d});At(m)&&(m=$e(m)),m==null?k=e.cloneNode(!0):(k=u.get(m))||u.set(m,k=e.cloneNode(!0)),p.push(k),m==null||!(y=s.get(m))?(y=S({[r[0]]:b,[r[1]]:d},c),m!=null&&s.set(m,y)):y[r[0]]=b,h.push(y)}Fe(n.parentNode,l,p,n),l=p;for(let d=0;d<p.length;d++)L(p[d],h[d])}};function gt(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,n=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,o=e.match(n);if(!o)return;let i=o[2].trim(),a=o[1].replace(r,"").trim(),s=a.match(t);return s?[a.replace(t,"").trim(),s[1].trim(),i]:[a,"",i]}O.ref=(e,t,r)=>{r[t]=e};O.id=(e,t)=>{let r=w(e,t,":id"),n=o=>e.id=o||o===0?o:"";return o=>n(r(o))};O.class=(e,t)=>{let r=w(e,t,":class"),n=e.className;return o=>{let i=r(o);e.className=n+typeof i=="string"?i:(Array.isArray(i)?i:Object.entries(i).map(([a,s])=>s?a:"")).filter(Boolean).join(" ")}};O.style=(e,t)=>{let r=w(e,t,":style"),n=e.getAttribute("style")||"";return n.endsWith(";")||(n+="; "),o=>{let i=r(o);if(typeof i=="string")e.setAttribute("style",n+i);else for(let a in i)e.style[a]=i[a]}};O.text=(e,t)=>{let r=w(e,t,":text");return n=>{let o=r(n);e.textContent=o??""}};O.data=(e,t)=>{let r=w(e,t,":data");return n=>{let o=r(n);for(let i in o)e.dataset[i]=o[i]}};O.aria=(e,t)=>{let r=w(e,t,":aria"),n=o=>{for(let i in o)ae(e,"aria-"+He(i),o[i]==null?null:o[i]+"")};return o=>n(r(o))};O[""]=(e,t)=>{let r=w(e,t,":");if(r)return n=>{let o=r(n);for(let i in o)ae(e,He(i),o[i])}};O.value=(e,t)=>{let r=w(e,t,":value"),n,o,i=e.type==="text"||e.type===""?a=>e.setAttribute("value",e.value=a??""):e.tagName==="TEXTAREA"||e.type==="text"||e.type===""?a=>(n=e.selectionStart,o=e.selectionEnd,e.setAttribute("value",e.value=a??""),n&&e.setSelectionRange(n,o)):e.type==="checkbox"?a=>(e.value=a?"on":"",ae(e,"checked",a)):e.type==="select-one"?a=>{for(let s in e.options)s.removeAttribute("selected");e.value=a,e.selectedOptions[0]?.setAttribute("selected","")}:a=>e.value=a;return a=>i(r(a))};O.on=(e,t)=>{let r=w(e,t,":on");return n=>{let o=r(n),i=[];for(let a in o)i.push(ze(e,a,o[a]));return()=>{for(let a of i)a()}}};var Ve=(e,t,r,n)=>{let o=n.startsWith("on")&&n.slice(2),i=w(e,t,":"+n);if(i)return o?a=>{let s=i(a)||(()=>{});return ze(e,o,s)}:a=>ae(e,n,i(a))},ze=(e,t,r)=>{let n=t.split("..").map(a=>{let s={evt:"",target:e,test:()=>!0};return s.evt=(a.startsWith("on")?a.slice(2):a).replace(/\.(\w+)?-?([\w]+)?/g,(u,l,c)=>(s.test=bt[l]?.(s,c)||s.test,"")),s});if(r||(r=()=>{}),n.length==1)return Ke(r,n[0]);let o,i=(a,s=0)=>o=Ke(l=>{o(),typeof(a=a.call(e,l))!="function"&&(a=()=>{}),++s<n.length?i(a,s):i(r)},n[s]);return i(r),()=>o()},Ke=(e,{evt:t,target:r,test:n,delayed:o,stop:i,prevent:a,...s})=>{o&&(e=o(e));let u=l=>n(l)&&(i&&l.stopPropagation(),a&&l.preventDefault(),e.call(r,l));return r.addEventListener(t,u,s),()=>r.removeEventListener(t,u,s)},bt={prevent(e){e.prevent=!0},stop(e){e.stop=!0},once(e){e.once=!0},passive(e){e.passive=!0},capture(e){e.capture=!0},window(e){e.target=window},document(e){e.target=document},throttle(e,t){e.delayed=r=>wt(r,Number(t)||108)},debounce(e,t){e.delayed=r=>xt(r,Number(t)||108)},outside:e=>t=>{let r=e.target;return!(r.contains(t.target)||t.target.isConnected===!1||r.offsetWidth<1&&r.offsetHeight<1)},self:e=>t=>t.target===e.target,ctrl:e=>t=>t.key==="Control"||t.key==="Ctrl",shift:e=>t=>t.key==="Shift",alt:e=>t=>t.key==="Alt",meta:e=>t=>t.key==="Meta",arrow:e=>t=>t.key.startsWith("Arrow"),enter:e=>t=>t.key==="Enter",escape:e=>t=>t.key.startsWith("Esc"),tab:e=>t=>t.key==="Tab",space:e=>t=>t.key==="Space"||t.key===" ",backspace:e=>t=>t.key==="Backspace",delete:e=>t=>t.key==="Delete",digit:e=>t=>/^\d$/.test(t.key),letter:e=>t=>/^[a-zA-Z]$/.test(t.key),character:e=>t=>/^\S$/.test(t.key)},wt=(e,t)=>{let r,n,o=i=>{r=!0,setTimeout(()=>{if(r=!1,n)return n=!1,o(i),e(i)},t)};return i=>r?n=!0:(o(i),e(i))},xt=(e,t)=>{let r;return n=>{clearTimeout(r),r=setTimeout(()=>{r=null,e(n)},t)}},ae=(e,t,r)=>{r==null||r===!1?e.removeAttribute(t):e.setAttribute(t,r===!0?"":typeof r=="number"||typeof r=="string"?r:"")},qe={};function w(e,t,r){let n=qe[t];if(!n){let o=/^[\n\s]*if.*\(.*\)/.test(t)||/\b(let|const)\s/.test(t)?`(() => { ${t} })()`:t;try{n=qe[t]=new Function("__scope",`with (__scope) { return ${o} };`)}catch(i){return ie(i,e,t,r)}}return o=>{let i;try{i=n.call(e,o)}catch(a){return ie(a,e,t,r)}return i}}function ie(e,t,r,n){Object.assign(e,{element:t,expression:r}),console.warn(`\u2234 ${e.message}

${n}=${r?`"${r}"

`:""}`,t),setTimeout(()=>{throw e},0)}function He(e){return e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,t=>"-"+t.toLowerCase())}function At(e){return typeof e=="string"||typeof e=="boolean"||typeof e=="number"}var G=new WeakMap;function L(e,t){if(!e.children)return;if(G.has(e)){let i=G.get(e);return je(()=>Object.assign(i,t)),i}let r=S(t||{}),n=[],o=(i,a=i.parentNode)=>{for(let s in $){let u=":"+s;if(i.hasAttribute?.(u)){let l=i.getAttribute(u);if(i.removeAttribute(u),n.push($[s](i,l,r,s)),G.has(i)||i.parentNode!==a)return!1}}if(i.attributes)for(let s=0;s<i.attributes.length;){let u=i.attributes[s];if(u.name[0]!==":"){s++;continue}i.removeAttribute(u.name);let l=u.value,c=u.name.slice(1).split(":");for(let f of c){let p=O[f]||Ve;if(n.push(p(i,l,r,f)),G.has(i)||i.parentNode!==a)return!1}}for(let s=0,u;u=i.children[s];s++)o(u,i)===!1&&s--};o(e);for(let i of n)if(i){let a;ye(()=>{typeof a=="function"&&a(),a=i(r)})}return Object.seal(r),G.set(e,r),r}var Ye=L;var Qe=function(){function e(){}return e.prototype.then=function(t,r){let n=new e,o=this.s;if(o){let i=1&o?t:r;if(i){try{C(n,1,i(this.v))}catch(a){C(n,2,a)}return n}return this}return this.o=function(i){try{let a=i.v;1&i.s?C(n,1,t?t(a):a):r?C(n,1,r(a)):C(n,2,a)}catch(a){C(n,2,a)}},n},e}();function C(e,t,r){if(!e.s){if(r instanceof Qe){if(!r.s)return void(r.o=C.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(C.bind(null,e,t),C.bind(null,e,2));e.s=t,e.v=r;let n=e.o;n&&n(e)}}var Ct=0,q=typeof WeakMap=="function"?WeakMap:function(){var e=typeof Symbol=="function"?Symbol(0):"__weak$"+ ++Ct;this.set=function(t,r){t[e]=r},this.get=function(t){return t[e]}};function Ae(e,t){return new Promise(function(r,n){e.onsuccess=function(){var o=e.result;t&&(o=t(o)),r(o)},e.onerror=function(){n(e.error)}})}function et(e,t){return Ae(e.openCursor(t),function(r){return r?[r.key,r.value]:[]})}function Xe(e){return new Promise(function(t,r){e.oncomplete=function(){t()},e.onabort=function(){r(e.error)},e.onerror=function(){r(e.error)}})}function be(e){if(!function(t){return!!(typeof t=="number"||typeof t=="string"||typeof t=="object"&&t&&(Array.isArray(t)||"setUTCFullYear"in t||typeof ArrayBuffer=="function"&&ArrayBuffer.isView(t)||"byteLength"in t&&"length"in t))}(e))throw Error("kv-storage: The given value is not allowed as a key")}var tt={};function Ge(e,t){return et(e,rt(t))}function rt(e){return e===tt?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(e,!0)}var nt=new q,le=new q,ue=new q,ot=new q,se=function(){};function Je(e,t){return t(function(r,n){try{let l=function(){return le.set(e,i),ue.set(e,void 0),{value:s,done:i===void 0}};var o=le.get(e);if(o===void 0)return Promise.resolve({value:void 0,done:!0});var i,a,s,u=function(c,f){var p,h=-1;e:{for(var d=0;d<f.length;d++){var b=f[d][0];if(b){var k=b();if(k&&k.then)break e;if(k===c){h=d;break}}else h=d}if(h!==-1){do{for(var y=f[h][1];!y;)y=f[++h][1];var m=y();if(m&&m.then){p=!0;break e}var De=f[h][2];h++}while(De&&!De());return m}}let z=new Qe,ee=C.bind(null,z,2);return(p?m.then(pe):k.then(function U(R){for(;;){if(R===c){h=d;break}if(++d===f.length){if(h!==-1)break;return void C(z,1,H)}if(b=f[d][0]){if((R=b())&&R.then)return void R.then(U).then(void 0,ee)}else h=d}do{for(var T=f[h][1];!T;)T=f[++h][1];var H=T();if(H&&H.then)return void H.then(pe).then(void 0,ee);var Be=f[h][2];h++}while(Be&&!Be());C(z,1,H)})).then(void 0,ee),z;function pe(U){for(;;){var R=f[h][2];if(!R||R())break;for(var T=f[++h][1];!T;)T=f[++h][1];if((U=T())&&U.then)return void U.then(pe).then(void 0,ee)}C(z,1,U)}}(ot.get(e),[[function(){return"keys"},function(){return Promise.resolve(function(c,f){return et(c,rt(f)).then(function(p){return p[0]})}(n,o)).then(function(c){s=i=c})}],[function(){return"values"},function(){return Promise.resolve(Ge(n,o)).then(function(c){var f;i=(f=c)[0],s=a=f[1]})}],[function(){return"entries"},function(){return Promise.resolve(Ge(n,o)).then(function(c){var f;a=(f=c)[1],s=(i=f[0])===void 0?void 0:[i,a]})}]]);return Promise.resolve(u&&u.then?u.then(l):l())}catch(l){return Promise.reject(l)}})}function we(e,t){var r=new se;return ot.set(r,e),nt.set(r,t),le.set(r,tt),ue.set(r,void 0),r}se.prototype.return=function(){le.set(this,void 0)},se.prototype.next=function(){var e=this,t=nt.get(this);if(!t)return Promise.reject(new TypeError("Invalid this value"));var r,n=ue.get(this);return r=n!==void 0?n.then(function(){return Je(e,t)}):Je(this,t),ue.set(this,r),r},typeof Symbol=="function"&&Symbol.asyncIterator&&(se.prototype[Symbol.asyncIterator]=function(){return this});var K=function(e,t,r){try{return P.get(e)===null&&function(n){var o=Ce.get(n);P.set(n,new Promise(function(i,a){var s=self.indexedDB.open(o,1);s.onsuccess=function(){var u=s.result;(function(l,c,f){if(l.objectStoreNames.length!==1||l.objectStoreNames[0]!==I)return f(xe(c)),!1;var p=l.transaction(I,"readonly").objectStore(I);return!(p.autoIncrement||p.keyPath||p.indexNames.length)||(f(xe(c)),!1)})(u,o,a)&&(u.onclose=function(){P.set(n,null)},u.onversionchange=function(){u.close(),P.set(n,null)},i(u))},s.onerror=function(){return a(s.error)},s.onupgradeneeded=function(){try{s.result.createObjectStore(I)}catch(u){a(u)}}}))}(e),Promise.resolve(P.get(e)).then(function(n){var o=n.transaction(I,t),i=o.objectStore(I);return r(o,i)})}catch(n){return Promise.reject(n)}},Ce=new q,P=new q,I="store",D=function(e){var t="kv-storage:"+e;P.set(this,null),Ce.set(this,t),this.backingStore={database:t,store:I,version:1}};function xe(e){return new Error('kv-storage: database "'+e+'" corrupted')}D.prototype.set=function(e,t){try{return be(e),K(this,"readwrite",function(r,n){return t===void 0?n.delete(e):n.put(t,e),Xe(r)})}catch(r){return Promise.reject(r)}},D.prototype.get=function(e){try{return be(e),K(this,"readonly",function(t,r){return Ae(r.get(e))})}catch(t){return Promise.reject(t)}},D.prototype.delete=function(e){try{return be(e),K(this,"readwrite",function(t,r){return r.delete(e),Xe(t)})}catch(t){return Promise.reject(t)}},D.prototype.clear=function(){try{let o=function(){function i(){return Ae(self.indexedDB.deleteDatabase(Ce.get(e)))}var a=function(){if(t){try{t.close()}catch{}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return a&&a.then?a.then(i):i()};var e=this,t,r=P.get(e),n=function(){if(r!==null){let a=function(){P.set(e,null)};var i=function(s,u){try{var l=Promise.resolve(r).then(function(c){t=c})}catch{return}return l&&l.then?l.then(void 0,function(){}):l}();return i&&i.then?i.then(a):a()}}();return n&&n.then?n.then(o):o()}catch(o){return Promise.reject(o)}},D.prototype.keys=function(){var e=this;return we("keys",function(t){return K(e,"readonly",t)})},D.prototype.values=function(){var e=this;return we("values",function(t){return K(e,"readonly",t)})},D.prototype.entries=function(){var e=this;return we("entries",function(t){return K(e,"readonly",t)})},typeof Symbol=="function"&&Symbol.asyncIterator&&(D.prototype[Symbol.asyncIterator]=D.prototype.entries);var St=new D("default");var W=44100,B=1024,J=e=>Math.floor(e*W/B),Se=e=>e*B/W,it=e=>Math.ceil(J(e)/B),Z=e=>e*B,Ot=await(async()=>{let e=new Audio,t=OfflineAudioContext;return e.canPlayType("audio/ogg")||(t=(await import("./oggmented-bundle-PZW5FHYZ.js")).default.OggmentedAudioContext),new t({sampleRate:W,length:60*60*44100})})();var at=e=>new Promise((t,r)=>{let n=new FileReader;n.addEventListener("loadend",o=>{t(o.target.result)}),n.addEventListener("error",r),n.readAsArrayBuffer(e)});async function st(e){console.time("fetch");let t=await fetch(e);if(!t.ok)throw new Error(`HTTP error: status=${t.status}`);let r=await t.arrayBuffer();return console.timeEnd("fetch"),r}async function ce(e,t){console.time("decode");let r;try{r=await Ot.decodeAudioData(e)}catch(n){console.log(n)}return console.timeEnd("decode"),r}async function Oe(...e){console.time("wav encode");let t=W,r=32,n=e[0].numberOfChannels,o=0;for(let h of e)o+=h.length;let i=new ArrayBuffer(44+o*n*(r>>3)),a=new DataView(i),s=0,u=h=>a.setUint8(s++,h),l=h=>(a.setUint16(s,h,!0),s+=2),c=h=>(a.setUint32(s,h,!0),s+=4),f=h=>{for(var d=0;d<h.length;++d)u(h.charCodeAt(d))};f("RIFF"),c(i.byteLength-8),f("WAVE"),f("fmt "),c(16),l(3),l(n),c(t),c(t*n*(r>>3)),l(n*(r>>3)),l(r),f("data"),c(i.byteLength-44);let p=new Float32Array(i,s);for(let h of e){let d=h.numberOfChannels,b=Array(d),k=h.length;for(let y=0;y<d;++y)b[y]=h.getChannelData(y);for(let y=0;y<k;++y)for(let m=0;m<d;++m)p[s++]=b[m][y]}return console.timeEnd("wav encode"),i}function lt(e){if(!e)return"";if(e._wf&&e._wf_first===e.getChannelData(0)[0])return e._wf;console.time("to waveform string");let t=e.getChannelData(0),r="",n=2;for(let o=0,i=B;o<t.length;){let a=0,s=0;for(;o<i;o++)a+=o>=t.length?0:t[o]**2;let u=Math.sqrt(a/B),l=Math.min(100,Math.ceil(u*100*n));r+=String.fromCharCode(256+l),i+=B}return e._wf=r,e._wf_first=e.getChannelData(0)[0],console.timeEnd("to waveform string"),r}function Ne(e,t=0,r=e.length){let n=new AudioBuffer({length:r-t,numberOfChannels:e.numberOfChannels,sampleRate:e.sampleRate});for(var o=0;o<n.numberOfChannels;o++)n.copyToChannel(e.getChannelData(o).subarray(t,r),o,0);return n}function fe(e,t){let r=new AudioBuffer({length:e.length+t.length,numberOfChannels:Math.max(e.numberOfChannels,t.numberOfChannels),sampleRate:e.sampleRate});for(let n=0;n<r.numberOfChannels;n++)r.copyToChannel(e.getChannelData(n),n,0),r.copyToChannel(t.getChannelData(n),n,e.length);return r}function ut(e,t,r){if(t>=e.length)return fe(e,r);if(!t)return fe(r,e);let n=new AudioBuffer({length:e.length+r.length,numberOfChannels:Math.max(e.numberOfChannels,r.numberOfChannels),sampleRate:e.sampleRate});for(let o=0;o<n.numberOfChannels;o++)n.copyToChannel(e.getChannelData(o).subarray(0,t),o,0),n.copyToChannel(r.getChannelData(o),o,t),n.copyToChannel(e.getChannelData(o).subarray(t),o,t+r.length);return n}var he={};ct(he,{add:()=>Mt,br:()=>Dt,clip:()=>Pt,cp:()=>Rt,del:()=>jt,join:()=>Bt,mute:()=>Et,norm:()=>kt,src:()=>Nt});var Nt=async(e,t)=>{let r=await st(t);return[await ce(r)]},kt=e=>{let t=0,r=0;for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);r+=u.length;for(let l=0;l<u.length;l++)t+=u[l]}let n=t/r;for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);r+=u.length;for(let l=0;l<u.length;l++)u[l]-=n}let o=0;for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);for(let l=0;l<u.length;l++)o=Math.max(Math.abs(u[l]),o)}let i=Math.max(1/o,1);for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);for(let l=0;l<u.length;l++)u[l]=Math.min(1,Math.max(-1,u[l]*i))}return e},Dt=(e,...t)=>{for(let r of t){let[n,o]=Q(e,Z(r)),i=e[n];if(o>0&&o<i.length){let a=Ne(i,0,o),s=Ne(i,o);e.splice(n,1,a,s)}}return e};function Bt(e,t){let[r,n]=Q(e,Z(t));if(n)return console.warn("Wrong buffer offset",t);let o=e[r-1],i=e[r];return e.splice(r-1,2,fe(o,i)),e}function jt(e,t,r){if(!r)return e;let n=Q(e,Z(t)),o=Q(e,Z(t+r));!o[1]&&o[0]&&(o[0]-=1,o[1]=e[o[0]].length);let i=e[n[0]],a=e[o[0]],s=new AudioBuffer({length:n[1]+(a.length-o[1]),sampleRate:W,numberOfChannels:i.numberOfChannels});for(let u=0;u<i.numberOfChannels;u++){let l=0,c=s.getChannelData(u),f=i.getChannelData(u),p=a.getChannelData(u);for(l=0;l<n[1];l++)c[l]=f[l];for(let h=o[1];h<p.length;h++)c[l]=p[h],l++}return e.splice(n[0],o[0]-n[0]+1,s),e}function Et(e,...t){for(let r of t){let[n,o]=r,[i,a]=Q(e,Z(n));!a&&i&&(i-=1,a=e[i].length);let s=new AudioBuffer({length:o*B,numberOfChannels:e?.[0].numberOfChannels||1,sampleRate:e?.[0].sampleRate||W});e[i]=ut(e[i],a,s)}return e}var Pt=(e,t,r)=>{},Mt=(e,t,r)=>{},Rt=(e,t,r,n)=>{},Q=(e,t)=>{if(t===0)return[0,0];var r=0,n;for(let o=0;o<e.length;o++){if(n=r+e[o].length,t<n)return[o,t-r];r=n}return[e.length-1,e[e.length-1].length]};var ke=document.querySelector(".waev"),j=ke.querySelector(".w-wavearea"),N=ke.querySelector(".w-playback"),de=[],Tt=new URL(location),M=[],g=Ye(ke,{loading:!1,recording:!1,playing:!1,selecting:!1,startFrame:0,volume:1,error:null,segments:[],lineWidth:216,isMouseDown:!1,handleCaret(e){N.currentTime=Se(g.startFrame=x().start)},updateTimecodes(){let e=0,t=0;for(let r of j.children){let n=r.textContent.trim(),o=Math.ceil(n.length/g.lineWidth);r.dataset.id=t++,r.setAttribute("timecodes",Array.from({length:o},(i,a)=>_t(a*g.lineWidth+e)).join(`
`)),e+=n.length}},cleanup(){for(let e of j.children)e.textContent.trim()||e.remove()},async handleEnter(e){let t=x();if(!t.startNode.dataset.id)throw Error("Segment id is not found, strange");(M.at(-1)[0]==="br"?M.pop():["br"]).push(t.start),setTimeout(async()=>{await V(["br",t.start]),x(t.start,t.start,1)},500)},async handleDelete(e){let t=x();if(!t.startNode.dataset.id)throw Error("Segment id is not found, strange");let n=t.end-t.start,o=t.start-(e.key==="Delete"?0:1);if(!(o<0&&!n))if(!t.startNodeOffset&&t.collapsed)await V(["join",t.start]),x(t.start);else{let i=n?["del",t.start,n]:["del",o,1];M.push(i),await V(i),x(o)}},async handleSpace(e){let t=x(),r=g.segments[t.startNode.dataset.id],n=t.startNode.textContent.length-r.length,o=t.start-n;(M.at(-1)[0]==="mute"?M.pop():["mute"]).push([o,n]),await V(["mute",[o,n]]),x(t.start)},async handleDrop(e){let r=e.dataTransfer.files[0];if(!r.type.startsWith("audio"))return!1;g.loading=!0,g.segments=[];let n=await at(r),o=await ce(n),i=await Oe(o),a=new Blob([i],{type:"audio/wav"}),s=URL.createObjectURL(a);return await V(["src",s]),g.loading=!1,n},timeChange(e){document.activeElement!==j&&(x(g.startFrame=J(N.currentTime)),j.focus())},play(e){g.playing=!0;let t=x();t||(t=x(0));let r=t.start,n=t.collapsed?J(N.duration):t.end,o,i=()=>{let a=Math.max(J(N.currentTime)-g.startFrame,0),s=g.startFrame+a;g.isMouseDown||x(s),n&&s>=n?N.pause():o=requestAnimationFrame(i)};return i(),j.focus(),()=>{g.playing=!1,cancelAnimationFrame(o),o=null,t.start!==t.end&&x(r,n),N.currentTime>=N.duration&&x(it(N.duration).length),j.focus()}}}),x=(e,t,r=0)=>{let n=window.getSelection();if(e!=null){e=Math.max(0,e),t==null&&(t=e);let l,c;n.removeAllRanges();let f=new Range,p=e;for(l=j.firstChild;p+r>l.firstChild.data.length;)p-=l.firstChild.data.length,l=l.nextSibling;f.setStart(l.firstChild,p);let h=t;for(c=j.firstChild;h+r>c.firstChild.data.length;)h-=c.firstChild.data.length,c=c.nextSibling;return f.setEnd(c.firstChild,h),n.addRange(f),{start:e,startNode:l,end:t,endNode:c,startNodeOffset:p,endNodeOffset:h,collapsed:n.isCollapsed}}if(!n.anchorNode||n.anchorNode.parentNode.parentNode!==j)return;e=n.anchorOffset,t=n.focusOffset;let o=n.anchorNode.parentNode;for(;o=o.previousSibling;)e+=o.firstChild.data.length;for(o=n.focusNode.parentNode;o=o.previousSibling;)t+=o.firstChild.data.length;let i=n.anchorNode.parentNode,a=n.anchorOffset,s=n.focusNode.parentNode,u=n.focusOffset;return e>t&&([t,s,u,e,i,a]=[e,i,a,t,s,u]),{start:e,startNode:i,startNodeOffset:a,end:t,endNode:s,endNodeOffset:u,collapsed:n.isCollapsed}},_t=e=>{let t=Se(e);return`${Math.floor(t/60).toFixed(0)}:${(Math.floor(t)%60).toFixed(0).padStart(2,0)}`},ft=["https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg"];async function Lt(){g.loading=!0;try{for(let[e,t]of Tt.searchParams)console.log(e,t);if(!M.length){let e=ft[Math.floor(Math.random()*ft.length)];M.push(["src",e],["norm"])}await V(...M)}catch(e){console.error(e),g.error=e.message}g.loading=!1}async function V(...e){console.log("Apply ops",e);for(let[t,...r]of e){if(!he[t])throw Error("Unknown operation `"+t+"`");de=await he[t]?.(de,...r)}It(de),Wt(de)}var It=e=>{let t=[];for(let r of e){let n=lt(r);n=n.replaceAll("\u0100"," "),t.push(n)}g.segments=t},Wt=async e=>{URL.revokeObjectURL(N.src);let t=await Oe(...e),r=new Blob([t],{type:"audio/wav"}),n=N.currentTime,o=N.src=URL.createObjectURL(r);N.currentTime=n};Lt();
//# sourceMappingURL=waev.js.map
