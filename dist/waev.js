import{b as dt}from"./chunk-YFDESRXI.js";function re(){throw new Error("Cycle detected")}function oe(){if(j>1)j--;else{for(var t,n=!1;X!==void 0;){var r=X;for(X=void 0,me++;r!==void 0;){var o=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Re(r))try{r.c()}catch(i){n||(t=i,n=!0)}r=o}}if(me=0,j--,n)throw t}}function je(t){if(j>0)return t();j++;try{return t()}finally{oe()}}var m=void 0,X=void 0,j=0,me=0,ne=0;function Pe(t){if(m!==void 0){var n=t.n;if(n===void 0||n.t!==m)return n={i:0,S:t,p:m.s,n:void 0,t:m,e:void 0,x:void 0,r:n},m.s!==void 0&&(m.s.n=n),m.s=n,t.n=n,32&m.f&&t.S(n),n;if(n.i===-1)return n.i=0,n.n!==void 0&&(n.n.p=n.p,n.p!==void 0&&(n.p.n=n.n),n.p=m.s,n.n=void 0,m.s.n=n,m.s=n),n}}function x(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}x.prototype.h=function(){return!0};x.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)};x.prototype.U=function(t){if(this.t!==void 0){var n=t.e,r=t.x;n!==void 0&&(n.x=r,t.e=void 0),r!==void 0&&(r.e=n,t.x=void 0),t===this.t&&(this.t=r)}};x.prototype.subscribe=function(t){var n=this;return ge(function(){var r=n.value,o=32&this.f;this.f&=-33;try{t(r)}finally{this.f|=o}})};x.prototype.valueOf=function(){return this.value};x.prototype.toString=function(){return this.value+""};x.prototype.peek=function(){return this.v};Object.defineProperty(x.prototype,"value",{get:function(){var t=Pe(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){me>100&&re(),this.v=t,this.i++,ne++,j++;try{for(var n=this.t;n!==void 0;n=n.x)n.t.N()}finally{oe()}}}});function Me(t){return new x(t)}function Re(t){for(var n=t.s;n!==void 0;n=n.n)if(n.S.i!==n.i||!n.S.h()||n.S.i!==n.i)return!0;return!1}function Te(t){for(var n=t.s;n!==void 0;n=n.n){var r=n.S.n;if(r!==void 0&&(n.r=r),n.S.n=n,n.i=-1,n.n===void 0){t.s=n;break}}}function _e(t){for(var n=t.s,r=void 0;n!==void 0;){var o=n.p;n.i===-1?(n.S.U(n),o!==void 0&&(o.n=n.n),n.n!==void 0&&(n.n.p=o)):r=n,n.S.n=n.r,n.r!==void 0&&(n.r=void 0),n=o}t.s=r}function L(t){x.call(this,void 0),this.x=t,this.s=void 0,this.g=ne-1,this.f=4}(L.prototype=new x).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===ne))return!0;if(this.g=ne,this.f|=1,this.i>0&&!Re(this))return this.f&=-2,!0;var t=m;try{Te(this),m=this;var n=this.x();(16&this.f||this.v!==n||this.i===0)&&(this.v=n,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return m=t,_e(this),this.f&=-2,!0};L.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var n=this.s;n!==void 0;n=n.n)n.S.S(n)}x.prototype.S.call(this,t)};L.prototype.U=function(t){if(this.t!==void 0&&(x.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var n=this.s;n!==void 0;n=n.n)n.S.U(n)}};L.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};L.prototype.peek=function(){if(this.h()||re(),16&this.f)throw this.v;return this.v};Object.defineProperty(L.prototype,"value",{get:function(){1&this.f&&re();var t=Pe(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Le(t){return new L(t)}function Ie(t){var n=t.u;if(t.u=void 0,typeof n=="function"){j++;var r=m;m=void 0;try{n()}catch(o){throw t.f&=-2,t.f|=8,ye(t),o}finally{m=r,oe()}}}function ye(t){for(var n=t.s;n!==void 0;n=n.n)n.S.U(n);t.x=void 0,t.s=void 0,Ie(t)}function pt(t){if(m!==this)throw new Error("Out-of-order effect");_e(this),m=t,this.f&=-2,8&this.f&&ye(this),oe()}function G(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}G.prototype.c=function(){var t=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{t()}};G.prototype.S=function(){1&this.f&&re(),this.f|=1,this.f&=-9,Ie(this),Te(this),j++;var t=m;return m=this,pt.bind(this,t)};G.prototype.N=function(){2&this.f||(this.f|=2,this.o=X,X=this)};G.prototype.d=function(){this.f|=8,1&this.f||ye(this)};function ge(t){var n=new G(t);try{n.c()}catch(r){throw n.d(),r}return n.d.bind(n)}Symbol.observable||=Symbol("observable");var We=t=>t&&!!(t[Symbol.observable]||t[Symbol.asyncIterator]||t.call&&t.set||t.subscribe||t.then),vt=new FinalizationRegistry(t=>t.call?.()),mt=t=>t&&(()=>t.unsubscribe?.()),Fe=(t,n,r,o,i,a)=>t&&(a=mt((t[Symbol.observable]?.()||t).subscribe?.(n,r,o))||t.set&&t.call?.(i,n)||(t.then?.(s=>(!i&&n(s),o?.()),r)||(async s=>{try{for await(s of t){if(i)return;n(s)}o?.()}catch(l){r?.(l)}})())&&(s=>i=1),vt.register(t,a),a);var yt=t=>t&&t.peek,be=t=>t&&t[Ue],Ue=Symbol("signal-struct");O.isStruct=be;function O(t,n){if(be(t)&&!n)return t;if(ie(t)){let r=Object.create(n||Object.getPrototypeOf(t)),o={},i=Object.getOwnPropertyDescriptors(t);for(let a in i){let s=i[a];if(s.get){let l=o[a]=Le(s.get.bind(r));Object.defineProperty(r,a,{get(){return l.value},set:s.set?.bind(r),configurable:!1,enumerable:!0})}else{let l=s.value,f=We(l),u=o[a]=yt(l)?l:Me(f?void 0:ie(l)?Object.seal(O(l)):Array.isArray(l)?O(l):l);f&&Fe(l,h=>u.value=h),Object.defineProperty(r,a,{get(){return u.value},set(h){if(ie(h)){if(ie(u.value))try{Object.assign(u.value,h);return}catch{}u.value=Object.seal(O(h))}else Array.isArray(h)?u.value=O(h):u.value=h},enumerable:!0,configurable:!1})}}return Object.defineProperty(r,Ue,{configurable:!1,enumerable:!1,value:!0}),r}if(Array.isArray(t)&&!be(t[0]))for(let r=0;r<t.length;r++)t[r]=O(t[r]);return t}function ie(t){return t&&t.constructor===Object}function $e(t,n,r,o){let i=new Map,a=new Map,s,l;for(s=0;s<n.length;s++)i.set(n[s],s);for(s=0;s<r.length;s++)a.set(r[s],s);for(s=l=0;s!==n.length||l!==r.length;){var f=n[s],u=r[l];if(f===null)s++;else if(r.length<=l)t.removeChild(n[s]),s++;else if(n.length<=s)t.insertBefore(u,n[s]||o),l++;else if(f===u)s++,l++;else{var h=a.get(f),c=i.get(u);h===void 0?(t.removeChild(n[s]),s++):c===void 0?(t.insertBefore(u,n[s]||o),l++):(t.insertBefore(n[c],n[s]||o),n[c]=null,c>s+1&&s++,l++)}}return r}var $={},gt={},bt={},Ke=t=>t===null?gt:t===void 0?bt:typeof t=="number"||t instanceof Number?$[t]||($[t]=new Number(t)):typeof t=="string"||t instanceof String?$[t]||($[t]=new String(t)):typeof t=="boolean"||t instanceof Boolean?$[t]||($[t]=new Boolean(t)):t;var K={},k={};K.if=(t,n)=>{let r=document.createTextNode(""),o=[A(t,n,":if")],i=[t],a=t;for(;(a=t.nextElementSibling)&&a.hasAttribute(":else");)a.removeAttribute(":else"),(n=a.getAttribute(":if"))?(a.removeAttribute(":if"),a.remove(),i.push(a),o.push(A(t,n,":else :if"))):(a.remove(),i.push(a),o.push(()=>1));return t.replaceWith(a=r),s=>{let l=o.findIndex(f=>f(s));i[l]!=a&&((a[Ze]||a).replaceWith(a=i[l]||r),I(a,s))}};K.with=(t,n,r)=>{let o=A(t,n,"with");I(t,O(o(r),r))};var Ze=Symbol(":each");K.each=(t,n)=>{let r=wt(n);if(!r)return ae(new Error,t,n);let o=t[Ze]=document.createTextNode("");t.replaceWith(o);let i=A(t,r[2],":each"),a=t.getAttribute(":key"),s=a?A(null,a):null;t.removeAttribute(":key");let l=new WeakMap,f=new WeakMap,u=[];return h=>{let c=i(h);c?typeof c=="number"?c=Array.from({length:c},(v,w)=>[w,w+1]):Array.isArray(c)?c=c.map((v,w)=>[w+1,v]):typeof c=="object"?c=Object.entries(c):ae(Error("Bad list value"),t,n,":each",c):c=[];let p=[],d=[];for(let[v,w]of c){let D,g,y=s?.({[r[0]]:w,[r[1]]:v});Ct(y)&&(y=Ke(y)),y==null?D=t.cloneNode(!0):(D=f.get(y))||f.set(y,D=t.cloneNode(!0)),p.push(D),y==null||!(g=l.get(y))?(g=O({[r[0]]:w,[r[1]]:v},h),y!=null&&l.set(y,g)):g[r[0]]=w,d.push(g)}$e(o.parentNode,u,p,o),u=p;for(let v=0;v<p.length;v++)I(p[v],d[v])}};function wt(t){let n=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,o=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=t.match(o);if(!i)return;let a=i[2].trim(),s=i[1].replace(r,"").trim(),l=s.match(n);return l?[s.replace(n,"").trim(),l[1].trim(),a]:[s,"",a]}k.ref=(t,n,r)=>{r[n]=t};k.id=(t,n)=>{let r=A(t,n,":id"),o=i=>t.id=i||i===0?i:"";return i=>o(r(i))};k.class=(t,n)=>{let r=A(t,n,":class"),o=t.className;return i=>{let a=r(i);t.className=o+typeof a=="string"?a:(Array.isArray(a)?a:Object.entries(a).map(([s,l])=>l?s:"")).filter(Boolean).join(" ")}};k.style=(t,n)=>{let r=A(t,n,":style"),o=t.getAttribute("style")||"";return o.endsWith(";")||(o+="; "),i=>{let a=r(i);if(typeof a=="string")t.setAttribute("style",o+a);else for(let s in a)t.style[s]=a[s]}};k.text=(t,n)=>{let r=A(t,n,":text");return o=>{let i=r(o);t.textContent=i??""}};k.data=(t,n)=>{let r=A(t,n,":data");return o=>{let i=r(o);for(let a in i)t.dataset[a]=i[a]}};k.aria=(t,n)=>{let r=A(t,n,":aria"),o=i=>{for(let a in i)se(t,"aria-"+Xe(a),i[a]==null?null:i[a]+"")};return i=>o(r(i))};k[""]=(t,n)=>{console.group();let r=A(t,n,":");if(console.groupEnd(),r)return o=>{let i=r(o);for(let a in i)se(t,Xe(a),i[a])}};k.value=(t,n)=>{let r=A(t,n,":value"),o,i,a=t.type==="text"||t.type===""?s=>t.setAttribute("value",t.value=s??""):t.tagName==="TEXTAREA"||t.type==="text"||t.type===""?s=>(o=t.selectionStart,i=t.selectionEnd,t.setAttribute("value",t.value=s??""),o&&t.setSelectionRange(o,i)):t.type==="checkbox"?s=>(t.value=s?"on":"",se(t,"checked",s)):t.type==="select-one"?s=>{for(let l in t.options)l.removeAttribute("selected");t.value=s,t.selectedOptions[0]?.setAttribute("selected","")}:s=>t.value=s;return s=>a(r(s))};k.on=(t,n)=>{let r=A(t,n,":on");return o=>{let i=r(o);for(let a in i)He(t,a,i[a]);return()=>{for(let a in i)Ye(t,a,i[a])}}};var Ve=(t,n,r,o)=>{let i=o.startsWith("on")&&o.slice(2),a=A(t,n,":"+o);if(a)return i?s=>{let l=a(s)||(()=>{});return He(t,i,l),()=>Ye(t,i,l)}:s=>se(t,o,a(s))},ze=Symbol("stop"),He=(t,n,r)=>{let o=n.split("..").map(u=>u.startsWith("on")?u.slice(2):u),i={target:t,hooks:[],fn:r};o[0]=o[0].replace(/\.(\w+)?-?([\w]+)?/g,(u,h,c)=>(At[h]?.(i,c),""));let{target:a,hooks:s,fn:l,...f}=i;if(s.length){let u=l;l=h=>{for(let c of s)if(c(h)===!1)return!1;return u(h)}}if(o.length==1)a.addEventListener(o[0],l,f);else{let u=(h,c=0)=>{let p=d=>{a.removeEventListener(o[c],p),typeof(h=h.call(a,d))!="function"&&(h=()=>{}),++c<o.length?u(h,c):l[ze]||u(l)};a.addEventListener(o[c],p,f)};u(l)}},Ye=(t,n,r)=>{n.indexOf("..")>=0&&(r[ze]=!0),t.removeEventListener(n,r)},At={prevent({hooks:t}){t.push(n=>{n.preventDefault()})},stop({hooks:t}){t.push(n=>{n.stopPropagation()})},throttle(t,n){let{fn:r}=t;n=Number(n)||108;let o,i,a=()=>{o=!0,setTimeout(()=>{if(o=!1,i)return i=!1,a(),r(e)})};t.fn=s=>o?i=!0:(a(),r(s))},debounce(t,n){let{fn:r}=t;n=Number(n)||108;let o;t.fn=i=>{clearTimeout(o),o=setTimeout(()=>{o=null,r(i)},n)}},window(t){t.target=window},document(t){t.target=document},outside({target:t,hooks:n}){n.push(r=>{if(t.contains(r.target)||r.target.isConnected===!1||t.offsetWidth<1&&t.offsetHeight<1)return!1})},self({target:t,hooks:n}){n.push(r=>r.target===t)},once(t){t.once=!0},passive(t){t.passive=!0},capture(t){t.capture=!0},ctrl({hooks:t}){t.push(n=>n.key==="Control"||n.key==="Ctrl")},shift({hooks:t}){t.push(n=>n.key==="Shift")},alt({hooks:t}){t.push(n=>n.key==="Alt")},meta({hooks:t}){t.push(n=>n.key==="Meta")},arrow({hooks:t}){t.push(n=>n.key.startsWith("Arrow"))},enter({hooks:t}){t.push(n=>n.key==="Enter")},escape({hooks:t}){t.push(n=>n.key.startsWith("Esc"))},tab({hooks:t}){t.push(n=>n.key==="Tab")},space({hooks:t}){t.push(n=>n.key==="Space"||n.key===" ")},backspace({hooks:t}){t.push(n=>n.key==="Backspace")},delete({hooks:t}){t.push(n=>n.key==="Delete")},digit({hooks:t}){t.push(n=>/\d/.test(n.key))},letter({hooks:t}){t.push(n=>/[a-zA-Z]/.test(n.key))},character({hooks:t}){t.push(n=>/^\S$/.test(n.key))}},se=(t,n,r)=>{r==null||r===!1?t.removeAttribute(n):t.setAttribute(n,r===!0?"":typeof r=="number"||typeof r=="string"?r:"")},qe={};function A(t,n,r){let o=qe[n];if(!o){let i=/^[\n\s]*if.*\(.*\)/.test(n)||/^(let|const)\s/.test(n)?`(() => { ${n} })()`:n;try{o=qe[n]=new Function("__scope",`with (__scope) { return ${i} };`)}catch(a){return ae(a,t,n,r)}}return i=>{let a;try{a=o.call(t,i)}catch(s){return ae(s,t,n,r)}return a}}function ae(t,n,r,o){Object.assign(t,{element:n,expression:r}),console.warn(`\u2234 ${t.message}

${o}=${r?`"${r}"

`:""}`,n),setTimeout(()=>{throw t},0)}function Xe(t){return t.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,n=>"-"+n.toLowerCase())}function Ct(t){return typeof t=="string"||typeof t=="boolean"||typeof t=="number"}var J=new WeakMap;function I(t,n){if(!t.children)return;if(J.has(t)){let a=J.get(t);return je(()=>Object.assign(a,n)),a}let r=O(n||{}),o=[],i=(a,s=a.parentNode)=>{for(let l in K){let f=":"+l;if(a.hasAttribute?.(f)){let u=a.getAttribute(f);if(a.removeAttribute(f),o.push(K[l](a,u,r,l)),J.has(a)||a.parentNode!==s)return!1}}if(a.attributes)for(let l=0;l<a.attributes.length;){let f=a.attributes[l];if(f.name[0]!==":"){l++;continue}a.removeAttribute(f.name);let u=f.value,h=f.name.slice(1).split(":");for(let c of h){let p=k[c]||Ve;if(o.push(p(a,u,r,c)),J.has(a)||a.parentNode!==s)return!1}}for(let l=0,f;f=a.children[l];l++)i(f,a)===!1&&l--};i(t);for(let a of o)if(a){let s;ge(()=>{typeof s=="function"&&s(),s=a(r)})}return Object.seal(r),J.set(t,r),r}var Ge=I;var tt=function(){function t(){}return t.prototype.then=function(n,r){let o=new t,i=this.s;if(i){let a=1&i?n:r;if(a){try{S(o,1,a(this.v))}catch(s){S(o,2,s)}return o}return this}return this.o=function(a){try{let s=a.v;1&a.s?S(o,1,n?n(s):s):r?S(o,1,r(s)):S(o,2,s)}catch(s){S(o,2,s)}},o},t}();function S(t,n,r){if(!t.s){if(r instanceof tt){if(!r.s)return void(r.o=S.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(S.bind(null,t,n),S.bind(null,t,2));t.s=n,t.v=r;let o=t.o;o&&o(t)}}var xt=0,Z=typeof WeakMap=="function"?WeakMap:function(){var t=typeof Symbol=="function"?Symbol(0):"__weak$"+ ++xt;this.set=function(n,r){n[t]=r},this.get=function(n){return n[t]}};function xe(t,n){return new Promise(function(r,o){t.onsuccess=function(){var i=t.result;n&&(i=n(i)),r(i)},t.onerror=function(){o(t.error)}})}function nt(t,n){return xe(t.openCursor(n),function(r){return r?[r.key,r.value]:[]})}function Je(t){return new Promise(function(n,r){t.oncomplete=function(){n()},t.onabort=function(){r(t.error)},t.onerror=function(){r(t.error)}})}function we(t){if(!function(n){return!!(typeof n=="number"||typeof n=="string"||typeof n=="object"&&n&&(Array.isArray(n)||"setUTCFullYear"in n||typeof ArrayBuffer=="function"&&ArrayBuffer.isView(n)||"byteLength"in n&&"length"in n))}(t))throw Error("kv-storage: The given value is not allowed as a key")}var rt={};function Qe(t,n){return nt(t,ot(n))}function ot(t){return t===rt?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(t,!0)}var it=new Z,ue=new Z,fe=new Z,at=new Z,le=function(){};function et(t,n){return n(function(r,o){try{let u=function(){return ue.set(t,a),fe.set(t,void 0),{value:l,done:a===void 0}};var i=ue.get(t);if(i===void 0)return Promise.resolve({value:void 0,done:!0});var a,s,l,f=function(h,c){var p,d=-1;e:{for(var v=0;v<c.length;v++){var w=c[v][0];if(w){var D=w();if(D&&D.then)break e;if(D===h){d=v;break}}else d=v}if(d!==-1){do{for(var g=c[d][1];!g;)g=c[++d][1];var y=g();if(y&&y.then){p=!0;break e}var Ee=c[d][2];d++}while(Ee&&!Ee());return y}}let H=new tt,te=S.bind(null,H,2);return(p?y.then(ve):D.then(function U(T){for(;;){if(T===h){d=v;break}if(++v===c.length){if(d!==-1)break;return void S(H,1,Y)}if(w=c[v][0]){if((T=w())&&T.then)return void T.then(U).then(void 0,te)}else d=v}do{for(var _=c[d][1];!_;)_=c[++d][1];var Y=_();if(Y&&Y.then)return void Y.then(ve).then(void 0,te);var Be=c[d][2];d++}while(Be&&!Be());S(H,1,Y)})).then(void 0,te),H;function ve(U){for(;;){var T=c[d][2];if(!T||T())break;for(var _=c[++d][1];!_;)_=c[++d][1];if((U=_())&&U.then)return void U.then(ve).then(void 0,te)}S(H,1,U)}}(at.get(t),[[function(){return"keys"},function(){return Promise.resolve(function(h,c){return nt(h,ot(c)).then(function(p){return p[0]})}(o,i)).then(function(h){l=a=h})}],[function(){return"values"},function(){return Promise.resolve(Qe(o,i)).then(function(h){var c;a=(c=h)[0],l=s=c[1]})}],[function(){return"entries"},function(){return Promise.resolve(Qe(o,i)).then(function(h){var c;s=(c=h)[1],l=(a=c[0])===void 0?void 0:[a,s]})}]]);return Promise.resolve(f&&f.then?f.then(u):u())}catch(u){return Promise.reject(u)}})}function Ae(t,n){var r=new le;return at.set(r,t),it.set(r,n),ue.set(r,rt),fe.set(r,void 0),r}le.prototype.return=function(){ue.set(this,void 0)},le.prototype.next=function(){var t=this,n=it.get(this);if(!n)return Promise.reject(new TypeError("Invalid this value"));var r,o=fe.get(this);return r=o!==void 0?o.then(function(){return et(t,n)}):et(this,n),fe.set(this,r),r},typeof Symbol=="function"&&Symbol.asyncIterator&&(le.prototype[Symbol.asyncIterator]=function(){return this});var q=function(t,n,r){try{return P.get(t)===null&&function(o){var i=Se.get(o);P.set(o,new Promise(function(a,s){var l=self.indexedDB.open(i,1);l.onsuccess=function(){var f=l.result;(function(u,h,c){if(u.objectStoreNames.length!==1||u.objectStoreNames[0]!==W)return c(Ce(h)),!1;var p=u.transaction(W,"readonly").objectStore(W);return!(p.autoIncrement||p.keyPath||p.indexNames.length)||(c(Ce(h)),!1)})(f,i,s)&&(f.onclose=function(){P.set(o,null)},f.onversionchange=function(){f.close(),P.set(o,null)},a(f))},l.onerror=function(){return s(l.error)},l.onupgradeneeded=function(){try{l.result.createObjectStore(W)}catch(f){s(f)}}}))}(t),Promise.resolve(P.get(t)).then(function(o){var i=o.transaction(W,n),a=i.objectStore(W);return r(i,a)})}catch(o){return Promise.reject(o)}},Se=new Z,P=new Z,W="store",E=function(t){var n="kv-storage:"+t;P.set(this,null),Se.set(this,n),this.backingStore={database:n,store:W,version:1}};function Ce(t){return new Error('kv-storage: database "'+t+'" corrupted')}E.prototype.set=function(t,n){try{return we(t),q(this,"readwrite",function(r,o){return n===void 0?o.delete(t):o.put(n,t),Je(r)})}catch(r){return Promise.reject(r)}},E.prototype.get=function(t){try{return we(t),q(this,"readonly",function(n,r){return xe(r.get(t))})}catch(n){return Promise.reject(n)}},E.prototype.delete=function(t){try{return we(t),q(this,"readwrite",function(n,r){return r.delete(t),Je(n)})}catch(n){return Promise.reject(n)}},E.prototype.clear=function(){try{let i=function(){function a(){return xe(self.indexedDB.deleteDatabase(Se.get(t)))}var s=function(){if(n){try{n.close()}catch{}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return s&&s.then?s.then(a):a()};var t=this,n,r=P.get(t),o=function(){if(r!==null){let s=function(){P.set(t,null)};var a=function(l,f){try{var u=Promise.resolve(r).then(function(h){n=h})}catch{return}return u&&u.then?u.then(void 0,function(){}):u}();return a&&a.then?a.then(s):s()}}();return o&&o.then?o.then(i):i()}catch(i){return Promise.reject(i)}},E.prototype.keys=function(){var t=this;return Ae("keys",function(n){return q(t,"readonly",n)})},E.prototype.values=function(){var t=this;return Ae("values",function(n){return q(t,"readonly",n)})},E.prototype.entries=function(){var t=this;return Ae("entries",function(n){return q(t,"readonly",n)})},typeof Symbol=="function"&&Symbol.asyncIterator&&(E.prototype[Symbol.asyncIterator]=E.prototype.entries);var St=new E("default");var F=44100,B=1024,Q=t=>Math.floor(t*F/B),Oe=t=>t*B/F,st=t=>Math.ceil(Q(t)/B),V=t=>t*B,Ot=await(async()=>{let t=new Audio,n=OfflineAudioContext;return t.canPlayType("audio/ogg")||(n=(await import("./oggmented-bundle-PZW5FHYZ.js")).default.OggmentedAudioContext),new n({sampleRate:F,length:60*60*44100})})();var lt=t=>new Promise((n,r)=>{let o=new FileReader;o.addEventListener("loadend",i=>{n(i.target.result)}),o.addEventListener("error",r),o.readAsArrayBuffer(t)});async function ut(t){console.time("fetch");let n=await fetch(t);if(!n.ok)throw new Error(`HTTP error: status=${n.status}`);let r=await n.arrayBuffer();return console.timeEnd("fetch"),r}async function he(t,n){console.time("decode");let r;try{r=await Ot.decodeAudioData(t)}catch(o){console.log(o)}return console.timeEnd("decode"),r}async function ke(...t){console.time("wav encode");let n=F,r=32,o=t[0].numberOfChannels,i=0;for(let d of t)i+=d.length;let a=new ArrayBuffer(44+i*o*(r>>3)),s=new DataView(a),l=0,f=d=>s.setUint8(l++,d),u=d=>(s.setUint16(l,d,!0),l+=2),h=d=>(s.setUint32(l,d,!0),l+=4),c=d=>{for(var v=0;v<d.length;++v)f(d.charCodeAt(v))};c("RIFF"),h(a.byteLength-8),c("WAVE"),c("fmt "),h(16),u(3),u(o),h(n),h(n*o*(r>>3)),u(o*(r>>3)),u(r),c("data"),h(a.byteLength-44);let p=new Float32Array(a,l);for(let d of t){let v=d.numberOfChannels,w=Array(v),D=d.length;for(let g=0;g<v;++g)w[g]=d.getChannelData(g);for(let g=0;g<D;++g)for(let y=0;y<v;++y)p[l++]=w[y][g]}return console.timeEnd("wav encode"),a}function ft(t){if(!t)return"";if(t._wf&&t._wf_first===t.getChannelData(0)[0])return t._wf;console.time("to waveform string");let n=t.getChannelData(0),r="",o=2;for(let i=0,a=B;i<n.length;){let s=0,l=0;for(;i<a;i++)s+=i>=n.length?0:n[i]**2;let f=Math.sqrt(s/B),u=Math.min(100,Math.ceil(f*100*o));r+=String.fromCharCode(256+u),a+=B}return t._wf=r,t._wf_first=t.getChannelData(0)[0],console.timeEnd("to waveform string"),r}function Ne(t,n=0,r=t.length){let o=new AudioBuffer({length:r-n,numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate});for(var i=0;i<o.numberOfChannels;i++)o.copyToChannel(t.getChannelData(i).subarray(n,r),i,0);return o}function ce(t,n){let r=new AudioBuffer({length:t.length+n.length,numberOfChannels:Math.max(t.numberOfChannels,n.numberOfChannels),sampleRate:t.sampleRate});for(let o=0;o<r.numberOfChannels;o++)r.copyToChannel(t.getChannelData(o),o,0),r.copyToChannel(n.getChannelData(o),o,t.length);return r}function ct(t,n,r){if(n>=t.length)return ce(t,r);if(!n)return ce(r,t);let o=new AudioBuffer({length:t.length+r.length,numberOfChannels:Math.max(t.numberOfChannels,r.numberOfChannels),sampleRate:t.sampleRate});for(let i=0;i<o.numberOfChannels;i++)o.copyToChannel(t.getChannelData(i).subarray(0,n),i,0),o.copyToChannel(r.getChannelData(i),i,n),o.copyToChannel(t.getChannelData(i).subarray(n),i,n+r.length);return o}var de={};dt(de,{add:()=>Mt,br:()=>Dt,clip:()=>Pt,cp:()=>Rt,del:()=>Bt,join:()=>Et,mute:()=>jt,norm:()=>Nt,src:()=>kt});var kt=async(t,n)=>{let r=await ut(n);return[await he(r)]},Nt=t=>{let n=0,r=0;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);r+=f.length;for(let u=0;u<f.length;u++)n+=f[u]}let o=n/r;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);r+=f.length;for(let u=0;u<f.length;u++)f[u]-=o}let i=0;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);for(let u=0;u<f.length;u++)i=Math.max(Math.abs(f[u]),i)}let a=Math.max(1/i,1);for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);for(let u=0;u<f.length;u++)f[u]=Math.min(1,Math.max(-1,f[u]*a))}return t},Dt=(t,...n)=>{for(let r of n){let[o,i]=ee(t,V(r)),a=t[o];if(i>0&&i<a.length){let s=Ne(a,0,i),l=Ne(a,i);t.splice(o,1,s,l)}}return t};function Et(t,n){let[r,o]=ee(t,V(n));if(o)return console.warn("Wrong buffer offset",n);let i=t[r-1],a=t[r];return t.splice(r-1,2,ce(i,a)),t}function Bt(t,n,r){if(!r)return t;let o=ee(t,V(n)),i=ee(t,V(n+r));!i[1]&&i[0]&&(i[0]-=1,i[1]=t[i[0]].length);let a=t[o[0]],s=t[i[0]],l=new AudioBuffer({length:o[1]+(s.length-i[1]),sampleRate:F,numberOfChannels:a.numberOfChannels});for(let f=0;f<a.numberOfChannels;f++){let u=0,h=l.getChannelData(f),c=a.getChannelData(f),p=s.getChannelData(f);for(u=0;u<o[1];u++)h[u]=c[u];for(let d=i[1];d<p.length;d++)h[u]=p[d],u++}return t.splice(o[0],i[0]-o[0]+1,l),t}function jt(t,...n){for(let r of n){let[o,i]=r,[a,s]=ee(t,V(o));!s&&a&&(a-=1,s=t[a].length);let l=new AudioBuffer({length:i*B,numberOfChannels:t?.[0].numberOfChannels||1,sampleRate:t?.[0].sampleRate||F});t[a]=ct(t[a],s,l)}return t}var Pt=(t,n,r)=>{},Mt=(t,n,r)=>{},Rt=(t,n,r,o)=>{},ee=(t,n)=>{if(n===0)return[0,0];var r=0,o;for(let i=0;i<t.length;i++){if(o=r+t[i].length,n<o)return[i,n-r];r=o}return[t.length-1,t[t.length-1].length]};var De=document.querySelector(".waev"),M=De.querySelector(".w-wavearea"),N=De.querySelector(".w-playback"),pe=[],Tt=new URL(location),R=[],b=Ge(De,{loading:!1,recording:!1,playing:!1,selecting:!1,startFrame:0,volume:1,error:null,segments:[],lineWidth:216,isMouseDown:!1,handleCaret(t){N.currentTime=Oe(b.startFrame=C().start)},updateTimecodes(){let t=0,n=0;for(let r of M.children){let o=r.textContent.trim(),i=Math.ceil(o.length/b.lineWidth);r.dataset.id=n++,r.setAttribute("timecodes",Array.from({length:i},(a,s)=>_t(s*b.lineWidth+t)).join(`
`)),t+=o.length}},async handleEnter(t){let n=C();if(!n.startNode.dataset.id)throw Error("Segment id is not found, strange");setTimeout(async()=>{(R.at(-1)[0]==="br"?R.pop():["br"]).push(n.start),await z(["br",n.start]),C(n.start,n.start,1)},500)},async handleDelete(t){let n=C();if(!n.startNode.dataset.id)throw Error("Segment id is not found, strange");let o=n.end-n.start,i=n.start-(t.key==="Delete"?0:1);if(!(i<0&&!o))if(!n.startNodeOffset&&n.collapsed)await z(["join",n.start]),C(n.start);else{let a=o?["del",n.start,o]:["del",i,1];R.push(a),await z(a),C(i)}},async handleSpace(t){let n=C(),r=b.segments[n.startNode.dataset.id],o=n.startNode.textContent.length-r.length,i=n.start-o;(R.at(-1)[0]==="mute"?R.pop():["mute"]).push([i,o]),await z(["mute",[i,o]]),C(n.start)},async handleDrop(t){let r=t.dataTransfer.files[0];if(!r.type.startsWith("audio"))return!1;b.loading=!0,b.segments=[];let o=await lt(r),i=await he(o),a=await ke(i),s=new Blob([a],{type:"audio/wav"}),l=URL.createObjectURL(s);return await z(["src",l]),b.loading=!1,o},timeChange(t){document.activeElement!==M&&(C(b.startFrame=Q(N.currentTime)),M.focus())},play(t){b.playing=!0;let n=C();n||(n=C(0));let r=n.start,o=n.collapsed?Q(N.duration):n.end,i,a=()=>{let s=Math.max(Q(N.currentTime)-b.startFrame,0),l=b.startFrame+s;b.isMouseDown||C(l),o&&l>=o?N.pause():i=requestAnimationFrame(a)};return a(),M.focus(),()=>{b.playing=!1,cancelAnimationFrame(i),i=null,n.start!==n.end&&C(r,o),N.currentTime>=N.duration&&C(st(N.duration).length),M.focus()}}}),C=(t,n,r=0)=>{let o=window.getSelection();if(t!=null){t=Math.max(0,t),n==null&&(n=t);let u,h;o.removeAllRanges();let c=new Range,p=t;for(u=M.firstChild;p+r>u.firstChild.data.length;)p-=u.firstChild.data.length,u=u.nextSibling;c.setStart(u.firstChild,p);let d=n;for(h=M.firstChild;d+r>h.firstChild.data.length;)d-=h.firstChild.data.length,h=h.nextSibling;return c.setEnd(h.firstChild,d),o.addRange(c),{start:t,startNode:u,end:n,endNode:h,startNodeOffset:p,endNodeOffset:d,collapsed:o.isCollapsed}}if(!o.anchorNode||o.anchorNode.parentNode.parentNode!==M)return;t=o.anchorOffset,n=o.focusOffset;let i=o.anchorNode.parentNode;for(;i=i.previousSibling;)t+=i.firstChild.data.length;for(i=o.focusNode.parentNode;i=i.previousSibling;)n+=i.firstChild.data.length;let a=o.anchorNode.parentNode,s=o.anchorOffset,l=o.focusNode.parentNode,f=o.focusOffset;return t>n&&([n,l,f,t,a,s]=[t,a,s,n,l,f]),{start:t,startNode:a,startNodeOffset:s,end:n,endNode:l,endNodeOffset:f,collapsed:o.isCollapsed}},_t=t=>{let n=Oe(t);return`${Math.floor(n/60).toFixed(0)}:${(Math.floor(n)%60).toFixed(0).padStart(2,0)}`},ht=["https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg"];async function Lt(){b.loading=!0;try{for(let[t,n]of Tt.searchParams)console.log(t,n);if(!R.length){let t=ht[Math.floor(Math.random()*ht.length)];R.push(["src",t],["norm"])}await z(...R)}catch(t){console.error(t),b.error=t.message}b.loading=!1}async function z(...t){console.log("Apply ops",t);for(let[n,...r]of t){if(!de[n])throw Error("Unknown operation `"+n+"`");pe=await de[n]?.(pe,...r)}It(pe),Wt(pe)}var It=t=>{let n=[];for(let r of t){let o=ft(r);o=o.replaceAll("\u0100"," "),n.push(o)}b.segments=n},Wt=async t=>{URL.revokeObjectURL(N.src);let n=await ke(...t),r=new Blob([n],{type:"audio/wav"}),o=N.currentTime,i=N.src=URL.createObjectURL(r);N.currentTime=o};Lt();
//# sourceMappingURL=waev.js.map
