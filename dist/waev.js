import"./chunk-ABZDHW4W.js";function oe(){throw new Error("Cycle detected")}function ie(){if(R>1)R--;else{for(var e,t=!1;G!==void 0;){var n=G;for(G=void 0,ve++;n!==void 0;){var r=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&Me(n))try{n.c()}catch(o){t||(e=o,t=!0)}n=r}}if(ve=0,R--,t)throw e}}function je(e){if(R>0)return e();R++;try{return e()}finally{ie()}}var m=void 0,G=void 0,R=0,ve=0,re=0;function Ee(e){if(m!==void 0){var t=e.n;if(t===void 0||t.t!==m)return t={i:0,S:e,p:m.s,n:void 0,t:m,e:void 0,x:void 0,r:t},m.s!==void 0&&(m.s.n=t),m.s=t,e.n=t,32&m.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=m.s,t.n=void 0,m.s.n=t,m.s=t),t}}function x(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}x.prototype.h=function(){return!0};x.prototype.S=function(e){this.t!==e&&e.e===void 0&&(e.x=this.t,this.t!==void 0&&(this.t.e=e),this.t=e)};x.prototype.U=function(e){if(this.t!==void 0){var t=e.e,n=e.x;t!==void 0&&(t.x=n,e.e=void 0),n!==void 0&&(n.e=t,e.x=void 0),e===this.t&&(this.t=n)}};x.prototype.subscribe=function(e){var t=this;return ye(function(){var n=t.value,r=32&this.f;this.f&=-33;try{e(n)}finally{this.f|=r}})};x.prototype.valueOf=function(){return this.value};x.prototype.toString=function(){return this.value+""};x.prototype.peek=function(){return this.v};Object.defineProperty(x.prototype,"value",{get:function(){var e=Ee(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){ve>100&&oe(),this.v=e,this.i++,re++,R++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{ie()}}}});function Pe(e){return new x(e)}function Me(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function Re(e){for(var t=e.s;t!==void 0;t=t.n){var n=t.S.n;if(n!==void 0&&(t.r=n),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Te(e){for(var t=e.s,n=void 0;t!==void 0;){var r=t.p;t.i===-1?(t.S.U(t),r!==void 0&&(r.n=t.n),t.n!==void 0&&(t.n.p=r)):n=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=r}e.s=n}function I(e){x.call(this,void 0),this.x=e,this.s=void 0,this.g=re-1,this.f=4}(I.prototype=new x).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===re))return!0;if(this.g=re,this.f|=1,this.i>0&&!Me(this))return this.f&=-2,!0;var e=m;try{Re(this),m=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return m=e,Te(this),this.f&=-2,!0};I.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}x.prototype.S.call(this,e)};I.prototype.U=function(e){if(this.t!==void 0&&(x.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};I.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};I.prototype.peek=function(){if(this.h()||oe(),16&this.f)throw this.v;return this.v};Object.defineProperty(I.prototype,"value",{get:function(){1&this.f&&oe();var e=Ee(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function _e(e){return new I(e)}function Le(e){var t=e.u;if(e.u=void 0,typeof t=="function"){R++;var n=m;m=void 0;try{t()}catch(r){throw e.f&=-2,e.f|=8,me(e),r}finally{m=n,ie()}}}function me(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,Le(e)}function ht(e){if(m!==this)throw new Error("Out-of-order effect");Te(this),m=e,this.f&=-2,8&this.f&&me(this),ie()}function J(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}J.prototype.c=function(){var e=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{e()}};J.prototype.S=function(){1&this.f&&oe(),this.f|=1,this.f&=-9,Le(this),Re(this),R++;var e=m;return m=this,ht.bind(this,e)};J.prototype.N=function(){2&this.f||(this.f|=2,this.o=G,G=this)};J.prototype.d=function(){this.f|=8,1&this.f||me(this)};function ye(e){var t=new J(e);try{t.c()}catch(n){throw t.d(),n}return t.d.bind(t)}Symbol.observable||=Symbol("observable");var Ie=e=>e&&!!(e[Symbol.observable]||e[Symbol.asyncIterator]||e.call&&e.set||e.subscribe||e.then),dt=new FinalizationRegistry(e=>e.call?.()),pt=e=>e&&(()=>e.unsubscribe?.()),We=(e,t,n,r,o,i)=>e&&(i=pt((e[Symbol.observable]?.()||e).subscribe?.(t,n,r))||e.set&&e.call?.(o,t)||(e.then?.(a=>(!o&&t(a),r?.()),n)||(async a=>{try{for await(a of e){if(o)return;t(a)}r?.()}catch(s){n?.(s)}})())&&(a=>o=1),dt.register(e,i),i);var vt=e=>e&&e.peek,ge=e=>e&&e[Ue],Ue=Symbol("signal-struct");O.isStruct=ge;function O(e,t){if(ge(e)&&!t)return e;if(ae(e)){let n=Object.create(t||Object.getPrototypeOf(e)),r={},o=Object.getOwnPropertyDescriptors(e);for(let i in o){let a=o[i];if(a.get){let s=r[i]=_e(a.get.bind(n));Object.defineProperty(n,i,{get(){return s.value},set:a.set?.bind(n),configurable:!1,enumerable:!0})}else{let s=a.value,u=Ie(s),l=r[i]=vt(s)?s:Pe(u?void 0:ae(s)?Object.seal(O(s)):Array.isArray(s)?O(s):s);u&&We(s,c=>l.value=c),Object.defineProperty(n,i,{get(){return l.value},set(c){if(ae(c)){if(ae(l.value))try{Object.assign(l.value,c);return}catch{}l.value=Object.seal(O(c))}else Array.isArray(c)?l.value=O(c):l.value=c},enumerable:!0,configurable:!1})}}return Object.defineProperty(n,Ue,{configurable:!1,enumerable:!1,value:!0}),n}if(Array.isArray(e)&&!ge(e[0]))for(let n=0;n<e.length;n++)e[n]=O(e[n]);return e}function ae(e){return e&&e.constructor===Object}function Fe(e,t,n,r){let o=new Map,i=new Map,a,s;for(a=0;a<t.length;a++)o.set(t[a],a);for(a=0;a<n.length;a++)i.set(n[a],a);for(a=s=0;a!==t.length||s!==n.length;){var u=t[a],l=n[s];if(u===null)a++;else if(n.length<=s)e.removeChild(t[a]),a++;else if(t.length<=a)e.insertBefore(l,t[a]||r),s++;else if(u===l)a++,s++;else{var c=i.get(u),f=o.get(l);c===void 0?(e.removeChild(t[a]),a++):f===void 0?(e.insertBefore(l,t[a]||r),s++):(e.insertBefore(t[f],t[a]||r),t[f]=null,f>a+1&&a++,s++)}}return n}var q={},mt={},yt={},$e=e=>e===null?mt:e===void 0?yt:typeof e=="number"||e instanceof Number?q[e]||(q[e]=new Number(e)):typeof e=="string"||e instanceof String?q[e]||(q[e]=new String(e)):typeof e=="boolean"||e instanceof Boolean?q[e]||(q[e]=new Boolean(e)):e;var Z={},N={};Z.if=(e,t)=>{let n=document.createTextNode(""),r=[w(e,t,":if")],o=[e],i=e;for(;(i=e.nextElementSibling)&&i.hasAttribute(":else");)i.removeAttribute(":else"),(t=i.getAttribute(":if"))?(i.removeAttribute(":if"),i.remove(),o.push(i),r.push(w(e,t,":else :if"))):(i.remove(),o.push(i),r.push(()=>1));return e.replaceWith(i=n),a=>{let s=r.findIndex(u=>u(a));o[s]!=i&&((i[qe]||i).replaceWith(i=o[s]||n),W(i,a))}};Z.with=(e,t,n)=>{let r=w(e,t,"with");W(e,O(r(n),n))};var qe=Symbol(":each");Z.each=(e,t)=>{let n=gt(t);if(!n)return se(new Error,e,t);let r=e[qe]=document.createTextNode("");e.replaceWith(r);let o=w(e,n[2],":each"),i=e.getAttribute(":key"),a=i?w(null,i):null;e.removeAttribute(":key");let s=new WeakMap,u=new WeakMap,l=[];return c=>{let f=o(c);f?typeof f=="number"?f=Array.from({length:f},(d,y)=>[y,y+1]):Array.isArray(f)?f=f.map((d,y)=>[y+1,d]):typeof f=="object"?f=Object.entries(f):se(Error("Bad list value"),e,t,":each",f):f=[];let p=[],h=[];for(let[d,y]of f){let A,v,g=a?.({[n[0]]:y,[n[1]]:d});Ct(g)&&(g=$e(g)),g==null?A=e.cloneNode(!0):(A=u.get(g))||u.set(g,A=e.cloneNode(!0)),p.push(A),g==null||!(v=s.get(g))?(v=O({[n[0]]:y,[n[1]]:d},c),g!=null&&s.set(g,v)):v[n[0]]=y,h.push(v)}Fe(r.parentNode,l,p,r),l=p;for(let d=0;d<p.length;d++)W(p[d],h[d])}};function gt(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n=/^\s*\(|\)\s*$/g,r=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,o=e.match(r);if(!o)return;let i=o[2].trim(),a=o[1].replace(n,"").trim(),s=a.match(t);return s?[a.replace(t,"").trim(),s[1].trim(),i]:[a,"",i]}N.ref=(e,t,n)=>{n[t]=e};N.id=(e,t)=>{let n=w(e,t,":id"),r=o=>e.id=o||o===0?o:"";return o=>r(n(o))};N.class=(e,t)=>{let n=w(e,t,":class"),r=e.className;return o=>{let i=n(o);e.className=r+typeof i=="string"?i:(Array.isArray(i)?i:Object.entries(i).map(([a,s])=>s?a:"")).filter(Boolean).join(" ")}};N.style=(e,t)=>{let n=w(e,t,":style"),r=e.getAttribute("style")||"";return r.endsWith(";")||(r+="; "),o=>{let i=n(o);if(typeof i=="string")e.setAttribute("style",r+i);else for(let a in i)e.style[a]=i[a]}};N.text=(e,t)=>{let n=w(e,t,":text");return r=>{let o=n(r);e.textContent=o??""}};N.data=(e,t)=>{let n=w(e,t,":data");return r=>{let o=n(r);for(let i in o)e.dataset[i]=o[i]}};N.aria=(e,t)=>{let n=w(e,t,":aria"),r=o=>{for(let i in o)le(e,"aria-"+He(i),o[i]==null?null:o[i]+"")};return o=>r(n(o))};N[""]=(e,t)=>{let n=w(e,t,":");if(n)return r=>{let o=n(r);for(let i in o)le(e,He(i),o[i])}};N.value=(e,t)=>{let n=w(e,t,":value"),r,o,i=e.type==="text"||e.type===""?a=>e.setAttribute("value",e.value=a??""):e.tagName==="TEXTAREA"||e.type==="text"||e.type===""?a=>(r=e.selectionStart,o=e.selectionEnd,e.setAttribute("value",e.value=a??""),r&&e.setSelectionRange(r,o)):e.type==="checkbox"?a=>(e.value=a?"on":"",le(e,"checked",a)):e.type==="select-one"?a=>{for(let s in e.options)s.removeAttribute("selected");e.value=a,e.selectedOptions[0]?.setAttribute("selected","")}:a=>e.value=a;return a=>i(n(a))};N.on=(e,t)=>{let n=w(e,t,":on");return r=>{let o=n(r),i=[];for(let a in o)i.push(Ve(e,a,o[a]));return()=>{for(let a of i)a()}}};var Ze=(e,t,n,r)=>{let o=r.startsWith("on")&&r.slice(2),i=w(e,t,":"+r);if(i)return o?a=>{let s=i(a)||(()=>{});return Ve(e,o,s)}:a=>le(e,r,i(a))},Ve=(e,t,n)=>{let r=t.split("..").map(s=>{let u={evt:"",target:e,test:()=>!0};return u.evt=(s.startsWith("on")?s.slice(2):s).replace(/\.(\w+)?-?([\w]+)?/g,(l,c,f)=>(u.test=bt[c]?.(u,f)||u.test,"")),u});if(r.length==1)return a(n,r[0]);let o,i=(s,u=0)=>o=a(c=>{o(),typeof(s=s.call(e,c))!="function"&&(s=()=>{}),++u<r.length?i(s,u):i(n)},r[u]);return i(n),()=>o();function a(s,{evt:u,target:l,test:c,throttle:f,debounce:p,stop:h,prevent:d,...y}){f?s=wt(s,f):p&&(s=At(s,p));let A=v=>c(v)&&(h&&v.stopPropagation(),d&&v.preventDefault(),s.call(l,v));return l.addEventListener(u,A,y),()=>l.removeEventListener(u,A,y)}},bt={prevent(e){e.prevent=!0},stop(e){e.stop=!0},once(e){e.once=!0},passive(e){e.passive=!0},capture(e){e.capture=!0},window(e){e.target=window},document(e){e.target=document},throttle(e,t){e.throttle=Number(t)||108},debounce(e,t){e.debounce=Number(t)||108},outside:e=>t=>{let n=e.target;return!(n.contains(t.target)||t.target.isConnected===!1||n.offsetWidth<1&&n.offsetHeight<1)},self:e=>t=>t.target===e.target,ctrl:e=>t=>t.key==="Control"||t.key==="Ctrl",shift:e=>t=>t.key==="Shift",alt:e=>t=>t.key==="Alt",meta:e=>t=>t.key==="Meta",arrow:e=>t=>t.key.startsWith("Arrow"),enter:e=>t=>t.key==="Enter",escape:e=>t=>t.key.startsWith("Esc"),tab:e=>t=>t.key==="Tab",space:e=>t=>t.key==="Space"||t.key===" ",backspace:e=>t=>t.key==="Backspace",delete:e=>t=>t.key==="Delete",digit:e=>t=>/^\d$/.test(t.key),letter:e=>t=>/^[a-zA-Z]$/.test(t.key),character:e=>t=>/^\S$/.test(t.key)},wt=(e,t)=>{let n,r,o=i=>{n=!0,setTimeout(()=>{if(n=!1,r)return r=!1,o(i),e(i)},t)};return i=>n?r=!0:(o(i),e(i))},At=(e,t)=>{let n;return r=>{clearTimeout(n),n=setTimeout(()=>{n=null,e(r)},t)}},le=(e,t,n)=>{n==null||n===!1?e.removeAttribute(t):e.setAttribute(t,n===!0?"":typeof n=="number"||typeof n=="string"?n:"")},Ke={};function w(e,t,n){let r=Ke[t];if(!r){let o=/^[\n\s]*if.*\(.*\)/.test(t)||/\b(let|const)\s/.test(t)?`(() => { ${t} })()`:t;try{r=Ke[t]=new Function("__scope",`with (__scope) { return ${o} };`)}catch(i){return se(i,e,t,n)}}return o=>{let i;try{i=r.call(e,o)}catch(a){return se(a,e,t,n)}return i}}function se(e,t,n,r){Object.assign(e,{element:t,expression:n}),console.warn(`\u2234 ${e.message}

${r}=${n?`"${n}"

`:""}`,t),setTimeout(()=>{throw e},0)}function He(e){return e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,t=>"-"+t.toLowerCase())}function Ct(e){return typeof e=="string"||typeof e=="boolean"||typeof e=="number"}var Q=new WeakMap;function W(e,t){if(!e.children)return;if(Q.has(e)){let i=Q.get(e);return je(()=>Object.assign(i,t)),i}let n=O(t||{}),r=[],o=(i,a=i.parentNode)=>{for(let s in Z){let u=":"+s;if(i.hasAttribute?.(u)){let l=i.getAttribute(u);if(i.removeAttribute(u),r.push(Z[s](i,l,n,s)),Q.has(i)||i.parentNode!==a)return!1}}if(i.attributes)for(let s=0;s<i.attributes.length;){let u=i.attributes[s];if(u.name[0]!==":"){s++;continue}i.removeAttribute(u.name);let l=u.value,c=u.name.slice(1).split(":");for(let f of c){let p=N[f]||Ze;if(r.push(p(i,l,n,f)),Q.has(i)||i.parentNode!==a)return!1}}for(let s=0,u;u=i.children[s];s++)o(u,i)===!1&&s--};o(e);for(let i of r)if(i){let a;ye(()=>{typeof a=="function"&&a(),a=i(n)})}return Object.seal(n),Q.set(e,n),n}var ze=W;var Je=function(){function e(){}return e.prototype.then=function(t,n){let r=new e,o=this.s;if(o){let i=1&o?t:n;if(i){try{S(r,1,i(this.v))}catch(a){S(r,2,a)}return r}return this}return this.o=function(i){try{let a=i.v;1&i.s?S(r,1,t?t(a):a):n?S(r,1,n(a)):S(r,2,a)}catch(a){S(r,2,a)}},r},e}();function S(e,t,n){if(!e.s){if(n instanceof Je){if(!n.s)return void(n.o=S.bind(null,e,t));1&t&&(t=n.s),n=n.v}if(n&&n.then)return void n.then(S.bind(null,e,t),S.bind(null,e,2));e.s=t,e.v=n;let r=e.o;r&&r(e)}}var xt=0,H=typeof WeakMap=="function"?WeakMap:function(){var e=typeof Symbol=="function"?Symbol(0):"__weak$"+ ++xt;this.set=function(t,n){t[e]=n},this.get=function(t){return t[e]}};function Ce(e,t){return new Promise(function(n,r){e.onsuccess=function(){var o=e.result;t&&(o=t(o)),n(o)},e.onerror=function(){r(e.error)}})}function Qe(e,t){return Ce(e.openCursor(t),function(n){return n?[n.key,n.value]:[]})}function Ye(e){return new Promise(function(t,n){e.oncomplete=function(){t()},e.onabort=function(){n(e.error)},e.onerror=function(){n(e.error)}})}function be(e){if(!function(t){return!!(typeof t=="number"||typeof t=="string"||typeof t=="object"&&t&&(Array.isArray(t)||"setUTCFullYear"in t||typeof ArrayBuffer=="function"&&ArrayBuffer.isView(t)||"byteLength"in t&&"length"in t))}(e))throw Error("kv-storage: The given value is not allowed as a key")}var et={};function Xe(e,t){return Qe(e,tt(t))}function tt(e){return e===et?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(e,!0)}var nt=new H,fe=new H,ce=new H,rt=new H,ue=function(){};function Ge(e,t){return t(function(n,r){try{let l=function(){return fe.set(e,i),ce.set(e,void 0),{value:s,done:i===void 0}};var o=fe.get(e);if(o===void 0)return Promise.resolve({value:void 0,done:!0});var i,a,s,u=function(c,f){var p,h=-1;e:{for(var d=0;d<f.length;d++){var y=f[d][0];if(y){var A=y();if(A&&A.then)break e;if(A===c){h=d;break}}else h=d}if(h!==-1){do{for(var v=f[h][1];!v;)v=f[++h][1];var g=v();if(g&&g.then){p=!0;break e}var Be=f[h][2];h++}while(Be&&!Be());return g}}let Y=new Je,ne=S.bind(null,Y,2);return(p?g.then(pe):A.then(function K(_){for(;;){if(_===c){h=d;break}if(++d===f.length){if(h!==-1)break;return void S(Y,1,X)}if(y=f[d][0]){if((_=y())&&_.then)return void _.then(K).then(void 0,ne)}else h=d}do{for(var L=f[h][1];!L;)L=f[++h][1];var X=L();if(X&&X.then)return void X.then(pe).then(void 0,ne);var De=f[h][2];h++}while(De&&!De());S(Y,1,X)})).then(void 0,ne),Y;function pe(K){for(;;){var _=f[h][2];if(!_||_())break;for(var L=f[++h][1];!L;)L=f[++h][1];if((K=L())&&K.then)return void K.then(pe).then(void 0,ne)}S(Y,1,K)}}(rt.get(e),[[function(){return"keys"},function(){return Promise.resolve(function(c,f){return Qe(c,tt(f)).then(function(p){return p[0]})}(r,o)).then(function(c){s=i=c})}],[function(){return"values"},function(){return Promise.resolve(Xe(r,o)).then(function(c){var f;i=(f=c)[0],s=a=f[1]})}],[function(){return"entries"},function(){return Promise.resolve(Xe(r,o)).then(function(c){var f;a=(f=c)[1],s=(i=f[0])===void 0?void 0:[i,a]})}]]);return Promise.resolve(u&&u.then?u.then(l):l())}catch(l){return Promise.reject(l)}})}function we(e,t){var n=new ue;return rt.set(n,e),nt.set(n,t),fe.set(n,et),ce.set(n,void 0),n}ue.prototype.return=function(){fe.set(this,void 0)},ue.prototype.next=function(){var e=this,t=nt.get(this);if(!t)return Promise.reject(new TypeError("Invalid this value"));var n,r=ce.get(this);return n=r!==void 0?r.then(function(){return Ge(e,t)}):Ge(this,t),ce.set(this,n),n},typeof Symbol=="function"&&Symbol.asyncIterator&&(ue.prototype[Symbol.asyncIterator]=function(){return this});var V=function(e,t,n){try{return T.get(e)===null&&function(r){var o=xe.get(r);T.set(r,new Promise(function(i,a){var s=self.indexedDB.open(o,1);s.onsuccess=function(){var u=s.result;(function(l,c,f){if(l.objectStoreNames.length!==1||l.objectStoreNames[0]!==U)return f(Ae(c)),!1;var p=l.transaction(U,"readonly").objectStore(U);return!(p.autoIncrement||p.keyPath||p.indexNames.length)||(f(Ae(c)),!1)})(u,o,a)&&(u.onclose=function(){T.set(r,null)},u.onversionchange=function(){u.close(),T.set(r,null)},i(u))},s.onerror=function(){return a(s.error)},s.onupgradeneeded=function(){try{s.result.createObjectStore(U)}catch(u){a(u)}}}))}(e),Promise.resolve(T.get(e)).then(function(r){var o=r.transaction(U,t),i=o.objectStore(U);return n(o,i)})}catch(r){return Promise.reject(r)}},xe=new H,T=new H,U="store",D=function(e){var t="kv-storage:"+e;T.set(this,null),xe.set(this,t),this.backingStore={database:t,store:U,version:1}};function Ae(e){return new Error('kv-storage: database "'+e+'" corrupted')}D.prototype.set=function(e,t){try{return be(e),V(this,"readwrite",function(n,r){return t===void 0?r.delete(e):r.put(t,e),Ye(n)})}catch(n){return Promise.reject(n)}},D.prototype.get=function(e){try{return be(e),V(this,"readonly",function(t,n){return Ce(n.get(e))})}catch(t){return Promise.reject(t)}},D.prototype.delete=function(e){try{return be(e),V(this,"readwrite",function(t,n){return n.delete(e),Ye(t)})}catch(t){return Promise.reject(t)}},D.prototype.clear=function(){try{let o=function(){function i(){return Ce(self.indexedDB.deleteDatabase(xe.get(e)))}var a=function(){if(t){try{t.close()}catch{}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return a&&a.then?a.then(i):i()};var e=this,t,n=T.get(e),r=function(){if(n!==null){let a=function(){T.set(e,null)};var i=function(s,u){try{var l=Promise.resolve(n).then(function(c){t=c})}catch{return}return l&&l.then?l.then(void 0,function(){}):l}();return i&&i.then?i.then(a):a()}}();return r&&r.then?r.then(o):o()}catch(o){return Promise.reject(o)}},D.prototype.keys=function(){var e=this;return we("keys",function(t){return V(e,"readonly",t)})},D.prototype.values=function(){var e=this;return we("values",function(t){return V(e,"readonly",t)})},D.prototype.entries=function(){var e=this;return we("entries",function(t){return V(e,"readonly",t)})},typeof Symbol=="function"&&Symbol.asyncIterator&&(D.prototype[Symbol.asyncIterator]=D.prototype.entries);var St=new D("default");var F=44100,j=1024,ee=e=>Math.floor(e*F/j),Se=e=>e*j/F,ot=e=>Math.ceil(ee(e)/j),z=e=>e*j,Ot=await(async()=>{let e=new Audio,t=OfflineAudioContext;return e.canPlayType("audio/ogg")||(t=(await import("./oggmented-bundle-ZFEURIUF.js")).default.OggmentedAudioContext),new t({sampleRate:F,length:60*60*44100})})();var it=e=>new Promise((t,n)=>{let r=new FileReader;r.addEventListener("loadend",o=>{t(o.target.result)}),r.addEventListener("error",n),r.readAsArrayBuffer(e)});async function at(e){console.time("fetch");let t=await fetch(e);if(!t.ok)throw new Error(`HTTP error: status=${t.status}`);let n=await t.arrayBuffer();return console.timeEnd("fetch"),n}async function de(e,t){console.time("decode");let n;try{n=await Ot.decodeAudioData(e)}catch(r){console.log(r)}return console.timeEnd("decode"),n}async function Oe(...e){console.time("wav encode");let t=F,n=32,r=e[0].numberOfChannels,o=0;for(let h of e)o+=h.length;let i=new ArrayBuffer(44+o*r*(n>>3)),a=new DataView(i),s=0,u=h=>a.setUint8(s++,h),l=h=>(a.setUint16(s,h,!0),s+=2),c=h=>(a.setUint32(s,h,!0),s+=4),f=h=>{for(var d=0;d<h.length;++d)u(h.charCodeAt(d))};f("RIFF"),c(i.byteLength-8),f("WAVE"),f("fmt "),c(16),l(3),l(r),c(t),c(t*r*(n>>3)),l(r*(n>>3)),l(n),f("data"),c(i.byteLength-44);let p=new Float32Array(i,s);for(let h of e){let d=h.numberOfChannels,y=Array(d),A=h.length;for(let v=0;v<d;++v)y[v]=h.getChannelData(v);for(let v=0;v<A;++v)for(let g=0;g<d;++g)p[s++]=y[g][v]}return console.timeEnd("wav encode"),i}function st(e){if(!e)return"";if(e._wf&&e._wf_first===e.getChannelData(0)[0])return e._wf;console.time("to waveform string");let t=e.getChannelData(0),n="",r=2;for(let o=0,i=j;o<t.length;){let a=0,s=0;for(;o<i;o++)a+=o>=t.length?0:t[o]**2;let u=Math.sqrt(a/j),l=Math.min(100,Math.ceil(u*100*r));n+=String.fromCharCode(256+l),i+=j}return e._wf=n,e._wf_first=e.getChannelData(0)[0],console.timeEnd("to waveform string"),n}function Ne(e,t=0,n=e.length){let r=new AudioBuffer({length:n-t,numberOfChannels:e.numberOfChannels,sampleRate:e.sampleRate});for(var o=0;o<r.numberOfChannels;o++)r.copyToChannel(e.getChannelData(o).subarray(t,n),o,0);return r}function he(e,t){let n=new AudioBuffer({length:e.length+t.length,numberOfChannels:Math.max(e.numberOfChannels,t.numberOfChannels),sampleRate:e.sampleRate});for(let r=0;r<n.numberOfChannels;r++)n.copyToChannel(e.getChannelData(r),r,0),n.copyToChannel(t.getChannelData(r),r,e.length);return n}function lt(e,t,n){if(t>=e.length)return he(e,n);if(!t)return he(n,e);let r=new AudioBuffer({length:e.length+n.length,numberOfChannels:Math.max(e.numberOfChannels,n.numberOfChannels),sampleRate:e.sampleRate});for(let o=0;o<r.numberOfChannels;o++)r.copyToChannel(e.getChannelData(o).subarray(0,t),o,0),r.copyToChannel(n.getChannelData(o),o,t),r.copyToChannel(e.getChannelData(o).subarray(t),o,t+n.length);return r}async function $(e,...t){console.log("Apply ops",t);for(let[n,...r]of t){if(!B[n])throw Error("Unknown operation `"+n+"`");e=await B[n]?.(e,...r)}return e}var B={};B.src=async(e,t)=>{let n=await at(t);return[await de(n)]};B.norm=e=>{let t=0,n=0;for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);n+=u.length;for(let l=0;l<u.length;l++)t+=u[l]}let r=t/n;for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);n+=u.length;for(let l=0;l<u.length;l++)u[l]-=r}let o=0;for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);for(let l=0;l<u.length;l++)o=Math.max(Math.abs(u[l]),o)}let i=Math.max(1/o,1);for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);for(let l=0;l<u.length;l++)u[l]=Math.min(1,Math.max(-1,u[l]*i))}return e};B.br=(e,...t)=>{for(let n of t){let[r,o]=te(e,z(n)),i=e[r];if(o>0&&o<i.length){let a=Ne(i,0,o),s=Ne(i,o);e.splice(r,1,a,s)}}return e};B.join=(e,t)=>{let[n,r]=te(e,z(t));if(r)return console.warn("Wrong buffer offset",t);let o=e[n-1],i=e[n];return e.splice(n-1,2,he(o,i)),e};B.del=(e,t,n)=>{if(!n)return e;let r=te(e,z(t)),o=te(e,z(t+n));!o[1]&&o[0]&&(o[0]-=1,o[1]=e[o[0]].length);let i=e[r[0]],a=e[o[0]],s=new AudioBuffer({length:r[1]+(a.length-o[1]),sampleRate:F,numberOfChannels:i.numberOfChannels});for(let u=0;u<i.numberOfChannels;u++){let l=0,c=s.getChannelData(u),f=i.getChannelData(u),p=a.getChannelData(u);for(l=0;l<r[1];l++)c[l]=f[l];for(let h=o[1];h<p.length;h++)c[l]=p[h],l++}return e.splice(r[0],o[0]-r[0]+1,s),e};B.mute=(e,...t)=>{for(let n of t){let[r,o]=n,[i,a]=te(e,z(r));!a&&i&&(i-=1,a=e[i].length);let s=new AudioBuffer({length:o*j,numberOfChannels:e?.[0].numberOfChannels||1,sampleRate:e?.[0].sampleRate||F});e[i]=lt(e[i],a,s)}return e};B.clip=(e,t,n)=>{};B.add=(e,t,n)=>{};B.cp=(e,t,n,r)=>{};var te=(e,t)=>{if(t===0)return[0,0];var n=0,r;for(let o=0;o<e.length;o++){if(r=n+e[o].length,t<r)return[o,t-n];n=r}return[e.length-1,e[e.length-1].length]};var ke=document.querySelector(".waev"),E=ke.querySelector(".w-wavearea"),k=ke.querySelector(".w-playback"),P=[],Nt=new URL(location),M=[],b=ze(ke,{loading:!1,recording:!1,playing:!1,selecting:!1,startFrame:0,volume:1,error:null,segments:[],lineWidth:216,isMouseDown:!1,handleCaret(e){k.currentTime=Se(b.startFrame=C().start)},updateTimecodes(){let e=0,t=0;for(let n of E.children){let r=n.textContent.trim(),o=Math.ceil(r.length/b.lineWidth);n.dataset.id=t++,n.dataset.offset=e,n.setAttribute("timecodes",Array.from({length:o},(i,a)=>Bt(a*b.lineWidth+e)).join(`
`)),e+=r.length}},async handleBeforeInput(e){let t=kt[e.inputType];t?t(e):e.preventDefault()},async handleEnter(e){let t=C();if(!t.startNode.dataset.id)throw Error("Segment id is not found, strange");(M.at(-1)[0]==="br"?M.pop():["br"]).push(t.start),await $(P,["br",t.start]),C(t.start,t.start,1)},async handleBackspace(e){console.log(123);let t=C(),n=b.segments[t.startNode.dataset.id],r=t.start,o=E.textContent.length-b.segments.reduce((i,a)=>i+=a.length,0);console.log(o),r<0},async handleDelete(e){},async handleSpace(e){let t=C(),n=b.segments[t.startNode.dataset.id],r=t.startNode.textContent.length-n.length,o=t.start-r;(M.at(-1)[0]==="mute"?M.pop():["mute"]).push([o,r]),await $(["mute",[o,r]]),C(t.start)},async handleDrop(e){let n=e.dataTransfer.files[0];if(!n.type.startsWith("audio"))return!1;b.loading=!0,b.segments=[];let r=await it(n),o=await de(r),i=await Oe(o),a=new Blob([i],{type:"audio/wav"}),s=URL.createObjectURL(a);return await $(["src",s]),b.loading=!1,r},timeChange(e){document.activeElement!==E&&(C(b.startFrame=ee(k.currentTime)),E.focus())},play(e){b.playing=!0;let t=C();t||(t=C(0));let n=t.start,r=t.collapsed?ee(k.duration):t.end,o,i=()=>{let a=Math.max(ee(k.currentTime)-b.startFrame,0),s=b.startFrame+a;b.isMouseDown||C(s),r&&s>=r?k.pause():o=requestAnimationFrame(i)};return i(),E.focus(),()=>{b.playing=!1,cancelAnimationFrame(o),o=null,t.start!==t.end&&C(n,r),k.currentTime>=k.duration&&C(ot(k.duration).length),E.focus()}}}),kt={async deleteContentBackward(e){let t=e.getTargetRanges()[0],n=t.startOffset+Number(t.startContainer.parentNode.dataset.offset),r=t.endOffset+Number(t.endContainer.parentNode.dataset.offset),o=r-n,i=M.at(-1);i[0]==="del"?i[2]++:M.push(i=["del",n,o]),P=await $(P,["del",n,o]),ft(P),ct(P)}},C=(e,t,n=0)=>{let r=window.getSelection();if(e!=null){e=Math.max(0,e),t==null&&(t=e);let l,c;r.removeAllRanges();let f=new Range,p=e;for(l=E.firstChild;p+n>l.firstChild.data.length;)p-=l.firstChild.data.length,l=l.nextSibling;f.setStart(l.firstChild,p);let h=t;for(c=E.firstChild;h+n>c.firstChild.data.length;)h-=c.firstChild.data.length,c=c.nextSibling;return f.setEnd(c.firstChild,h),r.addRange(f),{start:e,startNode:l,end:t,endNode:c,startNodeOffset:p,endNodeOffset:h,collapsed:r.isCollapsed}}if(!r.anchorNode||r.anchorNode.parentNode.parentNode!==E)return;e=r.anchorOffset,t=r.focusOffset;let o=r.anchorNode.parentNode;for(;o=o.previousSibling;)e+=o.firstChild.data.length;for(o=r.focusNode.parentNode;o=o.previousSibling;)t+=o.firstChild.data.length;let i=r.anchorNode.parentNode,a=r.anchorOffset,s=r.focusNode.parentNode,u=r.focusOffset;return e>t&&([t,s,u,e,i,a]=[e,i,a,t,s,u]),{start:e,startNode:i,startNodeOffset:a,end:t,endNode:s,endNodeOffset:u,collapsed:r.isCollapsed}},Bt=e=>{let t=Se(e);return`${Math.floor(t/60).toFixed(0)}:${(Math.floor(t)%60).toFixed(0).padStart(2,0)}`},ut=["https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg"];async function Dt(){b.loading=!0;try{for(let[e,t]of Nt.searchParams)console.log(e,t);if(!M.length){let e=ut[Math.floor(Math.random()*ut.length)];M.push(["src",e],["norm"])}P=await $(P,...M),ft(P),ct(P)}catch(e){console.error(e),b.error=e.message}b.loading=!1}var ft=e=>{let t=[],n=C();for(let r of e){let o=st(r);o=o.replaceAll("\u0100"," "),t.push(o)}b.segments=t,n&&C(n.start)},ct=async e=>{URL.revokeObjectURL(k.src);let t=await Oe(...e),n=new Blob([t],{type:"audio/wav"}),r=k.currentTime,o=k.src=URL.createObjectURL(n);k.currentTime=r};Dt();
//# sourceMappingURL=waev.js.map
