import{b as mt}from"./chunk-YFDESRXI.js";function ae(){throw new Error("Cycle detected")}function se(){if(B>1)B--;else{for(var t,n=!1;Q!==void 0;){var r=Q;for(Q=void 0,ge++;r!==void 0;){var o=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Te(r))try{r.c()}catch(i){n||(t=i,n=!0)}r=o}}if(ge=0,B--,n)throw t}}function Be(t){if(B>0)return t();B++;try{return t()}finally{se()}}var v=void 0,Q=void 0,B=0,ge=0,ie=0;function Re(t){if(v!==void 0){var n=t.n;if(n===void 0||n.t!==v)return n={i:0,S:t,p:v.s,n:void 0,t:v,e:void 0,x:void 0,r:n},v.s!==void 0&&(v.s.n=n),v.s=n,t.n=n,32&v.f&&t.S(n),n;if(n.i===-1)return n.i=0,n.n!==void 0&&(n.n.p=n.p,n.p!==void 0&&(n.p.n=n.n),n.p=v.s,n.n=void 0,v.s.n=n,v.s=n),n}}function C(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}C.prototype.h=function(){return!0};C.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)};C.prototype.U=function(t){if(this.t!==void 0){var n=t.e,r=t.x;n!==void 0&&(n.x=r,t.e=void 0),r!==void 0&&(r.e=n,t.x=void 0),t===this.t&&(this.t=r)}};C.prototype.subscribe=function(t){var n=this;return we(function(){var r=n.value,o=32&this.f;this.f&=-33;try{t(r)}finally{this.f|=o}})};C.prototype.valueOf=function(){return this.value};C.prototype.toString=function(){return this.value+""};C.prototype.peek=function(){return this.v};Object.defineProperty(C.prototype,"value",{get:function(){var t=Re(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){ge>100&&ae(),this.v=t,this.i++,ie++,B++;try{for(var n=this.t;n!==void 0;n=n.x)n.t.N()}finally{se()}}}});function Me(t){return new C(t)}function Te(t){for(var n=t.s;n!==void 0;n=n.n)if(n.S.i!==n.i||!n.S.h()||n.S.i!==n.i)return!0;return!1}function _e(t){for(var n=t.s;n!==void 0;n=n.n){var r=n.S.n;if(r!==void 0&&(n.r=r),n.S.n=n,n.i=-1,n.n===void 0){t.s=n;break}}}function Le(t){for(var n=t.s,r=void 0;n!==void 0;){var o=n.p;n.i===-1?(n.S.U(n),o!==void 0&&(o.n=n.n),n.n!==void 0&&(n.n.p=o)):r=n,n.S.n=n.r,n.r!==void 0&&(n.r=void 0),n=o}t.s=r}function L(t){C.call(this,void 0),this.x=t,this.s=void 0,this.g=ie-1,this.f=4}(L.prototype=new C).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===ie))return!0;if(this.g=ie,this.f|=1,this.i>0&&!Te(this))return this.f&=-2,!0;var t=v;try{_e(this),v=this;var n=this.x();(16&this.f||this.v!==n||this.i===0)&&(this.v=n,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return v=t,Le(this),this.f&=-2,!0};L.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var n=this.s;n!==void 0;n=n.n)n.S.S(n)}C.prototype.S.call(this,t)};L.prototype.U=function(t){if(this.t!==void 0&&(C.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var n=this.s;n!==void 0;n=n.n)n.S.U(n)}};L.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};L.prototype.peek=function(){if(this.h()||ae(),16&this.f)throw this.v;return this.v};Object.defineProperty(L.prototype,"value",{get:function(){1&this.f&&ae();var t=Re(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Ie(t){return new L(t)}function Ue(t){var n=t.u;if(t.u=void 0,typeof n=="function"){B++;var r=v;v=void 0;try{n()}catch(o){throw t.f&=-2,t.f|=8,be(t),o}finally{v=r,se()}}}function be(t){for(var n=t.s;n!==void 0;n=n.n)n.S.U(n);t.x=void 0,t.s=void 0,Ue(t)}function vt(t){if(v!==this)throw new Error("Out-of-order effect");Le(this),v=t,this.f&=-2,8&this.f&&be(this),se()}function ee(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}ee.prototype.c=function(){var t=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{t()}};ee.prototype.S=function(){1&this.f&&ae(),this.f|=1,this.f&=-9,Ue(this),_e(this),B++;var t=v;return v=this,vt.bind(this,t)};ee.prototype.N=function(){2&this.f||(this.f|=2,this.o=Q,Q=this)};ee.prototype.d=function(){this.f|=8,1&this.f||be(this)};function we(t){var n=new ee(t);try{n.c()}catch(r){throw n.d(),r}return n.d.bind(n)}Symbol.observable||=Symbol("observable");var We=t=>t&&!!(t[Symbol.observable]||t[Symbol.asyncIterator]||t.call&&t.set||t.subscribe||t.then),yt=new FinalizationRegistry(t=>t.call?.()),gt=t=>t&&(()=>t.unsubscribe?.()),Fe=(t,n,r,o,i,a)=>t&&(a=gt((t[Symbol.observable]?.()||t).subscribe?.(n,r,o))||t.set&&t.call?.(i,n)||(t.then?.(s=>(!i&&n(s),o?.()),r)||(async s=>{try{for await(s of t){if(i)return;n(s)}o?.()}catch(l){r?.(l)}})())&&(s=>i=1),yt.register(t,a),a);var bt=t=>t&&t.peek,Ae=t=>t&&t[$e],$e=Symbol("signal-struct");x.isStruct=Ae;function x(t,n){if(Ae(t)&&!n)return t;if(le(t)){let r=Object.create(n||Object.getPrototypeOf(t)),o={},i=Object.getOwnPropertyDescriptors(t);for(let a in i){let s=i[a];if(s.get){let l=o[a]=Ie(s.get.bind(r));Object.defineProperty(r,a,{get(){return l.value},set:s.set?.bind(r),configurable:!1,enumerable:!0})}else{let l=s.value,f=We(l),u=o[a]=bt(l)?l:Me(f?void 0:le(l)?Object.seal(x(l)):Array.isArray(l)?x(l):l);f&&Fe(l,h=>u.value=h),Object.defineProperty(r,a,{get(){return u.value},set(h){if(le(h)){if(le(u.value))try{Object.assign(u.value,h);return}catch{}u.value=Object.seal(x(h))}else Array.isArray(h)?u.value=x(h):u.value=h},enumerable:!0,configurable:!1})}}return Object.defineProperty(r,$e,{configurable:!1,enumerable:!1,value:!0}),r}if(Array.isArray(t)&&!Ae(t[0]))for(let r=0;r<t.length;r++)t[r]=x(t[r]);return t}function le(t){return t&&t.constructor===Object}var q=(t,n,r,o=null)=>{let i=0,a,s,l,f=r.length,u=n.length,{remove:h,same:c,insert:p,replace:d}=q;for(;i<f&&i<u&&c(n[i],r[i]);)i++;for(;i<f&&i<u&&c(r[f-1],n[u-1]);)o=r[--u,--f];if(i==u)for(;i<f;)p(o,r[i++],t);else{for(a=n[i];i<f;)l=r[i++],s=a?a.nextSibling:o,c(a,l)?a=s:i<f&&c(r[i],s)?(d(a,l,t),a=s):p(a,l,t);for(;!c(a,o);)s=a.nextSibling,h(a,t),a=s}return r};q.same=(t,n)=>t==n;q.replace=(t,n,r)=>r.replaceChild(n,t);q.insert=(t,n,r)=>r.insertBefore(n,t);q.remove=(t,n)=>n.removeChild(t);var Ke=q;var Z={},wt={},At={},qe=t=>t===null?wt:t===void 0?At:typeof t=="number"||t instanceof Number?Z[t]||(Z[t]=new Number(t)):typeof t=="string"||t instanceof String?Z[t]||(Z[t]=new String(t)):typeof t=="boolean"||t instanceof Boolean?Z[t]||(Z[t]=new Boolean(t)):t;var V={},O={};V.if=(t,n)=>{let r=document.createTextNode(""),o=[w(t,n,":if")],i=[t],a=t;for(;(a=t.nextElementSibling)&&a.hasAttribute(":else");)a.removeAttribute(":else"),(n=a.getAttribute(":if"))?(a.removeAttribute(":if"),a.remove(),i.push(a),o.push(w(t,n,":else :if"))):(a.remove(),i.push(a),o.push(()=>1));return t.replaceWith(a=r),s=>{let l=o.findIndex(f=>f(s));i[l]!=a&&((a[Ve]||a).replaceWith(a=i[l]||r),U(a,s))}};V.with=(t,n,r)=>{let o=w(t,n,"with");U(t,x(o(r),r))};var Ve=Symbol(":each");V.each=(t,n)=>{let r=Ct(n);if(!r)return ue(new Error,t,n);let o=t[Ve]=document.createTextNode("");t.replaceWith(o);let i=w(t,r[2],":each"),a=t.getAttribute(":key"),s=a?w(null,a):null;t.removeAttribute(":key");let l=new WeakMap,f=new WeakMap,u=[];return h=>{let c=i(h);c?typeof c=="number"?c=Array.from({length:c},(m,b)=>[b,b+1]):Array.isArray(c)?c=c.map((m,b)=>[b+1,m]):typeof c=="object"?c=Object.entries(c):ue(Error("Bad list value"),t,n,":each",c):c=[];let p=[],d=[];for(let[m,b]of c){let N,g,y=s?.({[r[0]]:b,[r[1]]:m});St(y)&&(y=qe(y)),y==null?N=t.cloneNode(!0):(N=f.get(y))||f.set(y,N=t.cloneNode(!0)),p.push(N),y==null||!(g=l.get(y))?(g=x({[r[0]]:b,[r[1]]:m},h),y!=null&&l.set(y,g)):g[r[0]]=b,d.push(g)}Ke(o.parentNode,u,p,o),u=p;for(let m=0;m<p.length;m++)U(p[m],d[m])}};function Ct(t){let n=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,o=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=t.match(o);if(!i)return;let a=i[2].trim(),s=i[1].replace(r,"").trim(),l=s.match(n);return l?[s.replace(n,"").trim(),l[1].trim(),a]:[s,"",a]}O.ref=(t,n,r)=>{r[n]=t};O.id=(t,n)=>{let r=w(t,n,":id"),o=i=>t.id=i||i===0?i:"";return i=>o(r(i))};O.class=(t,n)=>{let r=w(t,n,":class"),o=t.className;return i=>{let a=r(i);t.className=o+typeof a=="string"?a:(Array.isArray(a)?a:Object.entries(a).map(([s,l])=>l?s:"")).filter(Boolean).join(" ")}};O.style=(t,n)=>{let r=w(t,n,":style"),o=t.getAttribute("style")||"";return o.endsWith(";")||(o+="; "),i=>{let a=r(i);if(typeof a=="string")t.setAttribute("style",o+a);else for(let s in a)t.style[s]=a[s]}};O.text=(t,n)=>{let r=w(t,n,":text");return o=>{let i=r(o);t.textContent=i??""}};O.data=(t,n)=>{let r=w(t,n,":data");return o=>{let i=r(o);for(let a in i)t.dataset[a]=i[a]}};O.aria=(t,n)=>{let r=w(t,n,":aria"),o=i=>{for(let a in i)fe(t,"aria-"+Ge(a),i[a]==null?null:i[a]+"")};return i=>o(r(i))};O[""]=(t,n)=>{let r=w(t,n,":");if(r)return o=>{let i=r(o);for(let a in i)fe(t,Ge(a),i[a])}};O.value=(t,n)=>{let r=w(t,n,":value"),o,i,a=t.type==="text"||t.type===""?s=>t.setAttribute("value",t.value=s??""):t.tagName==="TEXTAREA"||t.type==="text"||t.type===""?s=>(o=t.selectionStart,i=t.selectionEnd,t.setAttribute("value",t.value=s??""),o&&t.setSelectionRange(o,i)):t.type==="checkbox"?s=>(t.value=s?"on":"",fe(t,"checked",s)):t.type==="select-one"?s=>{for(let l in t.options)l.removeAttribute("selected");t.value=s,t.selectedOptions[0]?.setAttribute("selected","")}:s=>t.value=s;return s=>a(r(s))};O.on=(t,n)=>{let r=w(t,n,":on");return o=>{let i=r(o);for(let a in i)ze(t,a,i[a]);return()=>{for(let a in i)Ye(t,a,i[a])}}};var He=(t,n,r,o)=>{let i=o.startsWith("on")&&o.slice(2),a=w(t,n,":"+o);if(a)return i?s=>{let l=a(s)||(()=>{});return ze(t,i,l),()=>Ye(t,i,l)}:s=>fe(t,o,a(s))},j=Symbol("stop"),ze=(t,n,r)=>{let o=n.split("..").map(a=>a.startsWith("on")?a.slice(2):a),i={};if(o[0]=o[0].replace(/\.(\w+)?-?([\w]+)?/g,(a,s,l)=>((s=Xe[s])&&([t,r]=s(t,r,i,l)),"")),o.length==1)t.addEventListener(o[0],r,i);else{let a=(s,l=0)=>{let f=u=>{t.removeEventListener(o[l],f),typeof(s=s.call(t,u))!="function"&&(s=()=>{}),++l<o.length?a(s,l):r[j]||a(r)};t.addEventListener(o[l],f,i)};a(r)}},Ye=(t,n,r)=>{n.indexOf("..")>=0&&(r[j]=!0),t.removeEventListener(n,r)},Xe={throttle(t,n,r,o){o=Number(o)||108;let i,a,s=()=>{i=!0,setTimeout(()=>{i=!1,a&&(n(e),a=!1,s())})};return[t,l=>{if(i)return a=!0,j;n(l),s()}]},debounce(t,n,r,o){o=Number(o)||108;let i,a=()=>{i=null,n(e)};return[t,s=>{clearTimeout(i),i=setTimeout(a,o)}]},window(t,n){return[window,n]},document(t,n){return[document,n]},outside(t,n){return[t,r=>{if(t.contains(r.target)||r.target.isConnected===!1||t.offsetWidth<1&&t.offsetHeight<1)return j;n(r)}]},prevent(t,n){return[t,r=>{n(r)!==j&&r.preventDefault()}]},stop(t,n){return[t,r=>{n(r)!==j&&r.stopPropagation()}]},self(t,n){return[t,r=>{r.target===t&&n(r)}]},once(t,n,r){return r.once=!0,[t,n]},passive(t,n,r){return r.passive=!0,[t,n]},capture(t,n,r){return r.capture=!0,[t,n]}},I={ctrl:"Control Ctrl",shift:"Shift",alt:"Alt",meta:"Meta",cmd:"Meta",down:"ArrowDown",up:"ArrowUp",left:"ArrowLeft",right:"ArrowRight",end:"End",home:"Home",pagedown:"PageDown",pageup:"PageUp",enter:"Enter",esc:"Escape",escape:"Escape",tab:"Tab",backspace:"Backspace",delete:"Delete",space:/ /,plus:/\+/,minus:/\-/,star:/\*/,slash:/\//,period:/\./,equal:/\=/,underscore:/\_/,alnum:/\w/,letter:/[a-zA-Z]/,digit:/\d/};I.arrow=I.down+I.up+I.left+I.right;for(let t in I){let n=I[t];Xe[t]=(r,o,i,a)=>[r,s=>{if(!s.key||(s.key.length>2?!n.includes?.(s.key):!n.test?.(s.key)))return j;o(s)}]}var fe=(t,n,r)=>{r==null||r===!1?t.removeAttribute(n):t.setAttribute(n,r===!0?"":typeof r=="number"||typeof r=="string"?r:"")},Ze={};function w(t,n,r){let o=Ze[n];if(!o){let i=/^[\n\s]*if.*\(.*\)/.test(n)||/^(let|const)\s/.test(n)?`(() => { ${n} })()`:n;try{o=Ze[n]=new Function("__scope",`with (__scope) { return ${i} };`)}catch(a){return ue(a,t,n,r)}}return i=>{let a;try{a=o.call(t,i)}catch(s){return ue(s,t,n,r)}return a}}function ue(t,n,r,o){Object.assign(t,{element:n,expression:r}),console.warn(`\u2234 ${t.message}

${o}=${r?`"${r}"

`:""}`,n),setTimeout(()=>{throw t},0)}function Ge(t){return t.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,n=>"-"+n.toLowerCase())}function St(t){return typeof t=="string"||typeof t=="boolean"||typeof t=="number"}var te=new WeakMap;function U(t,n){if(!t.children)return;if(te.has(t)){let a=te.get(t);return Be(()=>Object.assign(a,n)),a}let r=x(n||{}),o=[],i=(a,s=a.parentNode)=>{for(let l in V){let f=":"+l;if(a.hasAttribute?.(f)){let u=a.getAttribute(f);if(a.removeAttribute(f),o.push(V[l](a,u,r,l)),te.has(a)||a.parentNode!==s)return!1}}if(a.attributes)for(let l=0;l<a.attributes.length;){let f=a.attributes[l];if(f.name[0]!==":"){l++;continue}a.removeAttribute(f.name);let u=f.value,h=f.name.slice(1).split(":");for(let c of h){let p=O[c]||He;if(o.push(p(a,u,r,c)),te.has(a)||a.parentNode!==s)return!1}}for(let l=0,f;f=a.children[l];l++)i(f,a)===!1&&l--};i(t);for(let a of o)if(a){let s;we(()=>{typeof s=="function"&&s(),s=a(r)})}return Object.seal(r),te.set(t,r),r}var Je=U;var nt=function(){function t(){}return t.prototype.then=function(n,r){let o=new t,i=this.s;if(i){let a=1&i?n:r;if(a){try{S(o,1,a(this.v))}catch(s){S(o,2,s)}return o}return this}return this.o=function(a){try{let s=a.v;1&a.s?S(o,1,n?n(s):s):r?S(o,1,r(s)):S(o,2,s)}catch(s){S(o,2,s)}},o},t}();function S(t,n,r){if(!t.s){if(r instanceof nt){if(!r.s)return void(r.o=S.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(S.bind(null,t,n),S.bind(null,t,2));t.s=n,t.v=r;let o=t.o;o&&o(t)}}var xt=0,z=typeof WeakMap=="function"?WeakMap:function(){var t=typeof Symbol=="function"?Symbol(0):"__weak$"+ ++xt;this.set=function(n,r){n[t]=r},this.get=function(n){return n[t]}};function Oe(t,n){return new Promise(function(r,o){t.onsuccess=function(){var i=t.result;n&&(i=n(i)),r(i)},t.onerror=function(){o(t.error)}})}function rt(t,n){return Oe(t.openCursor(n),function(r){return r?[r.key,r.value]:[]})}function Qe(t){return new Promise(function(n,r){t.oncomplete=function(){n()},t.onabort=function(){r(t.error)},t.onerror=function(){r(t.error)}})}function Ce(t){if(!function(n){return!!(typeof n=="number"||typeof n=="string"||typeof n=="object"&&n&&(Array.isArray(n)||"setUTCFullYear"in n||typeof ArrayBuffer=="function"&&ArrayBuffer.isView(n)||"byteLength"in n&&"length"in n))}(t))throw Error("kv-storage: The given value is not allowed as a key")}var ot={};function et(t,n){return rt(t,it(n))}function it(t){return t===ot?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(t,!0)}var at=new z,he=new z,de=new z,st=new z,ce=function(){};function tt(t,n){return n(function(r,o){try{let u=function(){return he.set(t,a),de.set(t,void 0),{value:l,done:a===void 0}};var i=he.get(t);if(i===void 0)return Promise.resolve({value:void 0,done:!0});var a,s,l,f=function(h,c){var p,d=-1;e:{for(var m=0;m<c.length;m++){var b=c[m][0];if(b){var N=b();if(N&&N.then)break e;if(N===h){d=m;break}}else d=m}if(d!==-1){do{for(var g=c[d][1];!g;)g=c[++d][1];var y=g();if(y&&y.then){p=!0;break e}var je=c[d][2];d++}while(je&&!je());return y}}let G=new nt,oe=S.bind(null,G,2);return(p?y.then(ye):N.then(function K(T){for(;;){if(T===h){d=m;break}if(++m===c.length){if(d!==-1)break;return void S(G,1,J)}if(b=c[m][0]){if((T=b())&&T.then)return void T.then(K).then(void 0,oe)}else d=m}do{for(var _=c[d][1];!_;)_=c[++d][1];var J=_();if(J&&J.then)return void J.then(ye).then(void 0,oe);var ke=c[d][2];d++}while(ke&&!ke());S(G,1,J)})).then(void 0,oe),G;function ye(K){for(;;){var T=c[d][2];if(!T||T())break;for(var _=c[++d][1];!_;)_=c[++d][1];if((K=_())&&K.then)return void K.then(ye).then(void 0,oe)}S(G,1,K)}}(st.get(t),[[function(){return"keys"},function(){return Promise.resolve(function(h,c){return rt(h,it(c)).then(function(p){return p[0]})}(o,i)).then(function(h){l=a=h})}],[function(){return"values"},function(){return Promise.resolve(et(o,i)).then(function(h){var c;a=(c=h)[0],l=s=c[1]})}],[function(){return"entries"},function(){return Promise.resolve(et(o,i)).then(function(h){var c;s=(c=h)[1],l=(a=c[0])===void 0?void 0:[a,s]})}]]);return Promise.resolve(f&&f.then?f.then(u):u())}catch(u){return Promise.reject(u)}})}function Se(t,n){var r=new ce;return st.set(r,t),at.set(r,n),he.set(r,ot),de.set(r,void 0),r}ce.prototype.return=function(){he.set(this,void 0)},ce.prototype.next=function(){var t=this,n=at.get(this);if(!n)return Promise.reject(new TypeError("Invalid this value"));var r,o=de.get(this);return r=o!==void 0?o.then(function(){return tt(t,n)}):tt(this,n),de.set(this,r),r},typeof Symbol=="function"&&Symbol.asyncIterator&&(ce.prototype[Symbol.asyncIterator]=function(){return this});var H=function(t,n,r){try{return R.get(t)===null&&function(o){var i=Ee.get(o);R.set(o,new Promise(function(a,s){var l=self.indexedDB.open(i,1);l.onsuccess=function(){var f=l.result;(function(u,h,c){if(u.objectStoreNames.length!==1||u.objectStoreNames[0]!==W)return c(xe(h)),!1;var p=u.transaction(W,"readonly").objectStore(W);return!(p.autoIncrement||p.keyPath||p.indexNames.length)||(c(xe(h)),!1)})(f,i,s)&&(f.onclose=function(){R.set(o,null)},f.onversionchange=function(){f.close(),R.set(o,null)},a(f))},l.onerror=function(){return s(l.error)},l.onupgradeneeded=function(){try{l.result.createObjectStore(W)}catch(f){s(f)}}}))}(t),Promise.resolve(R.get(t)).then(function(o){var i=o.transaction(W,n),a=i.objectStore(W);return r(i,a)})}catch(o){return Promise.reject(o)}},Ee=new z,R=new z,W="store",P=function(t){var n="kv-storage:"+t;R.set(this,null),Ee.set(this,n),this.backingStore={database:n,store:W,version:1}};function xe(t){return new Error('kv-storage: database "'+t+'" corrupted')}P.prototype.set=function(t,n){try{return Ce(t),H(this,"readwrite",function(r,o){return n===void 0?o.delete(t):o.put(n,t),Qe(r)})}catch(r){return Promise.reject(r)}},P.prototype.get=function(t){try{return Ce(t),H(this,"readonly",function(n,r){return Oe(r.get(t))})}catch(n){return Promise.reject(n)}},P.prototype.delete=function(t){try{return Ce(t),H(this,"readwrite",function(n,r){return r.delete(t),Qe(n)})}catch(n){return Promise.reject(n)}},P.prototype.clear=function(){try{let i=function(){function a(){return Oe(self.indexedDB.deleteDatabase(Ee.get(t)))}var s=function(){if(n){try{n.close()}catch{}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return s&&s.then?s.then(a):a()};var t=this,n,r=R.get(t),o=function(){if(r!==null){let s=function(){R.set(t,null)};var a=function(l,f){try{var u=Promise.resolve(r).then(function(h){n=h})}catch{return}return u&&u.then?u.then(void 0,function(){}):u}();return a&&a.then?a.then(s):s()}}();return o&&o.then?o.then(i):i()}catch(i){return Promise.reject(i)}},P.prototype.keys=function(){var t=this;return Se("keys",function(n){return H(t,"readonly",n)})},P.prototype.values=function(){var t=this;return Se("values",function(n){return H(t,"readonly",n)})},P.prototype.entries=function(){var t=this;return Se("entries",function(n){return H(t,"readonly",n)})},typeof Symbol=="function"&&Symbol.asyncIterator&&(P.prototype[Symbol.asyncIterator]=P.prototype.entries);var Ot=new P("default");var F=44100,k=1024,Y=t=>Math.floor(t*F/k),Ne=t=>t*k/F,lt=t=>Math.ceil(Y(t)/k),X=t=>t*k,Et=await(async()=>{let t=new Audio,n=OfflineAudioContext;return t.canPlayType("audio/ogg")||(n=(await import("./oggmented-bundle-PZW5FHYZ.js")).default.OggmentedAudioContext),new n({sampleRate:F,length:60*60*44100})})();async function ut(t){console.time("fetch");let n=await fetch(t);if(!n.ok)throw new Error(`HTTP error: status=${n.status}`);let r=await n.arrayBuffer();return console.timeEnd("fetch"),r}async function ft(t,n){console.time("decode");let r;try{r=await Et.decodeAudioData(t)}catch(o){console.log(o)}return console.timeEnd("decode"),r}async function ct(...t){console.time("wav encode");let n=F,r=32,o=t[0].numberOfChannels,i=0;for(let d of t)i+=d.length;let a=new ArrayBuffer(44+i*o*(r>>3)),s=new DataView(a),l=0,f=d=>s.setUint8(l++,d),u=d=>(s.setUint16(l,d,!0),l+=2),h=d=>(s.setUint32(l,d,!0),l+=4),c=d=>{for(var m=0;m<d.length;++m)f(d.charCodeAt(m))};c("RIFF"),h(a.byteLength-8),c("WAVE"),c("fmt "),h(16),u(3),u(o),h(n),h(n*o*(r>>3)),u(o*(r>>3)),u(r),c("data"),h(a.byteLength-44);let p=new Float32Array(a,l);for(let d of t){let m=d.numberOfChannels,b=Array(m),N=d.length;for(let g=0;g<m;++g)b[g]=d.getChannelData(g);for(let g=0;g<N;++g)for(let y=0;y<m;++y)p[l++]=b[y][g]}return console.timeEnd("wav encode"),a}function ht(t){if(!t)return"";if(t._wf&&t._wf_first===t.getChannelData(0)[0])return t._wf;console.time("to waveform string");let n=t.getChannelData(0),r="",o=2;for(let i=0,a=k;i<n.length;){let s=0,l=0;for(;i<a;i++)s+=i>=n.length?0:n[i]**2;let f=Math.sqrt(s/k),u=Math.min(100,Math.ceil(f*100*o));r+=String.fromCharCode(256+u),a+=k}return t._wf=r,t._wf_first=t.getChannelData(0)[0],console.timeEnd("to waveform string"),r}function De(t,n=0,r=t.length){let o=new AudioBuffer({length:r-n,numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate});for(var i=0;i<o.numberOfChannels;i++)o.copyToChannel(t.getChannelData(i).subarray(n,r),i,0);return o}function pe(t,n){let r=new AudioBuffer({length:t.length+n.length,numberOfChannels:Math.max(t.numberOfChannels,n.numberOfChannels),sampleRate:t.sampleRate});for(let o=0;o<r.numberOfChannels;o++)r.copyToChannel(t.getChannelData(o),o,0),r.copyToChannel(n.getChannelData(o),o,t.length);return r}function dt(t,n,r){if(n>=t.length)return pe(t,r);if(!n)return pe(r,t);let o=new AudioBuffer({length:t.length+r.length,numberOfChannels:Math.max(t.numberOfChannels,r.numberOfChannels),sampleRate:t.sampleRate});for(let i=0;i<o.numberOfChannels;i++)o.copyToChannel(t.getChannelData(i).subarray(0,n),i,0),o.copyToChannel(r.getChannelData(i),i,n),o.copyToChannel(t.getChannelData(i).subarray(n),i,n+r.length);return o}var me={};mt(me,{add:()=>Mt,br:()=>Pt,clip:()=>Rt,cp:()=>Tt,del:()=>kt,join:()=>jt,mute:()=>Bt,norm:()=>Dt,src:()=>Nt});var Nt=async(t,n)=>{let r=await ut(n);return[await ft(r)]},Dt=t=>{let n=0,r=0;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);r+=f.length;for(let u=0;u<f.length;u++)n+=f[u]}let o=n/r;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);r+=f.length;for(let u=0;u<f.length;u++)f[u]-=o}let i=0;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);for(let u=0;u<f.length;u++)i=Math.max(Math.abs(f[u]),i)}let a=Math.max(1/i,1);for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);for(let u=0;u<f.length;u++)f[u]=Math.min(1,Math.max(-1,f[u]*a))}return t},Pt=(t,...n)=>{for(let r of n){let[o,i]=ne(t,X(r)),a=t[o];if(i>0&&i<a.length){let s=De(a,0,i),l=De(a,i);t.splice(o,1,s,l)}}return t};function jt(t,n){let[r,o]=ne(t,X(n));if(o)return console.warn("Wrong buffer offset",n);let i=t[r-1],a=t[r];return t.splice(r-1,2,pe(i,a)),t}function kt(t,n,r){if(!r)return t;let o=ne(t,X(n)),i=ne(t,X(n+r));!i[1]&&i[0]&&(i[0]-=1,i[1]=t[i[0]].length);let a=t[o[0]],s=t[i[0]],l=new AudioBuffer({length:o[1]+(s.length-i[1]),sampleRate:F,numberOfChannels:a.numberOfChannels});for(let f=0;f<a.numberOfChannels;f++){let u=0,h=l.getChannelData(f),c=a.getChannelData(f),p=s.getChannelData(f);for(u=0;u<o[1];u++)h[u]=c[u];for(let d=i[1];d<p.length;d++)h[u]=p[d],u++}return t.splice(o[0],i[0]-o[0]+1,l),t}function Bt(t,...n){for(let r of n){let[o,i]=r,[a,s]=ne(t,X(o));!s&&a&&(a-=1,s=t[a].length);let l=new AudioBuffer({length:k,numberOfChannels:t?.[0].numberOfChannels||1,sampleRate:t?.[0].sampleRate||F});t[a]=dt(t[a],s,l)}return t}var Rt=(t,n,r)=>{},Mt=(t,n,r)=>{},Tt=(t,n,r,o)=>{},ne=(t,n)=>{if(n===0)return[0,0];var r=0,o;for(let i=0;i<t.length;i++){if(o=r+t[i].length,n<o)return[i,n-r];r=o}return[t.length-1,t[t.length-1].length]};var Pe=document.querySelector(".waveplay"),$=Pe.querySelector(".w-wavearea"),E=Pe.querySelector(".w-playback"),ve=[],_t=new URL(location),M=[],D=Je(Pe,{loading:!1,recording:!1,playing:!1,selecting:!1,startFrame:0,volume:1,error:null,segments:[],lineWidth:215,isMouseDown:!1,handleCaret(t){D.startFrame=Y(E.currentTime=Ne(A().start))},async handleEnter(t){let n=A();if(!n.startNode.dataset.id)throw Error("Segment id is not found, strange");(M.at(-1)[0]==="br"?M.pop():["br"]).push(n.start),await re(["br",n.start]),A(n.start,n.start,1)},async handleDelete(t){let n=A();if(!n.startNode.dataset.id)throw Error("Segment id is not found, strange");let o=n.end-n.start,i=n.start-(t.key==="Delete"?0:1);if(!(i<0&&!o))if(!n.startNodeOffset&&n.collapsed)await re(["join",n.start]),A(n.start);else{let a=o?["del",n.start,o]:["del",i,1];M.push(a),await re(a),A(i)}},async handleSpace(t){console.log("space");let n=A();(M.at(-1)[0]==="mute"?M.pop():["mute"]).push([n.start,1]),await re(["mute",[n.start,1]]),A(n.start+1)},timeChange(t){document.activeElement!==$&&(A(D.startFrame=Y(E.currentTime)),$.focus())},play(t){D.playing=!0;let n=A();n||(n=A(0));let r=n.start,o=n.collapsed?Y(E.duration):n.end,i,a=()=>{let s=Y(E.currentTime)-D.startFrame,l=D.startFrame+s;D.isMouseDown||A(l),o&&l>=o?E.pause():i=requestAnimationFrame(a)};return a(),$.focus(),()=>{D.playing=!1,cancelAnimationFrame(i),i=null,n.start!==n.end&&A(r,o),E.currentTime>=E.duration&&A(lt(E.duration).length),$.focus()}},timecode(t){let n=Ne(t);return`${Math.floor(n/60).toFixed(0)}:${(n%60).toFixed(0).padStart(2,0)}`}}),A=(t,n,r=0)=>{let o=window.getSelection();if(t!=null){t=Math.max(0,t),n==null&&(n=t);let u,h;o.removeAllRanges();let c=new Range,p=t;for(u=$.firstChild;p+r>u.firstChild.data.length;)p-=u.firstChild.data.length,u=u.nextSibling;c.setStart(u.firstChild,p);let d=n;for(h=$.firstChild;d+r>h.firstChild.data.length;)d-=h.firstChild.data.length,h=h.nextSibling;return c.setEnd(h.firstChild,d),o.addRange(c),{start:t,startNode:u,end:n,endNode:h,startNodeOffset:p,endNodeOffset:d,collapsed:o.isCollapsed}}if(!o.anchorNode||o.anchorNode.parentNode.parentNode!==$)return;t=o.anchorOffset,n=o.focusOffset;let i=o.anchorNode.parentNode;for(;i=i.previousSibling;)t+=i.firstChild.data.length;for(i=o.focusNode.parentNode;i=i.previousSibling;)n+=i.firstChild.data.length;let a=o.anchorNode.parentNode,s=o.anchorOffset,l=o.focusNode.parentNode,f=o.focusOffset;return t>n&&([n,l,f,t,a,s]=[t,a,s,n,l,f]),{start:t,startNode:a,startNodeOffset:s,end:n,endNode:l,endNodeOffset:f,collapsed:o.isCollapsed}},pt=["https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg"];async function Lt(){D.loading=!0;try{for(let[t,n]of _t.searchParams)console.log(t,n);if(!M.length){let t=pt[Math.floor(Math.random()*pt.length)];M.push(["src",t],["norm"])}await re(...M)}catch(t){console.error(t),D.error=t.message}D.loading=!1}async function re(...t){console.log("Apply ops",t);for(let[n,...r]of t){if(!me[n])throw Error("Unknown operation `"+n+"`");ve=await me[n]?.(ve,...r)}It(ve),Ut(ve)}var It=t=>{let n=[],r=0;for(let o of t){let i=ht(o);i=new String(i.replaceAll("\u0100"," ")),i.offset=r,r+=i.length,n.push(i)}D.segments=n},Ut=async t=>{URL.revokeObjectURL(E.src);let n=await ct(...t),r=new Blob([n],{type:"audio/wav"}),o=E.currentTime,i=E.src=URL.createObjectURL(r);E.currentTime=o};Lt();
//# sourceMappingURL=waveplay.js.map
