import{b as ct}from"./chunk-YFDESRXI.js";function ee(){throw new Error("Cycle detected")}function te(){if(D>1)D--;else{for(var e,t=!1;H!==void 0;){var r=H;for(H=void 0,he++;r!==void 0;){var i=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Be(r))try{r.c()}catch(o){t||(e=o,t=!0)}r=i}}if(he=0,D--,t)throw e}}function Pe(e){if(D>0)return e();D++;try{return e()}finally{te()}}var v=void 0,H=void 0,D=0,he=0,Q=0;function je(e){if(v!==void 0){var t=e.n;if(t===void 0||t.t!==v)return t={i:0,S:e,p:v.s,n:void 0,t:v,e:void 0,x:void 0,r:t},v.s!==void 0&&(v.s.n=t),v.s=t,e.n=t,32&v.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=v.s,t.n=void 0,v.s.n=t,v.s=t),t}}function w(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}w.prototype.h=function(){return!0};w.prototype.S=function(e){this.t!==e&&e.e===void 0&&(e.x=this.t,this.t!==void 0&&(this.t.e=e),this.t=e)};w.prototype.U=function(e){if(this.t!==void 0){var t=e.e,r=e.x;t!==void 0&&(t.x=r,e.e=void 0),r!==void 0&&(r.e=t,e.x=void 0),e===this.t&&(this.t=r)}};w.prototype.subscribe=function(e){var t=this;return pe(function(){var r=t.value,i=32&this.f;this.f&=-33;try{e(r)}finally{this.f|=i}})};w.prototype.valueOf=function(){return this.value};w.prototype.toString=function(){return this.value+""};w.prototype.peek=function(){return this.v};Object.defineProperty(w.prototype,"value",{get:function(){var e=je(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){he>100&&ee(),this.v=e,this.i++,Q++,D++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{te()}}}});function ke(e){return new w(e)}function Be(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function _e(e){for(var t=e.s;t!==void 0;t=t.n){var r=t.S.n;if(r!==void 0&&(t.r=r),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Re(e){for(var t=e.s,r=void 0;t!==void 0;){var i=t.p;t.i===-1?(t.S.U(t),i!==void 0&&(i.n=t.n),t.n!==void 0&&(t.n.p=i)):r=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=i}e.s=r}function _(e){w.call(this,void 0),this.x=e,this.s=void 0,this.g=Q-1,this.f=4}(_.prototype=new w).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Q))return!0;if(this.g=Q,this.f|=1,this.i>0&&!Be(this))return this.f&=-2,!0;var e=v;try{_e(this),v=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return v=e,Re(this),this.f&=-2,!0};_.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}w.prototype.S.call(this,e)};_.prototype.U=function(e){if(this.t!==void 0&&(w.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};_.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};_.prototype.peek=function(){if(this.h()||ee(),16&this.f)throw this.v;return this.v};Object.defineProperty(_.prototype,"value",{get:function(){1&this.f&&ee();var e=je(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function Le(e){return new _(e)}function Me(e){var t=e.u;if(e.u=void 0,typeof t=="function"){D++;var r=v;v=void 0;try{t()}catch(i){throw e.f&=-2,e.f|=8,de(e),i}finally{v=r,te()}}}function de(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,Me(e)}function ht(e){if(v!==this)throw new Error("Out-of-order effect");Re(this),v=e,this.f&=-2,8&this.f&&de(this),te()}function X(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}X.prototype.c=function(){var e=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{e()}};X.prototype.S=function(){1&this.f&&ee(),this.f|=1,this.f&=-9,Me(this),_e(this),D++;var e=v;return v=this,ht.bind(this,e)};X.prototype.N=function(){2&this.f||(this.f|=2,this.o=H,H=this)};X.prototype.d=function(){this.f|=8,1&this.f||de(this)};function pe(e){var t=new X(e);try{t.c()}catch(r){throw t.d(),r}return t.d.bind(t)}Symbol.observable||=Symbol("observable");var Ie=e=>e&&!!(e[Symbol.observable]||e[Symbol.asyncIterator]||e.call&&e.set||e.subscribe||e.then),dt=new FinalizationRegistry(e=>e.call?.()),pt=e=>e&&(()=>e.unsubscribe?.()),Te=(e,t,r,i,o,n)=>e&&(n=pt((e[Symbol.observable]?.()||e).subscribe?.(t,r,i))||e.set&&e.call?.(o,t)||(e.then?.(a=>(!o&&t(a),i?.()),r)||(async a=>{try{for await(a of e){if(o)return;t(a)}i?.()}catch(s){r?.(s)}})())&&(a=>o=1),dt.register(e,n),n);var vt=e=>e&&e.peek,ve=e=>e&&e[Fe],Fe=Symbol("signal-struct");S.isStruct=ve;function S(e,t){if(ve(e)&&!t)return e;if(re(e)){let r=Object.create(t||Object.getPrototypeOf(e)),i={},o=Object.getOwnPropertyDescriptors(e);for(let n in o){let a=o[n];if(a.get){let s=i[n]=Le(a.get.bind(r));Object.defineProperty(r,n,{get(){return s.value},set:a.set?.bind(r),configurable:!1,enumerable:!0})}else{let s=a.value,u=Ie(s),l=i[n]=vt(s)?s:ke(u?void 0:re(s)?Object.seal(S(s)):Array.isArray(s)?S(s):s);u&&Te(s,c=>l.value=c),Object.defineProperty(r,n,{get(){return l.value},set(c){if(re(c)){if(re(l.value))try{Object.assign(l.value,c);return}catch{}l.value=Object.seal(S(c))}else Array.isArray(c)?l.value=S(c):l.value=c},enumerable:!0,configurable:!1})}}return Object.defineProperty(r,Fe,{configurable:!1,enumerable:!1,value:!0}),r}return Array.isArray(e)&&!ve(e[0])?e.map(r=>S(r)):e}function re(e){return e&&e.constructor===Object}var F=(e,t,r,i=null)=>{let o=0,n,a,s,u=r.length,l=t.length,{remove:c,same:f,insert:d,replace:h}=F;for(;o<u&&o<l&&f(t[o],r[o]);)o++;for(;o<u&&o<l&&f(r[u-1],t[l-1]);)i=r[--l,--u];if(o==l)for(;o<u;)d(i,r[o++],e);else{for(n=t[o];o<u;)s=r[o++],a=n?n.nextSibling:i,f(n,s)?n=a:o<u&&f(r[o],a)?(h(n,s,e),n=a):d(n,s,e);for(;!f(n,i);)a=n.nextSibling,c(n,e),n=a}return r};F.same=(e,t)=>e==t;F.replace=(e,t,r)=>r.replaceChild(t,e);F.insert=(e,t,r)=>r.insertBefore(t,e);F.remove=(e,t)=>t.removeChild(e);var Ue=F;var U={},mt={},yt={},We=e=>e===null?mt:e===void 0?yt:typeof e=="number"||e instanceof Number?U[e]||(U[e]=new Number(e)):typeof e=="string"||e instanceof String?U[e]||(U[e]=new String(e)):typeof e=="boolean"||e instanceof Boolean?U[e]||(U[e]=new Boolean(e)):e;var W={},x={};W.if=(e,t)=>{let r=document.createTextNode(""),i=[b(e,t,":if")],o=[e],n=e;for(;(n=e.nextElementSibling)&&n.hasAttribute(":else");)n.removeAttribute(":else"),(t=n.getAttribute(":if"))?(n.removeAttribute(":if"),n.remove(),o.push(n),i.push(b(e,t,":else :if"))):(n.remove(),o.push(n),i.push(()=>1));return e.replaceWith(n=r),a=>{let s=i.findIndex(u=>u(a));o[s]!=n&&((n[Ke]||n).replaceWith(n=o[s]||r),R(n,a))}};W.with=(e,t,r)=>{let i=b(e,t,"with");R(e,S(i(r),r))};var Ke=Symbol(":each");W.each=(e,t)=>{let r=gt(t);if(!r)return ne(new Error,e,t);let i=e[Ke]=document.createTextNode("");e.replaceWith(i);let o=b(e,r[2],":each"),n=e.getAttribute(":key"),a=n?b(null,n):null;e.removeAttribute(":key");let s=new WeakMap,u=new WeakMap,l=[];return c=>{let f=o(c);f?typeof f=="number"?f=Array.from({length:f},(p,g)=>[g,g+1]):Array.isArray(f)?f=f.map((p,g)=>[g+1,p]):typeof f=="object"?f=Object.entries(f):ne(Error("Bad list value"),e,t,":each",f):f=[];let d=[],h=[];for(let[p,g]of f){let C,y,m=a?.({[r[0]]:g,[r[1]]:p});bt(m)&&(m=We(m)),m==null?C=e.cloneNode(!0):(C=u.get(m))||u.set(m,C=e.cloneNode(!0)),d.push(C),m==null||!(y=s.get(m))?(y=S({[r[0]]:g,[r[1]]:p},c),m!=null&&s.set(m,y)):y[r[0]]=g,h.push(y)}Ue(i.parentNode,l,d,i),l=d;for(let p=0;p<d.length;p++)R(d[p],h[p])}};function gt(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,i=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,o=e.match(i);if(!o)return;let n=o[2].trim(),a=o[1].replace(r,"").trim(),s=a.match(t);return s?[a.replace(t,"").trim(),s[1].trim(),n]:[a,"",n]}x.ref=(e,t,r)=>{r[t]=e};x.id=(e,t)=>{let r=b(e,t,":id"),i=o=>e.id=o||o===0?o:"";return o=>i(r(o))};x.class=(e,t)=>{let r=b(e,t,":class"),i=e.className;return o=>{let n=r(o);e.className=i+typeof n=="string"?n:(Array.isArray(n)?n:Object.entries(n).map(([a,s])=>s?a:"")).filter(Boolean).join(" ")}};x.style=(e,t)=>{let r=b(e,t,":style"),i=e.getAttribute("style")||"";return i.endsWith(";")||(i+="; "),o=>{let n=r(o);if(typeof n=="string")e.setAttribute("style",i+n);else for(let a in n)e.style[a]=n[a]}};x.text=(e,t)=>{let r=b(e,t,":text");return i=>{let o=r(i);e.textContent=o??""}};x.value=(e,t)=>{let r=b(e,t,":value"),i,o,n=e.type==="text"||e.type===""?a=>e.setAttribute("value",e.value=a??""):e.tagName==="TEXTAREA"||e.type==="text"||e.type===""?a=>(i=e.selectionStart,o=e.selectionEnd,e.setAttribute("value",e.value=a??""),i&&e.setSelectionRange(i,o)):e.type==="checkbox"?a=>(e.value=a?"on":"",ie(e,"checked",a)):e.type==="select-one"?a=>{for(let s in e.options)s.removeAttribute("selected");e.value=a,e.selectedOptions[0]?.setAttribute("selected","")}:a=>e.value=a;return a=>n(r(a))};x.on=(e,t)=>{let r=b(e,t,":on");return i=>{let o=r(i);for(let n in o)Ve(e,n,o[n]);return()=>{for(let n in o)Ze(e,n,o[n])}}};var qe=Symbol("stop"),Ve=(e,t,r)=>{if(t.indexOf("..")<0)e.addEventListener(t,r);else{let i=t.split("..").map(n=>n.startsWith("on")?n.slice(2):n),o=(n,a=0)=>{let s=u=>{e.removeEventListener(i[a],s),typeof(n=n.call(e,u))!="function"&&(n=()=>{}),++a<i.length?o(n,a):r[qe]||o(r)};e.addEventListener(i[a],s)};o(r)}},Ze=(e,t,r)=>{t.indexOf("..")>=0&&(r[qe]=!0),e.removeEventListener(t,r)};x.data=(e,t)=>{let r=b(e,t,":data");return i=>{let o=r(i);for(let n in o)e.dataset[n]=o[n]}};x.aria=(e,t)=>{let r=b(e,t,":aria"),i=o=>{for(let n in o)ie(e,"aria-"+ze(n),o[n]==null?null:o[n]+"")};return o=>i(r(o))};x[""]=(e,t)=>{let r=b(e,t,":");if(r)return i=>{let o=r(i);for(let n in o)ie(e,ze(n),o[n])}};var Ye=(e,t,r,i)=>{let o=i.startsWith("on")&&i.slice(2),n=b(e,t,":"+i);if(n)return o?a=>{let s=n(a);if(s)return Ve(e,o,s),()=>Ze(e,o,s)}:a=>ie(e,i,n(a))},ie=(e,t,r)=>{r==null||r===!1?e.removeAttribute(t):e.setAttribute(t,r===!0?"":typeof r=="number"||typeof r=="string"?r:"")},$e={};function b(e,t,r){let i=$e[t];if(!i){let o=/^[\n\s]*if.*\(.*\)/.test(t)||/^(let|const)\s/.test(t)?`(() => { ${t} })()`:t;try{i=$e[t]=new Function("__scope",`with (__scope) { return ${o} };`)}catch(n){return ne(n,e,t,r)}}return o=>{let n;try{n=i.call(e,o)}catch(a){return ne(a,e,t,r)}return n}}function ne(e,t,r,i){Object.assign(e,{element:t,expression:r}),console.warn(`\u2234 ${e.message}

${i}=${r?`"${r}"

`:""}`,t),setTimeout(()=>{throw e},0)}function ze(e){return e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,t=>"-"+t.toLowerCase())}function bt(e){return typeof e=="string"||typeof e=="boolean"||typeof e=="number"}var G=new WeakMap;function R(e,t){if(!e.children)return;if(G.has(e)){let n=G.get(e);return Pe(()=>Object.assign(n,t)),n}let r=S(t||{}),i=[],o=(n,a=n.parentNode)=>{for(let s in W){let u=":"+s;if(n.hasAttribute?.(u)){let l=n.getAttribute(u);if(n.removeAttribute(u),!l)continue;if(i.push(W[s](n,l,r,s)),G.has(n)||n.parentNode!==a)return!1}}if(n.attributes)for(let s=0;s<n.attributes.length;){let u=n.attributes[s];if(u.name[0]!==":"){s++;continue}n.removeAttribute(u.name);let l=u.value;if(!l)continue;let c=u.name.slice(1).split(":");for(let f of c){let d=x[f]||Ye;if(i.push(d(n,l,r,f)),G.has(n)||n.parentNode!==a)return!1}}for(let s=0,u;u=n.children[s];s++)o(u,n)===!1&&s--};o(e);for(let n of i)if(n){let a;pe(()=>{typeof a=="function"&&a(),a=n(r)})}return Object.seal(r),G.set(e,r),r}var He=R;var Qe=function(){function e(){}return e.prototype.then=function(t,r){let i=new e,o=this.s;if(o){let n=1&o?t:r;if(n){try{A(i,1,n(this.v))}catch(a){A(i,2,a)}return i}return this}return this.o=function(n){try{let a=n.v;1&n.s?A(i,1,t?t(a):a):r?A(i,1,r(a)):A(i,2,a)}catch(a){A(i,2,a)}},i},e}();function A(e,t,r){if(!e.s){if(r instanceof Qe){if(!r.s)return void(r.o=A.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(A.bind(null,e,t),A.bind(null,e,2));e.s=t,e.v=r;let i=e.o;i&&i(e)}}var wt=0,K=typeof WeakMap=="function"?WeakMap:function(){var e=typeof Symbol=="function"?Symbol(0):"__weak$"+ ++wt;this.set=function(t,r){t[e]=r},this.get=function(t){return t[e]}};function be(e,t){return new Promise(function(r,i){e.onsuccess=function(){var o=e.result;t&&(o=t(o)),r(o)},e.onerror=function(){i(e.error)}})}function et(e,t){return be(e.openCursor(t),function(r){return r?[r.key,r.value]:[]})}function Xe(e){return new Promise(function(t,r){e.oncomplete=function(){t()},e.onabort=function(){r(e.error)},e.onerror=function(){r(e.error)}})}function me(e){if(!function(t){return!!(typeof t=="number"||typeof t=="string"||typeof t=="object"&&t&&(Array.isArray(t)||"setUTCFullYear"in t||typeof ArrayBuffer=="function"&&ArrayBuffer.isView(t)||"byteLength"in t&&"length"in t))}(e))throw Error("kv-storage: The given value is not allowed as a key")}var tt={};function Ge(e,t){return et(e,rt(t))}function rt(e){return e===tt?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(e,!0)}var nt=new K,ae=new K,se=new K,it=new K,oe=function(){};function Je(e,t){return t(function(r,i){try{let l=function(){return ae.set(e,n),se.set(e,void 0),{value:s,done:n===void 0}};var o=ae.get(e);if(o===void 0)return Promise.resolve({value:void 0,done:!0});var n,a,s,u=function(c,f){var d,h=-1;e:{for(var p=0;p<f.length;p++){var g=f[p][0];if(g){var C=g();if(C&&C.then)break e;if(C===c){h=p;break}}else h=p}if(h!==-1){do{for(var y=f[h][1];!y;)y=f[++h][1];var m=y();if(m&&m.then){d=!0;break e}var Ne=f[h][2];h++}while(Ne&&!Ne());return m}}let Y=new Qe,J=A.bind(null,Y,2);return(d?m.then(ce):C.then(function T(k){for(;;){if(k===c){h=p;break}if(++p===f.length){if(h!==-1)break;return void A(Y,1,z)}if(g=f[p][0]){if((k=g())&&k.then)return void k.then(T).then(void 0,J)}else h=p}do{for(var B=f[h][1];!B;)B=f[++h][1];var z=B();if(z&&z.then)return void z.then(ce).then(void 0,J);var De=f[h][2];h++}while(De&&!De());A(Y,1,z)})).then(void 0,J),Y;function ce(T){for(;;){var k=f[h][2];if(!k||k())break;for(var B=f[++h][1];!B;)B=f[++h][1];if((T=B())&&T.then)return void T.then(ce).then(void 0,J)}A(Y,1,T)}}(it.get(e),[[function(){return"keys"},function(){return Promise.resolve(function(c,f){return et(c,rt(f)).then(function(d){return d[0]})}(i,o)).then(function(c){s=n=c})}],[function(){return"values"},function(){return Promise.resolve(Ge(i,o)).then(function(c){var f;n=(f=c)[0],s=a=f[1]})}],[function(){return"entries"},function(){return Promise.resolve(Ge(i,o)).then(function(c){var f;a=(f=c)[1],s=(n=f[0])===void 0?void 0:[n,a]})}]]);return Promise.resolve(u&&u.then?u.then(l):l())}catch(l){return Promise.reject(l)}})}function ye(e,t){var r=new oe;return it.set(r,e),nt.set(r,t),ae.set(r,tt),se.set(r,void 0),r}oe.prototype.return=function(){ae.set(this,void 0)},oe.prototype.next=function(){var e=this,t=nt.get(this);if(!t)return Promise.reject(new TypeError("Invalid this value"));var r,i=se.get(this);return r=i!==void 0?i.then(function(){return Je(e,t)}):Je(this,t),se.set(this,r),r},typeof Symbol=="function"&&Symbol.asyncIterator&&(oe.prototype[Symbol.asyncIterator]=function(){return this});var $=function(e,t,r){try{return P.get(e)===null&&function(i){var o=we.get(i);P.set(i,new Promise(function(n,a){var s=self.indexedDB.open(o,1);s.onsuccess=function(){var u=s.result;(function(l,c,f){if(l.objectStoreNames.length!==1||l.objectStoreNames[0]!==L)return f(ge(c)),!1;var d=l.transaction(L,"readonly").objectStore(L);return!(d.autoIncrement||d.keyPath||d.indexNames.length)||(f(ge(c)),!1)})(u,o,a)&&(u.onclose=function(){P.set(i,null)},u.onversionchange=function(){u.close(),P.set(i,null)},n(u))},s.onerror=function(){return a(s.error)},s.onupgradeneeded=function(){try{s.result.createObjectStore(L)}catch(u){a(u)}}}))}(e),Promise.resolve(P.get(e)).then(function(i){var o=i.transaction(L,t),n=o.objectStore(L);return r(o,n)})}catch(i){return Promise.reject(i)}},we=new K,P=new K,L="store",N=function(e){var t="kv-storage:"+e;P.set(this,null),we.set(this,t),this.backingStore={database:t,store:L,version:1}};function ge(e){return new Error('kv-storage: database "'+e+'" corrupted')}N.prototype.set=function(e,t){try{return me(e),$(this,"readwrite",function(r,i){return t===void 0?i.delete(e):i.put(t,e),Xe(r)})}catch(r){return Promise.reject(r)}},N.prototype.get=function(e){try{return me(e),$(this,"readonly",function(t,r){return be(r.get(e))})}catch(t){return Promise.reject(t)}},N.prototype.delete=function(e){try{return me(e),$(this,"readwrite",function(t,r){return r.delete(e),Xe(t)})}catch(t){return Promise.reject(t)}},N.prototype.clear=function(){try{let o=function(){function n(){return be(self.indexedDB.deleteDatabase(we.get(e)))}var a=function(){if(t){try{t.close()}catch{}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return a&&a.then?a.then(n):n()};var e=this,t,r=P.get(e),i=function(){if(r!==null){let a=function(){P.set(e,null)};var n=function(s,u){try{var l=Promise.resolve(r).then(function(c){t=c})}catch{return}return l&&l.then?l.then(void 0,function(){}):l}();return n&&n.then?n.then(a):a()}}();return i&&i.then?i.then(o):o()}catch(o){return Promise.reject(o)}},N.prototype.keys=function(){var e=this;return ye("keys",function(t){return $(e,"readonly",t)})},N.prototype.values=function(){var e=this;return ye("values",function(t){return $(e,"readonly",t)})},N.prototype.entries=function(){var e=this;return ye("entries",function(t){return $(e,"readonly",t)})},typeof Symbol=="function"&&Symbol.asyncIterator&&(N.prototype[Symbol.asyncIterator]=N.prototype.entries);var At=new N("default");var q=44100,M=1024,V=e=>Math.floor(e*q/M),Ae=e=>e*M/q,ot=e=>Math.ceil(V(e)/M),le=e=>e*M,St=await(async()=>{let e=new Audio,t=OfflineAudioContext;return e.canPlayType("audio/ogg")||(t=(await import("./oggmented-bundle-PZW5FHYZ.js")).default.OggmentedAudioContext),new t({sampleRate:q,length:60*60*44100})})();async function at(e){console.time("fetch");let t=await fetch(e);if(!t.ok)throw new Error(`HTTP error: status=${t.status}`);let r=await t.arrayBuffer();return console.timeEnd("fetch"),r}async function st(e,t){console.time("decode");let r;try{r=await St.decodeAudioData(e)}catch(i){console.log(i)}return console.timeEnd("decode"),r}async function lt(...e){console.time("wav encode");let t=q,r=32,i=e[0].numberOfChannels,o=0;for(let h of e)o+=h.length;let n=new ArrayBuffer(44+o*i*(r>>3)),a=new DataView(n),s=0,u=h=>a.setUint8(s++,h),l=h=>(a.setUint16(s,h,!0),s+=2),c=h=>(a.setUint32(s,h,!0),s+=4),f=h=>{for(var p=0;p<h.length;++p)u(h.charCodeAt(p))};f("RIFF"),c(n.byteLength-8),f("WAVE"),f("fmt "),c(16),l(3),l(i),c(t),c(t*i*(r>>3)),l(i*(r>>3)),l(r),f("data"),c(n.byteLength-44);let d=new Float32Array(n,s);for(let h of e){let p=h.numberOfChannels,g=Array(p),C=h.length;for(let y=0;y<p;++y)g[y]=h.getChannelData(y);for(let y=0;y<C;++y)for(let m=0;m<p;++m)d[s++]=g[m][y]}return console.timeEnd("wav encode"),n}function ut(e){if(!e)return"";if(e._wf&&e._wf_first===e.getChannelData(0)[0])return e._wf;console.time("to waveform string");let t=e.getChannelData(0),r="",i=2;for(let o=0,n=M;o<t.length;){let a=0,s=0;for(;o<n;o++)a+=o>=t.length?0:t[o]**2;let u=Math.sqrt(a/M),l=Math.min(100,Math.ceil(u*100*i));r+=String.fromCharCode(256+l),n+=M}return e._wf=r,e._wf_first=e.getChannelData(0)[0],console.timeEnd("to waveform string"),r}function Se(e,t=0,r=e.length){let i=new AudioBuffer({length:r-t,numberOfChannels:e.numberOfChannels,sampleRate:e.sampleRate});for(var o=0;o<i.numberOfChannels;o++)i.copyToChannel(e.getChannelData(o).subarray(t,r),o,0);return i}var ue={};ct(ue,{add:()=>Pt,br:()=>Ot,clip:()=>Dt,cp:()=>jt,del:()=>Et,insert:()=>kt,mute:()=>Nt,norm:()=>Ct,src:()=>xt});var xt=async(e,t)=>{let r=await at(t);return[await st(r)]},Ct=e=>{let t=0,r=0;for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);r+=u.length;for(let l=0;l<u.length;l++)t+=u[l]}let i=t/r;for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);r+=u.length;for(let l=0;l<u.length;l++)u[l]-=i}let o=0;for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);for(let l=0;l<u.length;l++)o=Math.max(Math.abs(u[l]),o)}let n=Math.max(1/o,1);for(let a of e)for(let s=0;s<a.numberOfChannels;s++){let u=a.getChannelData(s);for(let l=0;l<u.length;l++)u[l]=Math.min(1,Math.max(-1,u[l]*n))}return e},Ot=(e,...t)=>{for(let r of t){let[i,o]=xe(e,le(r)),n=e[i];if(o>0&&o<n.length){let a=Se(n,0,o),s=Se(n,o);e.splice(i,1,a,s)}}return e};function Et(e,t,r){if(!r)return e;let i=xe(e,le(t)),o=xe(e,le(t+r));!o[1]&&o[0]&&(o[0]-=1,o[1]=e[o[0]].length);let n=e[i[0]],a=e[o[0]],s=new AudioBuffer({length:i[1]+(a.length-o[1]),sampleRate:q,numberOfChannels:n.numberOfChannels});for(let u=0;u<n.numberOfChannels;u++){let l=0,c=s.getChannelData(u),f=n.getChannelData(u),d=a.getChannelData(u);for(l=0;l<i[1];l++)c[l]=f[l];for(let h=o[1];h<d.length;h++)c[l]=d[h],l++}return e.splice(i[0],o[0]-i[0]+1,s),e}function Nt(e,t=2){let r=Array.from({length:t},()=>new Float32Array(e));return create(r)}var Dt=(e,t,r)=>{},Pt=(e,t,r)=>{},jt=(e,t,r,i)=>{};function kt(e,t,r){for(var i=[],o,n=0;n<e.numberOfChannels;n++){i.push(o=new Float32Array(e.length+r.length));var a=e.getChannelData(n);o.set(a.subarray(0,t),0),o.set(r.getChannelData(n),t),o.set(a.subarray(t),t+r.length)}return create(i)}var xe=(e,t)=>{if(t===0)return[0,0];var r=0,i;for(let o=0;o<e.length;o++){if(i=r+e[o].length,t<i)return[o,t-r];r=i}return[e.length-1,e[e.length-1].length]};var Oe;document.addEventListener("mousedown",()=>Oe=!0);document.addEventListener("mouseup",()=>Oe=!1);var Ee=document.querySelector(".waveplay"),I=Ee.querySelector(".w-wavearea"),j=Ee.querySelector(".w-playback"),fe=[],Bt=new URL(location),Z=[],E=He(Ee,{loading:!1,recording:!1,playing:!1,selecting:!1,startFrame:0,volume:1,error:null,segments:[],wavURL:"",lineWidth:215,handleCaret(e){E.startFrame=V(j.currentTime=Ae(O().start))},async handleKey(e){if(!e.key.startsWith("Arrow")){if(e.preventDefault(),e.key==="Enter"){let t=O();if(!t.startNode.dataset.id)throw Error("Segment id is not found, strange");(Z.at(-1)[0]==="br"?Z.pop():["br"]).push(t.start),await Ce(["br",t.start]),O(t.start);return}if(e.key==="Backspace"||e.key==="Delete"){let t=O();if(!t.startNode.dataset.id)throw Error("Segment id is not found, strange");let i=t.end-t.start,o=t.start-(e.key==="Delete"?0:1);if(o<0&&!i)return;let n=i?["del",t.start,i]:["del",o,1];Z.push(n),await Ce(n),O(o)}}},timeChange(e){document.activeElement!==I&&(O(E.startFrame=V(j.currentTime)),I.focus())},play(e){E.playing=!0;let t=O();t||(t=O(0));let r=t.start,i=t.collapsed?V(j.duration):t.end,o,n=()=>{let a=V(j.currentTime)-E.startFrame,s=E.startFrame+a;Oe||O(s),i&&s>=i?j.pause():o=requestAnimationFrame(n)};return n(),I.focus(),()=>{E.playing=!1,cancelAnimationFrame(o),o=null,t.start!==t.end&&O(r,i),j.currentTime>=j.duration&&O(ot(j.duration).length),I.focus()}},timecode(e){let t=Ae(e);return`${Math.floor(t/60).toFixed(0)}:${(t%60).toFixed(0).padStart(2,0)}`}}),O=(e,t)=>{let r=window.getSelection();if(e!=null){e=Math.max(0,e),t==null&&(t=e);let u,l;r.removeAllRanges();let c=new Range,f=e;for(u=I.firstChild;f>=u.firstChild.data.length;)f-=u.firstChild.data.length,u=u.nextSibling;c.setStart(u.firstChild,f);let d=t;for(l=I.firstChild;d>=l.firstChild.data.length;)d-=l.firstChild.data.length,l=l.nextSibling;return c.setEnd(l.firstChild,d),r.addRange(c),{start:e,startNode:u,end:t,endNode:l,startNodeOffset:f,endNodeOffset:d,collapsed:r.isCollapsed}}if(!r.anchorNode||r.anchorNode.parentNode.parentNode!==I)return;e=r.anchorOffset,t=r.focusOffset;let i=r.anchorNode.parentNode;for(;i=i.previousSibling;)e+=i.firstChild.data.length;for(i=r.focusNode.parentNode;i=i.previousSibling;)t+=i.firstChild.data.length;let o=r.anchorNode.parentNode,n=r.anchorOffset,a=r.focusNode.parentNode,s=r.focusOffset;return e>t&&([t,a,s,e,o,n]=[e,o,n,t,a,s]),{start:e,startNode:o,startNodeOffset:n,end:t,endNode:a,endNodeOffset:s,collapsed:r.isCollapsed}},ft=["https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg"];async function _t(){E.loading=!0;try{for(let[e,t]of Bt.searchParams)console.log(e,t);if(!Z.length){let e=ft[Math.floor(Math.random()*ft.length)];Z.push(["src",e],["norm"])}await Ce(...Z)}catch(e){console.error(e),E.error=e.message}E.loading=!1}async function Ce(...e){console.log("Apply ops",e);for(let[t,...r]of e){if(!ue[t])throw Error("Unknown operation `"+t+"`");fe=await ue[t]?.(fe,...r)}Rt(fe),Lt(fe)}var Rt=e=>{let t=[];for(let r of e){let i=ut(r);i=i.replaceAll("\u0100"," "),t.push(i)}E.segments=t},Lt=async e=>{let t=await lt(...e),r=new Blob([t],{type:"audio/wav"}),i=URL.createObjectURL(r);return E.wavURL=i};_t();
//# sourceMappingURL=waveplay.js.map
