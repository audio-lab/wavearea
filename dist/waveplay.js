import{b as dt}from"./chunk-YFDESRXI.js";function oe(){throw new Error("Cycle detected")}function ie(){if(P>1)P--;else{for(var t,n=!1;G!==void 0;){var r=G;for(G=void 0,ve++;r!==void 0;){var o=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&Re(r))try{r.c()}catch(i){n||(t=i,n=!0)}r=o}}if(ve=0,P--,n)throw t}}function je(t){if(P>0)return t();P++;try{return t()}finally{ie()}}var v=void 0,G=void 0,P=0,ve=0,re=0;function Pe(t){if(v!==void 0){var n=t.n;if(n===void 0||n.t!==v)return n={i:0,S:t,p:v.s,n:void 0,t:v,e:void 0,x:void 0,r:n},v.s!==void 0&&(v.s.n=n),v.s=n,t.n=n,32&v.f&&t.S(n),n;if(n.i===-1)return n.i=0,n.n!==void 0&&(n.n.p=n.p,n.p!==void 0&&(n.p.n=n.n),n.p=v.s,n.n=void 0,v.s.n=n,v.s=n),n}}function C(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}C.prototype.h=function(){return!0};C.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)};C.prototype.U=function(t){if(this.t!==void 0){var n=t.e,r=t.x;n!==void 0&&(n.x=r,t.e=void 0),r!==void 0&&(r.e=n,t.x=void 0),t===this.t&&(this.t=r)}};C.prototype.subscribe=function(t){var n=this;return ge(function(){var r=n.value,o=32&this.f;this.f&=-33;try{t(r)}finally{this.f|=o}})};C.prototype.valueOf=function(){return this.value};C.prototype.toString=function(){return this.value+""};C.prototype.peek=function(){return this.v};Object.defineProperty(C.prototype,"value",{get:function(){var t=Pe(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){ve>100&&oe(),this.v=t,this.i++,re++,P++;try{for(var n=this.t;n!==void 0;n=n.x)n.t.N()}finally{ie()}}}});function Be(t){return new C(t)}function Re(t){for(var n=t.s;n!==void 0;n=n.n)if(n.S.i!==n.i||!n.S.h()||n.S.i!==n.i)return!0;return!1}function Me(t){for(var n=t.s;n!==void 0;n=n.n){var r=n.S.n;if(r!==void 0&&(n.r=r),n.S.n=n,n.i=-1,n.n===void 0){t.s=n;break}}}function Te(t){for(var n=t.s,r=void 0;n!==void 0;){var o=n.p;n.i===-1?(n.S.U(n),o!==void 0&&(o.n=n.n),n.n!==void 0&&(n.n.p=o)):r=n,n.S.n=n.r,n.r!==void 0&&(n.r=void 0),n=o}t.s=r}function _(t){C.call(this,void 0),this.x=t,this.s=void 0,this.g=re-1,this.f=4}(_.prototype=new C).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===re))return!0;if(this.g=re,this.f|=1,this.i>0&&!Re(this))return this.f&=-2,!0;var t=v;try{Me(this),v=this;var n=this.x();(16&this.f||this.v!==n||this.i===0)&&(this.v=n,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return v=t,Te(this),this.f&=-2,!0};_.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var n=this.s;n!==void 0;n=n.n)n.S.S(n)}C.prototype.S.call(this,t)};_.prototype.U=function(t){if(this.t!==void 0&&(C.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var n=this.s;n!==void 0;n=n.n)n.S.U(n)}};_.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};_.prototype.peek=function(){if(this.h()||oe(),16&this.f)throw this.v;return this.v};Object.defineProperty(_.prototype,"value",{get:function(){1&this.f&&oe();var t=Pe(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function _e(t){return new _(t)}function Ie(t){var n=t.u;if(t.u=void 0,typeof n=="function"){P++;var r=v;v=void 0;try{n()}catch(o){throw t.f&=-2,t.f|=8,ye(t),o}finally{v=r,ie()}}}function ye(t){for(var n=t.s;n!==void 0;n=n.n)n.S.U(n);t.x=void 0,t.s=void 0,Ie(t)}function pt(t){if(v!==this)throw new Error("Out-of-order effect");Te(this),v=t,this.f&=-2,8&this.f&&ye(this),ie()}function J(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}J.prototype.c=function(){var t=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{t()}};J.prototype.S=function(){1&this.f&&oe(),this.f|=1,this.f&=-9,Ie(this),Me(this),P++;var t=v;return v=this,pt.bind(this,t)};J.prototype.N=function(){2&this.f||(this.f|=2,this.o=G,G=this)};J.prototype.d=function(){this.f|=8,1&this.f||ye(this)};function ge(t){var n=new J(t);try{n.c()}catch(r){throw n.d(),r}return n.d.bind(n)}Symbol.observable||=Symbol("observable");var Le=t=>t&&!!(t[Symbol.observable]||t[Symbol.asyncIterator]||t.call&&t.set||t.subscribe||t.then),mt=new FinalizationRegistry(t=>t.call?.()),vt=t=>t&&(()=>t.unsubscribe?.()),Fe=(t,n,r,o,i,a)=>t&&(a=vt((t[Symbol.observable]?.()||t).subscribe?.(n,r,o))||t.set&&t.call?.(i,n)||(t.then?.(s=>(!i&&n(s),o?.()),r)||(async s=>{try{for await(s of t){if(i)return;n(s)}o?.()}catch(l){r?.(l)}})())&&(s=>i=1),mt.register(t,a),a);var yt=t=>t&&t.peek,be=t=>t&&t[We],We=Symbol("signal-struct");x.isStruct=be;function x(t,n){if(be(t)&&!n)return t;if(ae(t)){let r=Object.create(n||Object.getPrototypeOf(t)),o={},i=Object.getOwnPropertyDescriptors(t);for(let a in i){let s=i[a];if(s.get){let l=o[a]=_e(s.get.bind(r));Object.defineProperty(r,a,{get(){return l.value},set:s.set?.bind(r),configurable:!1,enumerable:!0})}else{let l=s.value,f=Le(l),u=o[a]=yt(l)?l:Be(f?void 0:ae(l)?Object.seal(x(l)):Array.isArray(l)?x(l):l);f&&Fe(l,h=>u.value=h),Object.defineProperty(r,a,{get(){return u.value},set(h){if(ae(h)){if(ae(u.value))try{Object.assign(u.value,h);return}catch{}u.value=Object.seal(x(h))}else Array.isArray(h)?u.value=x(h):u.value=h},enumerable:!0,configurable:!1})}}return Object.defineProperty(r,We,{configurable:!1,enumerable:!1,value:!0}),r}if(Array.isArray(t)&&!be(t[0]))for(let r=0;r<t.length;r++)t[r]=x(t[r]);return t}function ae(t){return t&&t.constructor===Object}var $=(t,n,r,o=null)=>{let i=0,a,s,l,f=r.length,u=n.length,{remove:h,same:c,insert:p,replace:d}=$;for(;i<f&&i<u&&c(n[i],r[i]);)i++;for(;i<f&&i<u&&c(r[f-1],n[u-1]);)o=r[--u,--f];if(i==u)for(;i<f;)p(o,r[i++],t);else{for(a=n[i];i<f;)l=r[i++],s=a?a.nextSibling:o,c(a,l)?a=s:i<f&&c(r[i],s)?(d(a,l,t),a=s):p(a,l,t);for(;!c(a,o);)s=a.nextSibling,h(a,t),a=s}return r};$.same=(t,n)=>t==n;$.replace=(t,n,r)=>r.replaceChild(n,t);$.insert=(t,n,r)=>r.insertBefore(n,t);$.remove=(t,n)=>n.removeChild(t);var Ue=$;var K={},gt={},bt={},$e=t=>t===null?gt:t===void 0?bt:typeof t=="number"||t instanceof Number?K[t]||(K[t]=new Number(t)):typeof t=="string"||t instanceof String?K[t]||(K[t]=new String(t)):typeof t=="boolean"||t instanceof Boolean?K[t]||(K[t]=new Boolean(t)):t;var q={},O={};q.if=(t,n)=>{let r=document.createTextNode(""),o=[w(t,n,":if")],i=[t],a=t;for(;(a=t.nextElementSibling)&&a.hasAttribute(":else");)a.removeAttribute(":else"),(n=a.getAttribute(":if"))?(a.removeAttribute(":if"),a.remove(),i.push(a),o.push(w(t,n,":else :if"))):(a.remove(),i.push(a),o.push(()=>1));return t.replaceWith(a=r),s=>{let l=o.findIndex(f=>f(s));i[l]!=a&&((a[qe]||a).replaceWith(a=i[l]||r),I(a,s))}};q.with=(t,n,r)=>{let o=w(t,n,"with");I(t,x(o(r),r))};var qe=Symbol(":each");q.each=(t,n)=>{let r=wt(n);if(!r)return se(new Error,t,n);let o=t[qe]=document.createTextNode("");t.replaceWith(o);let i=w(t,r[2],":each"),a=t.getAttribute(":key"),s=a?w(null,a):null;t.removeAttribute(":key");let l=new WeakMap,f=new WeakMap,u=[];return h=>{let c=i(h);c?typeof c=="number"?c=Array.from({length:c},(m,b)=>[b,b+1]):Array.isArray(c)?c=c.map((m,b)=>[b+1,m]):typeof c=="object"?c=Object.entries(c):se(Error("Bad list value"),t,n,":each",c):c=[];let p=[],d=[];for(let[m,b]of c){let N,g,y=s?.({[r[0]]:b,[r[1]]:m});Ct(y)&&(y=$e(y)),y==null?N=t.cloneNode(!0):(N=f.get(y))||f.set(y,N=t.cloneNode(!0)),p.push(N),y==null||!(g=l.get(y))?(g=x({[r[0]]:b,[r[1]]:m},h),y!=null&&l.set(y,g)):g[r[0]]=b,d.push(g)}Ue(o.parentNode,u,p,o),u=p;for(let m=0;m<p.length;m++)I(p[m],d[m])}};function wt(t){let n=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,o=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=t.match(o);if(!i)return;let a=i[2].trim(),s=i[1].replace(r,"").trim(),l=s.match(n);return l?[s.replace(n,"").trim(),l[1].trim(),a]:[s,"",a]}O.ref=(t,n,r)=>{r[n]=t};O.id=(t,n)=>{let r=w(t,n,":id"),o=i=>t.id=i||i===0?i:"";return i=>o(r(i))};O.class=(t,n)=>{let r=w(t,n,":class"),o=t.className;return i=>{let a=r(i);t.className=o+typeof a=="string"?a:(Array.isArray(a)?a:Object.entries(a).map(([s,l])=>l?s:"")).filter(Boolean).join(" ")}};O.style=(t,n)=>{let r=w(t,n,":style"),o=t.getAttribute("style")||"";return o.endsWith(";")||(o+="; "),i=>{let a=r(i);if(typeof a=="string")t.setAttribute("style",o+a);else for(let s in a)t.style[s]=a[s]}};O.text=(t,n)=>{let r=w(t,n,":text");return o=>{let i=r(o);t.textContent=i??""}};O.data=(t,n)=>{let r=w(t,n,":data");return o=>{let i=r(o);for(let a in i)t.dataset[a]=i[a]}};O.aria=(t,n)=>{let r=w(t,n,":aria"),o=i=>{for(let a in i)le(t,"aria-"+Ye(a),i[a]==null?null:i[a]+"")};return i=>o(r(i))};O[""]=(t,n)=>{let r=w(t,n,":");if(r)return o=>{let i=r(o);for(let a in i)le(t,Ye(a),i[a])}};O.value=(t,n)=>{let r=w(t,n,":value"),o,i,a=t.type==="text"||t.type===""?s=>t.setAttribute("value",t.value=s??""):t.tagName==="TEXTAREA"||t.type==="text"||t.type===""?s=>(o=t.selectionStart,i=t.selectionEnd,t.setAttribute("value",t.value=s??""),o&&t.setSelectionRange(o,i)):t.type==="checkbox"?s=>(t.value=s?"on":"",le(t,"checked",s)):t.type==="select-one"?s=>{for(let l in t.options)l.removeAttribute("selected");t.value=s,t.selectedOptions[0]?.setAttribute("selected","")}:s=>t.value=s;return s=>a(r(s))};O.on=(t,n)=>{let r=w(t,n,":on");return o=>{let i=r(o);for(let a in i)ze(t,a,i[a]);return()=>{for(let a in i)He(t,a,i[a])}}};var Ze=(t,n,r,o)=>{let i=o.startsWith("on")&&o.slice(2),a=w(t,n,":"+o);if(a)return i?s=>{let l=a(s)||(()=>{});return ze(t,i,l),()=>He(t,i,l)}:s=>le(t,o,a(s))},Ve=Symbol("stop"),ze=(t,n,r)=>{let o=n.split("..").map(u=>u.startsWith("on")?u.slice(2):u),i={target:t,hooks:[],fn:r};o[0]=o[0].replace(/\.(\w+)?-?([\w]+)?/g,(u,h,c)=>(At[h]?.(i,c),""));let{target:a,hooks:s,fn:l,...f}=i;if(s.length){let u=l;l=h=>{for(let c of s)if(c(h)===!1)return!1;return u(h)}}if(o.length==1)a.addEventListener(o[0],l,f);else{let u=(h,c=0)=>{let p=d=>{a.removeEventListener(o[c],p),typeof(h=h.call(a,d))!="function"&&(h=()=>{}),++c<o.length?u(h,c):l[Ve]||u(l)};a.addEventListener(o[c],p,f)};u(l)}},He=(t,n,r)=>{n.indexOf("..")>=0&&(r[Ve]=!0),t.removeEventListener(n,r)},At={throttle(t,n){let{fn:r}=t;n=Number(n)||108;let o,i,a=()=>{o=!0,setTimeout(()=>{if(o=!1,i)return i=!1,a(),r(e)})};t.fn=s=>o?i=!0:(a(),r(s))},debounce(t,n){let{fn:r}=t;n=Number(n)||108;let o,i;t.fn=a=>{clearTimeout(o),i++,o=setTimeout(()=>{r(a),o=i=0},n)}},window(t){t.target=window},document(t){t.target=document},outside({target:t,hooks:n}){n.push(r=>{if(t.contains(r.target)||r.target.isConnected===!1||t.offsetWidth<1&&t.offsetHeight<1)return!1})},prevent({hooks:t}){t.push(n=>{n.preventDefault()})},stop({hooks:t}){t.push(n=>{n.stopPropagation()})},self({target:t,hooks:n}){n.push(r=>r.target===t)},once(t){t.once=!0},passive(t){t.passive=!0},capture(t){t.capture=!0},ctrl({hooks:t}){t.push(n=>n.key==="Control"||n.key==="Ctrl")},shift({hooks:t}){t.push(n=>n.key==="Shift")},alt({hooks:t}){t.push(n=>n.key==="Alt")},meta({hooks:t}){t.push(n=>n.key==="Meta")},arrow({hooks:t}){t.push(n=>n.key.startsWith("Arrow"))},enter({hooks:t}){t.push(n=>n.key==="Enter")},escape({hooks:t}){t.push(n=>n.key.startsWith("Esc"))},tab({hooks:t}){t.push(n=>n.key==="Tab")},space({hooks:t}){t.push(n=>n.key==="Space"||n.key===" ")},backspace({hooks:t}){t.push(n=>n.key==="Backspace")},delete({hooks:t}){t.push(n=>n.key==="Delete")},digit({hooks:t}){t.push(n=>/\d/.test(n.key))},letter({hooks:t}){t.push(n=>/[a-zA-Z]/.test(n.key))},character({hooks:t}){t.push(n=>/^\S$/.test(n.key))}},le=(t,n,r)=>{r==null||r===!1?t.removeAttribute(n):t.setAttribute(n,r===!0?"":typeof r=="number"||typeof r=="string"?r:"")},Ke={};function w(t,n,r){let o=Ke[n];if(!o){let i=/^[\n\s]*if.*\(.*\)/.test(n)||/^(let|const)\s/.test(n)?`(() => { ${n} })()`:n;try{o=Ke[n]=new Function("__scope",`with (__scope) { return ${i} };`)}catch(a){return se(a,t,n,r)}}return i=>{let a;try{a=o.call(t,i)}catch(s){return se(s,t,n,r)}return a}}function se(t,n,r,o){Object.assign(t,{element:n,expression:r}),console.warn(`\u2234 ${t.message}

${o}=${r?`"${r}"

`:""}`,n),setTimeout(()=>{throw t},0)}function Ye(t){return t.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,n=>"-"+n.toLowerCase())}function Ct(t){return typeof t=="string"||typeof t=="boolean"||typeof t=="number"}var Q=new WeakMap;function I(t,n){if(!t.children)return;if(Q.has(t)){let a=Q.get(t);return je(()=>Object.assign(a,n)),a}let r=x(n||{}),o=[],i=(a,s=a.parentNode)=>{for(let l in q){let f=":"+l;if(a.hasAttribute?.(f)){let u=a.getAttribute(f);if(a.removeAttribute(f),o.push(q[l](a,u,r,l)),Q.has(a)||a.parentNode!==s)return!1}}if(a.attributes)for(let l=0;l<a.attributes.length;){let f=a.attributes[l];if(f.name[0]!==":"){l++;continue}a.removeAttribute(f.name);let u=f.value,h=f.name.slice(1).split(":");for(let c of h){let p=O[c]||Ze;if(o.push(p(a,u,r,c)),Q.has(a)||a.parentNode!==s)return!1}}for(let l=0,f;f=a.children[l];l++)i(f,a)===!1&&l--};i(t);for(let a of o)if(a){let s;ge(()=>{typeof s=="function"&&s(),s=a(r)})}return Object.seal(r),Q.set(t,r),r}var Xe=I;var et=function(){function t(){}return t.prototype.then=function(n,r){let o=new t,i=this.s;if(i){let a=1&i?n:r;if(a){try{S(o,1,a(this.v))}catch(s){S(o,2,s)}return o}return this}return this.o=function(a){try{let s=a.v;1&a.s?S(o,1,n?n(s):s):r?S(o,1,r(s)):S(o,2,s)}catch(s){S(o,2,s)}},o},t}();function S(t,n,r){if(!t.s){if(r instanceof et){if(!r.s)return void(r.o=S.bind(null,t,n));1&n&&(n=r.s),r=r.v}if(r&&r.then)return void r.then(S.bind(null,t,n),S.bind(null,t,2));t.s=n,t.v=r;let o=t.o;o&&o(t)}}var St=0,V=typeof WeakMap=="function"?WeakMap:function(){var t=typeof Symbol=="function"?Symbol(0):"__weak$"+ ++St;this.set=function(n,r){n[t]=r},this.get=function(n){return n[t]}};function Se(t,n){return new Promise(function(r,o){t.onsuccess=function(){var i=t.result;n&&(i=n(i)),r(i)},t.onerror=function(){o(t.error)}})}function tt(t,n){return Se(t.openCursor(n),function(r){return r?[r.key,r.value]:[]})}function Ge(t){return new Promise(function(n,r){t.oncomplete=function(){n()},t.onabort=function(){r(t.error)},t.onerror=function(){r(t.error)}})}function we(t){if(!function(n){return!!(typeof n=="number"||typeof n=="string"||typeof n=="object"&&n&&(Array.isArray(n)||"setUTCFullYear"in n||typeof ArrayBuffer=="function"&&ArrayBuffer.isView(n)||"byteLength"in n&&"length"in n))}(t))throw Error("kv-storage: The given value is not allowed as a key")}var nt={};function Je(t,n){return tt(t,rt(n))}function rt(t){return t===nt?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(t,!0)}var ot=new V,fe=new V,ce=new V,it=new V,ue=function(){};function Qe(t,n){return n(function(r,o){try{let u=function(){return fe.set(t,a),ce.set(t,void 0),{value:l,done:a===void 0}};var i=fe.get(t);if(i===void 0)return Promise.resolve({value:void 0,done:!0});var a,s,l,f=function(h,c){var p,d=-1;e:{for(var m=0;m<c.length;m++){var b=c[m][0];if(b){var N=b();if(N&&N.then)break e;if(N===h){d=m;break}}else d=m}if(d!==-1){do{for(var g=c[d][1];!g;)g=c[++d][1];var y=g();if(y&&y.then){p=!0;break e}var Ne=c[d][2];d++}while(Ne&&!Ne());return y}}let Y=new et,ne=S.bind(null,Y,2);return(p?y.then(me):N.then(function U(M){for(;;){if(M===h){d=m;break}if(++m===c.length){if(d!==-1)break;return void S(Y,1,X)}if(b=c[m][0]){if((M=b())&&M.then)return void M.then(U).then(void 0,ne)}else d=m}do{for(var T=c[d][1];!T;)T=c[++d][1];var X=T();if(X&&X.then)return void X.then(me).then(void 0,ne);var De=c[d][2];d++}while(De&&!De());S(Y,1,X)})).then(void 0,ne),Y;function me(U){for(;;){var M=c[d][2];if(!M||M())break;for(var T=c[++d][1];!T;)T=c[++d][1];if((U=T())&&U.then)return void U.then(me).then(void 0,ne)}S(Y,1,U)}}(it.get(t),[[function(){return"keys"},function(){return Promise.resolve(function(h,c){return tt(h,rt(c)).then(function(p){return p[0]})}(o,i)).then(function(h){l=a=h})}],[function(){return"values"},function(){return Promise.resolve(Je(o,i)).then(function(h){var c;a=(c=h)[0],l=s=c[1]})}],[function(){return"entries"},function(){return Promise.resolve(Je(o,i)).then(function(h){var c;s=(c=h)[1],l=(a=c[0])===void 0?void 0:[a,s]})}]]);return Promise.resolve(f&&f.then?f.then(u):u())}catch(u){return Promise.reject(u)}})}function Ae(t,n){var r=new ue;return it.set(r,t),ot.set(r,n),fe.set(r,nt),ce.set(r,void 0),r}ue.prototype.return=function(){fe.set(this,void 0)},ue.prototype.next=function(){var t=this,n=ot.get(this);if(!n)return Promise.reject(new TypeError("Invalid this value"));var r,o=ce.get(this);return r=o!==void 0?o.then(function(){return Qe(t,n)}):Qe(this,n),ce.set(this,r),r},typeof Symbol=="function"&&Symbol.asyncIterator&&(ue.prototype[Symbol.asyncIterator]=function(){return this});var Z=function(t,n,r){try{return B.get(t)===null&&function(o){var i=xe.get(o);B.set(o,new Promise(function(a,s){var l=self.indexedDB.open(i,1);l.onsuccess=function(){var f=l.result;(function(u,h,c){if(u.objectStoreNames.length!==1||u.objectStoreNames[0]!==L)return c(Ce(h)),!1;var p=u.transaction(L,"readonly").objectStore(L);return!(p.autoIncrement||p.keyPath||p.indexNames.length)||(c(Ce(h)),!1)})(f,i,s)&&(f.onclose=function(){B.set(o,null)},f.onversionchange=function(){f.close(),B.set(o,null)},a(f))},l.onerror=function(){return s(l.error)},l.onupgradeneeded=function(){try{l.result.createObjectStore(L)}catch(f){s(f)}}}))}(t),Promise.resolve(B.get(t)).then(function(o){var i=o.transaction(L,n),a=i.objectStore(L);return r(i,a)})}catch(o){return Promise.reject(o)}},xe=new V,B=new V,L="store",D=function(t){var n="kv-storage:"+t;B.set(this,null),xe.set(this,n),this.backingStore={database:n,store:L,version:1}};function Ce(t){return new Error('kv-storage: database "'+t+'" corrupted')}D.prototype.set=function(t,n){try{return we(t),Z(this,"readwrite",function(r,o){return n===void 0?o.delete(t):o.put(n,t),Ge(r)})}catch(r){return Promise.reject(r)}},D.prototype.get=function(t){try{return we(t),Z(this,"readonly",function(n,r){return Se(r.get(t))})}catch(n){return Promise.reject(n)}},D.prototype.delete=function(t){try{return we(t),Z(this,"readwrite",function(n,r){return r.delete(t),Ge(n)})}catch(n){return Promise.reject(n)}},D.prototype.clear=function(){try{let i=function(){function a(){return Se(self.indexedDB.deleteDatabase(xe.get(t)))}var s=function(){if(n){try{n.close()}catch{}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return s&&s.then?s.then(a):a()};var t=this,n,r=B.get(t),o=function(){if(r!==null){let s=function(){B.set(t,null)};var a=function(l,f){try{var u=Promise.resolve(r).then(function(h){n=h})}catch{return}return u&&u.then?u.then(void 0,function(){}):u}();return a&&a.then?a.then(s):s()}}();return o&&o.then?o.then(i):i()}catch(i){return Promise.reject(i)}},D.prototype.keys=function(){var t=this;return Ae("keys",function(n){return Z(t,"readonly",n)})},D.prototype.values=function(){var t=this;return Ae("values",function(n){return Z(t,"readonly",n)})},D.prototype.entries=function(){var t=this;return Ae("entries",function(n){return Z(t,"readonly",n)})},typeof Symbol=="function"&&Symbol.asyncIterator&&(D.prototype[Symbol.asyncIterator]=D.prototype.entries);var xt=new D("default");var F=44100,j=1024,z=t=>Math.floor(t*F/j),Oe=t=>t*j/F,at=t=>Math.ceil(z(t)/j),H=t=>t*j,Ot=await(async()=>{let t=new Audio,n=OfflineAudioContext;return t.canPlayType("audio/ogg")||(n=(await import("./oggmented-bundle-PZW5FHYZ.js")).default.OggmentedAudioContext),new n({sampleRate:F,length:60*60*44100})})();async function st(t){console.time("fetch");let n=await fetch(t);if(!n.ok)throw new Error(`HTTP error: status=${n.status}`);let r=await n.arrayBuffer();return console.timeEnd("fetch"),r}async function lt(t,n){console.time("decode");let r;try{r=await Ot.decodeAudioData(t)}catch(o){console.log(o)}return console.timeEnd("decode"),r}async function ut(...t){console.time("wav encode");let n=F,r=32,o=t[0].numberOfChannels,i=0;for(let d of t)i+=d.length;let a=new ArrayBuffer(44+i*o*(r>>3)),s=new DataView(a),l=0,f=d=>s.setUint8(l++,d),u=d=>(s.setUint16(l,d,!0),l+=2),h=d=>(s.setUint32(l,d,!0),l+=4),c=d=>{for(var m=0;m<d.length;++m)f(d.charCodeAt(m))};c("RIFF"),h(a.byteLength-8),c("WAVE"),c("fmt "),h(16),u(3),u(o),h(n),h(n*o*(r>>3)),u(o*(r>>3)),u(r),c("data"),h(a.byteLength-44);let p=new Float32Array(a,l);for(let d of t){let m=d.numberOfChannels,b=Array(m),N=d.length;for(let g=0;g<m;++g)b[g]=d.getChannelData(g);for(let g=0;g<N;++g)for(let y=0;y<m;++y)p[l++]=b[y][g]}return console.timeEnd("wav encode"),a}function ft(t){if(!t)return"";if(t._wf&&t._wf_first===t.getChannelData(0)[0])return t._wf;console.time("to waveform string");let n=t.getChannelData(0),r="",o=2;for(let i=0,a=j;i<n.length;){let s=0,l=0;for(;i<a;i++)s+=i>=n.length?0:n[i]**2;let f=Math.sqrt(s/j),u=Math.min(100,Math.ceil(f*100*o));r+=String.fromCharCode(256+u),a+=j}return t._wf=r,t._wf_first=t.getChannelData(0)[0],console.timeEnd("to waveform string"),r}function Ee(t,n=0,r=t.length){let o=new AudioBuffer({length:r-n,numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate});for(var i=0;i<o.numberOfChannels;i++)o.copyToChannel(t.getChannelData(i).subarray(n,r),i,0);return o}function he(t,n){let r=new AudioBuffer({length:t.length+n.length,numberOfChannels:Math.max(t.numberOfChannels,n.numberOfChannels),sampleRate:t.sampleRate});for(let o=0;o<r.numberOfChannels;o++)r.copyToChannel(t.getChannelData(o),o,0),r.copyToChannel(n.getChannelData(o),o,t.length);return r}function ct(t,n,r){if(n>=t.length)return he(t,r);if(!n)return he(r,t);let o=new AudioBuffer({length:t.length+r.length,numberOfChannels:Math.max(t.numberOfChannels,r.numberOfChannels),sampleRate:t.sampleRate});for(let i=0;i<o.numberOfChannels;i++)o.copyToChannel(t.getChannelData(i).subarray(0,n),i,0),o.copyToChannel(r.getChannelData(i),i,n),o.copyToChannel(t.getChannelData(i).subarray(n),i,n+r.length);return o}var de={};dt(de,{add:()=>Rt,br:()=>Nt,clip:()=>Bt,cp:()=>Mt,del:()=>jt,join:()=>Dt,mute:()=>Pt,norm:()=>kt,src:()=>Et});var Et=async(t,n)=>{let r=await st(n);return[await lt(r)]},kt=t=>{let n=0,r=0;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);r+=f.length;for(let u=0;u<f.length;u++)n+=f[u]}let o=n/r;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);r+=f.length;for(let u=0;u<f.length;u++)f[u]-=o}let i=0;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);for(let u=0;u<f.length;u++)i=Math.max(Math.abs(f[u]),i)}let a=Math.max(1/i,1);for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);for(let u=0;u<f.length;u++)f[u]=Math.min(1,Math.max(-1,f[u]*a))}return t},Nt=(t,...n)=>{for(let r of n){let[o,i]=ee(t,H(r)),a=t[o];if(i>0&&i<a.length){let s=Ee(a,0,i),l=Ee(a,i);t.splice(o,1,s,l)}}return t};function Dt(t,n){let[r,o]=ee(t,H(n));if(o)return console.warn("Wrong buffer offset",n);let i=t[r-1],a=t[r];return t.splice(r-1,2,he(i,a)),t}function jt(t,n,r){if(!r)return t;let o=ee(t,H(n)),i=ee(t,H(n+r));!i[1]&&i[0]&&(i[0]-=1,i[1]=t[i[0]].length);let a=t[o[0]],s=t[i[0]],l=new AudioBuffer({length:o[1]+(s.length-i[1]),sampleRate:F,numberOfChannels:a.numberOfChannels});for(let f=0;f<a.numberOfChannels;f++){let u=0,h=l.getChannelData(f),c=a.getChannelData(f),p=s.getChannelData(f);for(u=0;u<o[1];u++)h[u]=c[u];for(let d=i[1];d<p.length;d++)h[u]=p[d],u++}return t.splice(o[0],i[0]-o[0]+1,l),t}function Pt(t,...n){for(let r of n){let[o,i]=r,[a,s]=ee(t,H(o));!s&&a&&(a-=1,s=t[a].length);let l=new AudioBuffer({length:i*j,numberOfChannels:t?.[0].numberOfChannels||1,sampleRate:t?.[0].sampleRate||F});t[a]=ct(t[a],s,l)}return t}var Bt=(t,n,r)=>{},Rt=(t,n,r)=>{},Mt=(t,n,r,o)=>{},ee=(t,n)=>{if(n===0)return[0,0];var r=0,o;for(let i=0;i<t.length;i++){if(o=r+t[i].length,n<o)return[i,n-r];r=o}return[t.length-1,t[t.length-1].length]};var ke=document.querySelector(".waveplay"),W=ke.querySelector(".w-wavearea"),E=ke.querySelector(".w-playback"),pe=[],Tt=new URL(location),R=[],k=Xe(ke,{loading:!1,recording:!1,playing:!1,selecting:!1,startFrame:0,volume:1,error:null,segments:[],lineWidth:215,isMouseDown:!1,handleCaret(t){k.startFrame=z(E.currentTime=Oe(A().start))},async handleEnter(t){let n=A();if(!n.startNode.dataset.id)throw Error("Segment id is not found, strange");(R.at(-1)[0]==="br"?R.pop():["br"]).push(n.start),await te(["br",n.start]),A(n.start,n.start,1)},async handleDelete(t){let n=A();if(!n.startNode.dataset.id)throw Error("Segment id is not found, strange");let o=n.end-n.start,i=n.start-(t.key==="Delete"?0:1);if(!(i<0&&!o))if(!n.startNodeOffset&&n.collapsed)await te(["join",n.start]),A(n.start);else{let a=o?["del",n.start,o]:["del",i,1];R.push(a),await te(a),A(i)}},async handleSpace(t){let n=A(),r=k.segments[n.startNode.dataset.id],o=n.startNode.textContent.length-r.length,i=n.start-o;(R.at(-1)[0]==="mute"?R.pop():["mute"]).push([i,o]),await te(["mute",[i,o]]),A(n.start)},timeChange(t){document.activeElement!==W&&(A(k.startFrame=z(E.currentTime)),W.focus())},play(t){k.playing=!0;let n=A();n||(n=A(0));let r=n.start,o=n.collapsed?z(E.duration):n.end,i,a=()=>{let s=z(E.currentTime)-k.startFrame,l=k.startFrame+s;k.isMouseDown||A(l),o&&l>=o?E.pause():i=requestAnimationFrame(a)};return a(),W.focus(),()=>{k.playing=!1,cancelAnimationFrame(i),i=null,n.start!==n.end&&A(r,o),E.currentTime>=E.duration&&A(at(E.duration).length),W.focus()}},timecode(t){let n=Oe(t);return`${Math.floor(n/60).toFixed(0)}:${(n%60).toFixed(0).padStart(2,0)}`}}),A=(t,n,r=0)=>{let o=window.getSelection();if(t!=null){t=Math.max(0,t),n==null&&(n=t);let u,h;o.removeAllRanges();let c=new Range,p=t;for(u=W.firstChild;p+r>u.firstChild.data.length;)p-=u.firstChild.data.length,u=u.nextSibling;c.setStart(u.firstChild,p);let d=n;for(h=W.firstChild;d+r>h.firstChild.data.length;)d-=h.firstChild.data.length,h=h.nextSibling;return c.setEnd(h.firstChild,d),o.addRange(c),{start:t,startNode:u,end:n,endNode:h,startNodeOffset:p,endNodeOffset:d,collapsed:o.isCollapsed}}if(!o.anchorNode||o.anchorNode.parentNode.parentNode!==W)return;t=o.anchorOffset,n=o.focusOffset;let i=o.anchorNode.parentNode;for(;i=i.previousSibling;)t+=i.firstChild.data.length;for(i=o.focusNode.parentNode;i=i.previousSibling;)n+=i.firstChild.data.length;let a=o.anchorNode.parentNode,s=o.anchorOffset,l=o.focusNode.parentNode,f=o.focusOffset;return t>n&&([n,l,f,t,a,s]=[t,a,s,n,l,f]),{start:t,startNode:a,startNodeOffset:s,end:n,endNode:l,endNodeOffset:f,collapsed:o.isCollapsed}},ht=["https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg"];async function _t(){k.loading=!0;try{for(let[t,n]of Tt.searchParams)console.log(t,n);if(!R.length){let t=ht[Math.floor(Math.random()*ht.length)];R.push(["src",t],["norm"])}await te(...R)}catch(t){console.error(t),k.error=t.message}k.loading=!1}async function te(...t){console.log("Apply ops",t);for(let[n,...r]of t){if(!de[n])throw Error("Unknown operation `"+n+"`");pe=await de[n]?.(pe,...r)}It(pe),Lt(pe)}var It=t=>{let n=[],r=0;for(let o of t){let i=ft(o);i=new String(i.replaceAll("\u0100"," ")),i.offset=r,r+=i.length,n.push(i)}k.segments=n},Lt=async t=>{URL.revokeObjectURL(E.src);let n=await ut(...t),r=new Blob([n],{type:"audio/wav"}),o=E.currentTime,i=E.src=URL.createObjectURL(r);E.currentTime=o};_t();
//# sourceMappingURL=waveplay.js.map
