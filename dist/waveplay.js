import{b as pt}from"./chunk-YFDESRXI.js";function ne(){throw new Error("Cycle detected")}function oe(){if(k>1)k--;else{for(var t,r=!1;G!==void 0;){var n=G;for(G=void 0,me++;n!==void 0;){var o=n.o;if(n.o=void 0,n.f&=-3,!(8&n.f)&&Me(n))try{n.c()}catch(a){r||(t=a,r=!0)}n=o}}if(me=0,k--,r)throw t}}function je(t){if(k>0)return t();k++;try{return t()}finally{oe()}}var m=void 0,G=void 0,k=0,me=0,re=0;function ke(t){if(m!==void 0){var r=t.n;if(r===void 0||r.t!==m)return r={i:0,S:t,p:m.s,n:void 0,t:m,e:void 0,x:void 0,r},m.s!==void 0&&(m.s.n=r),m.s=r,t.n=r,32&m.f&&t.S(r),r;if(r.i===-1)return r.i=0,r.n!==void 0&&(r.n.p=r.p,r.p!==void 0&&(r.p.n=r.n),r.p=m.s,r.n=void 0,m.s.n=r,m.s=r),r}}function A(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}A.prototype.h=function(){return!0};A.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)};A.prototype.U=function(t){if(this.t!==void 0){var r=t.e,n=t.x;r!==void 0&&(r.x=n,t.e=void 0),n!==void 0&&(n.e=r,t.x=void 0),t===this.t&&(this.t=n)}};A.prototype.subscribe=function(t){var r=this;return ge(function(){var n=r.value,o=32&this.f;this.f&=-33;try{t(n)}finally{this.f|=o}})};A.prototype.valueOf=function(){return this.value};A.prototype.toString=function(){return this.value+""};A.prototype.peek=function(){return this.v};Object.defineProperty(A.prototype,"value",{get:function(){var t=ke(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){me>100&&ne(),this.v=t,this.i++,re++,k++;try{for(var r=this.t;r!==void 0;r=r.x)r.t.N()}finally{oe()}}}});function Be(t){return new A(t)}function Me(t){for(var r=t.s;r!==void 0;r=r.n)if(r.S.i!==r.i||!r.S.h()||r.S.i!==r.i)return!0;return!1}function _e(t){for(var r=t.s;r!==void 0;r=r.n){var n=r.S.n;if(n!==void 0&&(r.r=n),r.S.n=r,r.i=-1,r.n===void 0){t.s=r;break}}}function Re(t){for(var r=t.s,n=void 0;r!==void 0;){var o=r.p;r.i===-1?(r.S.U(r),o!==void 0&&(o.n=r.n),r.n!==void 0&&(r.n.p=o)):n=r,r.S.n=r.r,r.r!==void 0&&(r.r=void 0),r=o}t.s=n}function R(t){A.call(this,void 0),this.x=t,this.s=void 0,this.g=re-1,this.f=4}(R.prototype=new A).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===re))return!0;if(this.g=re,this.f|=1,this.i>0&&!Me(this))return this.f&=-2,!0;var t=m;try{_e(this),m=this;var r=this.x();(16&this.f||this.v!==r||this.i===0)&&(this.v=r,this.f&=-17,this.i++)}catch(n){this.v=n,this.f|=16,this.i++}return m=t,Re(this),this.f&=-2,!0};R.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var r=this.s;r!==void 0;r=r.n)r.S.S(r)}A.prototype.S.call(this,t)};R.prototype.U=function(t){if(this.t!==void 0&&(A.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var r=this.s;r!==void 0;r=r.n)r.S.U(r)}};R.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};R.prototype.peek=function(){if(this.h()||ne(),16&this.f)throw this.v;return this.v};Object.defineProperty(R.prototype,"value",{get:function(){1&this.f&&ne();var t=ke(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Te(t){return new R(t)}function Le(t){var r=t.u;if(t.u=void 0,typeof r=="function"){k++;var n=m;m=void 0;try{r()}catch(o){throw t.f&=-2,t.f|=8,ye(t),o}finally{m=n,oe()}}}function ye(t){for(var r=t.s;r!==void 0;r=r.n)r.S.U(r);t.x=void 0,t.s=void 0,Le(t)}function vt(t){if(m!==this)throw new Error("Out-of-order effect");Re(this),m=t,this.f&=-2,8&this.f&&ye(this),oe()}function J(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}J.prototype.c=function(){var t=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{t()}};J.prototype.S=function(){1&this.f&&ne(),this.f|=1,this.f&=-9,Le(this),_e(this),k++;var t=m;return m=this,vt.bind(this,t)};J.prototype.N=function(){2&this.f||(this.f|=2,this.o=G,G=this)};J.prototype.d=function(){this.f|=8,1&this.f||ye(this)};function ge(t){var r=new J(t);try{r.c()}catch(n){throw r.d(),n}return r.d.bind(r)}Symbol.observable||=Symbol("observable");var Ie=t=>t&&!!(t[Symbol.observable]||t[Symbol.asyncIterator]||t.call&&t.set||t.subscribe||t.then),mt=new FinalizationRegistry(t=>t.call?.()),yt=t=>t&&(()=>t.unsubscribe?.()),Ue=(t,r,n,o,a,i)=>t&&(i=yt((t[Symbol.observable]?.()||t).subscribe?.(r,n,o))||t.set&&t.call?.(a,r)||(t.then?.(s=>(!a&&r(s),o?.()),n)||(async s=>{try{for await(s of t){if(a)return;r(s)}o?.()}catch(l){n?.(l)}})())&&(s=>a=1),mt.register(t,i),i);var gt=t=>t&&t.peek,be=t=>t&&t[Fe],Fe=Symbol("signal-struct");x.isStruct=be;function x(t,r){if(be(t)&&!r)return t;if(ie(t)){let n=Object.create(r||Object.getPrototypeOf(t)),o={},a=Object.getOwnPropertyDescriptors(t);for(let i in a){let s=a[i];if(s.get){let l=o[i]=Te(s.get.bind(n));Object.defineProperty(n,i,{get(){return l.value},set:s.set?.bind(n),configurable:!1,enumerable:!0})}else{let l=s.value,f=Ie(l),u=o[i]=gt(l)?l:Be(f?void 0:ie(l)?Object.seal(x(l)):Array.isArray(l)?x(l):l);f&&Ue(l,h=>u.value=h),Object.defineProperty(n,i,{get(){return u.value},set(h){if(ie(h)){if(ie(u.value))try{Object.assign(u.value,h);return}catch{}u.value=Object.seal(x(h))}else Array.isArray(h)?u.value=x(h):u.value=h},enumerable:!0,configurable:!1})}}return Object.defineProperty(n,Fe,{configurable:!1,enumerable:!1,value:!0}),n}if(Array.isArray(t)&&!be(t[0]))for(let n=0;n<t.length;n++)t[n]=x(t[n]);return t}function ie(t){return t&&t.constructor===Object}var W=(t,r,n,o=null)=>{let a=0,i,s,l,f=n.length,u=r.length,{remove:h,same:c,insert:p,replace:d}=W;for(;a<f&&a<u&&c(r[a],n[a]);)a++;for(;a<f&&a<u&&c(n[f-1],r[u-1]);)o=n[--u,--f];if(a==u)for(;a<f;)p(o,n[a++],t);else{for(i=r[a];a<f;)l=n[a++],s=i?i.nextSibling:o,c(i,l)?i=s:a<f&&c(n[a],s)?(d(i,l,t),i=s):p(i,l,t);for(;!c(i,o);)s=i.nextSibling,h(i,t),i=s}return n};W.same=(t,r)=>t==r;W.replace=(t,r,n)=>n.replaceChild(r,t);W.insert=(t,r,n)=>n.insertBefore(r,t);W.remove=(t,r)=>r.removeChild(t);var We=W;var $={},bt={},wt={},$e=t=>t===null?bt:t===void 0?wt:typeof t=="number"||t instanceof Number?$[t]||($[t]=new Number(t)):typeof t=="string"||t instanceof String?$[t]||($[t]=new String(t)):typeof t=="boolean"||t instanceof Boolean?$[t]||($[t]=new Boolean(t)):t;var K={},C={};K.if=(t,r)=>{let n=document.createTextNode(""),o=[w(t,r,":if")],a=[t],i=t;for(;(i=t.nextElementSibling)&&i.hasAttribute(":else");)i.removeAttribute(":else"),(r=i.getAttribute(":if"))?(i.removeAttribute(":if"),i.remove(),a.push(i),o.push(w(t,r,":else :if"))):(i.remove(),a.push(i),o.push(()=>1));return t.replaceWith(i=n),s=>{let l=o.findIndex(f=>f(s));a[l]!=i&&((i[Ve]||i).replaceWith(i=a[l]||n),T(i,s))}};K.with=(t,r,n)=>{let o=w(t,r,"with");T(t,x(o(n),n))};var Ve=Symbol(":each");K.each=(t,r)=>{let n=At(r);if(!n)return ae(new Error,t,r);let o=t[Ve]=document.createTextNode("");t.replaceWith(o);let a=w(t,n[2],":each"),i=t.getAttribute(":key"),s=i?w(null,i):null;t.removeAttribute(":key");let l=new WeakMap,f=new WeakMap,u=[];return h=>{let c=a(h);c?typeof c=="number"?c=Array.from({length:c},(v,b)=>[b,b+1]):Array.isArray(c)?c=c.map((v,b)=>[b+1,v]):typeof c=="object"?c=Object.entries(c):ae(Error("Bad list value"),t,r,":each",c):c=[];let p=[],d=[];for(let[v,b]of c){let N,g,y=s?.({[n[0]]:b,[n[1]]:v});St(y)&&(y=$e(y)),y==null?N=t.cloneNode(!0):(N=f.get(y))||f.set(y,N=t.cloneNode(!0)),p.push(N),y==null||!(g=l.get(y))?(g=x({[n[0]]:b,[n[1]]:v},h),y!=null&&l.set(y,g)):g[n[0]]=b,d.push(g)}We(o.parentNode,u,p,o),u=p;for(let v=0;v<p.length;v++)T(p[v],d[v])}};function At(t){let r=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,n=/^\s*\(|\)\s*$/g,o=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,a=t.match(o);if(!a)return;let i=a[2].trim(),s=a[1].replace(n,"").trim(),l=s.match(r);return l?[s.replace(r,"").trim(),l[1].trim(),i]:[s,"",i]}C.ref=(t,r,n)=>{n[r]=t};C.id=(t,r)=>{let n=w(t,r,":id"),o=a=>t.id=a||a===0?a:"";return a=>o(n(a))};C.class=(t,r)=>{let n=w(t,r,":class"),o=t.className;return a=>{let i=n(a);t.className=o+typeof i=="string"?i:(Array.isArray(i)?i:Object.entries(i).map(([s,l])=>l?s:"")).filter(Boolean).join(" ")}};C.style=(t,r)=>{let n=w(t,r,":style"),o=t.getAttribute("style")||"";return o.endsWith(";")||(o+="; "),a=>{let i=n(a);if(typeof i=="string")t.setAttribute("style",o+i);else for(let s in i)t.style[s]=i[s]}};C.text=(t,r)=>{let n=w(t,r,":text");return o=>{let a=n(o);t.textContent=a??""}};C.data=(t,r)=>{let n=w(t,r,":data");return o=>{let a=n(o);for(let i in a)t.dataset[i]=a[i]}};C.aria=(t,r)=>{let n=w(t,r,":aria"),o=a=>{for(let i in a)se(t,"aria-"+Xe(i),a[i]==null?null:a[i]+"")};return a=>o(n(a))};C[""]=(t,r)=>{let n=w(t,r,":");if(n)return o=>{let a=n(o);for(let i in a)se(t,Xe(i),a[i])}};C.value=(t,r)=>{let n=w(t,r,":value"),o,a,i=t.type==="text"||t.type===""?s=>t.setAttribute("value",t.value=s??""):t.tagName==="TEXTAREA"||t.type==="text"||t.type===""?s=>(o=t.selectionStart,a=t.selectionEnd,t.setAttribute("value",t.value=s??""),o&&t.setSelectionRange(o,a)):t.type==="checkbox"?s=>(t.value=s?"on":"",se(t,"checked",s)):t.type==="select-one"?s=>{for(let l in t.options)l.removeAttribute("selected");t.value=s,t.selectedOptions[0]?.setAttribute("selected","")}:s=>t.value=s;return s=>i(n(s))};C.on=(t,r)=>{let n=w(t,r,":on");return o=>{let a=n(o);for(let i in a)He(t,i,a[i]);return()=>{for(let i in a)Ye(t,i,a[i])}}};var Ze=(t,r,n,o)=>{let a=o.startsWith("on")&&o.slice(2),i=w(t,r,":"+o);if(i)return a?s=>{let l=i(s);if(l)return He(t,a,l),()=>Ye(t,a,l)}:s=>se(t,o,i(s))},j=Symbol("stop"),He=(t,r,n)=>{let o=r.split("..").map(i=>i.startsWith("on")?i.slice(2):i),a={};if(o[0]=o[0].replace(/\.(\w+)?-?([\w]+)?/g,(i,s,l)=>((s=ze[s])&&([t,n]=s(t,n,a,l)),"")),o.length==1)t.addEventListener(o[0],n,a);else{let i=(s,l=0)=>{let f=u=>{t.removeEventListener(o[l],f),typeof(s=s.call(t,u))!="function"&&(s=()=>{}),++l<o.length?i(s,l):n[j]||i(n)};t.addEventListener(o[l],f,a)};i(n)}},Ye=(t,r,n)=>{r.indexOf("..")>=0&&(n[j]=!0),t.removeEventListener(r,n)},ze={throttle(t,r,n,o){o=Number(o)||108;let a,i,s=()=>{a=!0,setTimeout(()=>{a=!1,i&&(r(e),i=!1,s())})};return[t,l=>{if(a)return i=!0,j;r(l),s()}]},debounce(t,r,n,o){o=Number(o)||108;let a,i=()=>{a=null,r(e)};return[t,s=>{clearTimeout(a),a=setTimeout(i,o)}]},window(t,r){return[window,r]},document(t,r){return[document,r]},outside(t,r){return[t,n=>{if(t.contains(n.target)||n.target.isConnected===!1||t.offsetWidth<1&&t.offsetHeight<1)return j;r(n)}]},prevent(t,r){return[t,n=>{r(n)!==j&&n.preventDefault()}]},stop(t,r){return[t,n=>{r(n)!==j&&n.stopPropagation()}]},self(t,r){return[t,n=>{n.target===t&&r(n)}]},once(t,r,n){return n.once=!0,[t,r]},passive(t,r,n){return n.passive=!0,[t,r]},capture(t,r,n){return n.capture=!0,[t,r]}},Ke={ctrl:"Control Ctrl",shift:"Shift",alt:"Alt",meta:"Meta",cmd:"Meta",down:"ArrowDown",up:"ArrowUp",left:"ArrowLeft",right:"ArrowRight",end:"End",home:"Home",pagedown:"PageDown",pageup:"PageUp",enter:"Enter",plus:"+",minus:"-",star:"*",slash:"/",period:".",equal:"=",underscore:"_",esc:"Escape",escape:"Escape",tab:"Tab",space:" ",backspace:"Backspace",delete:"Delete"};for(let t in Ke){let r=Ke[t];ze[t]=(n,o,a,i)=>[n,s=>{if(!s.key||!r.includes(s.key))return j;o(s)}]}var se=(t,r,n)=>{n==null||n===!1?t.removeAttribute(r):t.setAttribute(r,n===!0?"":typeof n=="number"||typeof n=="string"?n:"")},qe={};function w(t,r,n){let o=qe[r];if(!o){let a=/^[\n\s]*if.*\(.*\)/.test(r)||/^(let|const)\s/.test(r)?`(() => { ${r} })()`:r;try{o=qe[r]=new Function("__scope",`with (__scope) { return ${a} };`)}catch(i){return ae(i,t,r,n)}}return a=>{let i;try{i=o.call(t,a)}catch(s){return ae(s,t,r,n)}return i}}function ae(t,r,n,o){Object.assign(t,{element:r,expression:n}),console.warn(`\u2234 ${t.message}

${o}=${n?`"${n}"

`:""}`,r),setTimeout(()=>{throw t},0)}function Xe(t){return t.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,r=>"-"+r.toLowerCase())}function St(t){return typeof t=="string"||typeof t=="boolean"||typeof t=="number"}var Q=new WeakMap;function T(t,r){if(!t.children)return;if(Q.has(t)){let i=Q.get(t);return je(()=>Object.assign(i,r)),i}let n=x(r||{}),o=[],a=(i,s=i.parentNode)=>{for(let l in K){let f=":"+l;if(i.hasAttribute?.(f)){let u=i.getAttribute(f);if(i.removeAttribute(f),!u)continue;if(o.push(K[l](i,u,n,l)),Q.has(i)||i.parentNode!==s)return!1}}if(i.attributes)for(let l=0;l<i.attributes.length;){let f=i.attributes[l];if(f.name[0]!==":"){l++;continue}i.removeAttribute(f.name);let u=f.value;if(!u)continue;let h=f.name.slice(1).split(":");for(let c of h){let p=C[c]||Ze;if(o.push(p(i,u,n,c)),Q.has(i)||i.parentNode!==s)return!1}}for(let l=0,f;f=i.children[l];l++)a(f,i)===!1&&l--};a(t);for(let i of o)if(i){let s;ge(()=>{typeof s=="function"&&s(),s=i(n)})}return Object.seal(n),Q.set(t,n),n}var Ge=T;var tt=function(){function t(){}return t.prototype.then=function(r,n){let o=new t,a=this.s;if(a){let i=1&a?r:n;if(i){try{S(o,1,i(this.v))}catch(s){S(o,2,s)}return o}return this}return this.o=function(i){try{let s=i.v;1&i.s?S(o,1,r?r(s):s):n?S(o,1,n(s)):S(o,2,s)}catch(s){S(o,2,s)}},o},t}();function S(t,r,n){if(!t.s){if(n instanceof tt){if(!n.s)return void(n.o=S.bind(null,t,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(S.bind(null,t,r),S.bind(null,t,2));t.s=r,t.v=n;let o=t.o;o&&o(t)}}var xt=0,V=typeof WeakMap=="function"?WeakMap:function(){var t=typeof Symbol=="function"?Symbol(0):"__weak$"+ ++xt;this.set=function(r,n){r[t]=n},this.get=function(r){return r[t]}};function xe(t,r){return new Promise(function(n,o){t.onsuccess=function(){var a=t.result;r&&(a=r(a)),n(a)},t.onerror=function(){o(t.error)}})}function rt(t,r){return xe(t.openCursor(r),function(n){return n?[n.key,n.value]:[]})}function Je(t){return new Promise(function(r,n){t.oncomplete=function(){r()},t.onabort=function(){n(t.error)},t.onerror=function(){n(t.error)}})}function we(t){if(!function(r){return!!(typeof r=="number"||typeof r=="string"||typeof r=="object"&&r&&(Array.isArray(r)||"setUTCFullYear"in r||typeof ArrayBuffer=="function"&&ArrayBuffer.isView(r)||"byteLength"in r&&"length"in r))}(t))throw Error("kv-storage: The given value is not allowed as a key")}var nt={};function Qe(t,r){return rt(t,ot(r))}function ot(t){return t===nt?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(t,!0)}var it=new V,ue=new V,fe=new V,at=new V,le=function(){};function et(t,r){return r(function(n,o){try{let u=function(){return ue.set(t,i),fe.set(t,void 0),{value:l,done:i===void 0}};var a=ue.get(t);if(a===void 0)return Promise.resolve({value:void 0,done:!0});var i,s,l,f=function(h,c){var p,d=-1;e:{for(var v=0;v<c.length;v++){var b=c[v][0];if(b){var N=b();if(N&&N.then)break e;if(N===h){d=v;break}}else d=v}if(d!==-1){do{for(var g=c[d][1];!g;)g=c[++d][1];var y=g();if(y&&y.then){p=!0;break e}var De=c[d][2];d++}while(De&&!De());return y}}let z=new tt,te=S.bind(null,z,2);return(p?y.then(ve):N.then(function F(M){for(;;){if(M===h){d=v;break}if(++v===c.length){if(d!==-1)break;return void S(z,1,X)}if(b=c[v][0]){if((M=b())&&M.then)return void M.then(F).then(void 0,te)}else d=v}do{for(var _=c[d][1];!_;)_=c[++d][1];var X=_();if(X&&X.then)return void X.then(ve).then(void 0,te);var Pe=c[d][2];d++}while(Pe&&!Pe());S(z,1,X)})).then(void 0,te),z;function ve(F){for(;;){var M=c[d][2];if(!M||M())break;for(var _=c[++d][1];!_;)_=c[++d][1];if((F=_())&&F.then)return void F.then(ve).then(void 0,te)}S(z,1,F)}}(at.get(t),[[function(){return"keys"},function(){return Promise.resolve(function(h,c){return rt(h,ot(c)).then(function(p){return p[0]})}(o,a)).then(function(h){l=i=h})}],[function(){return"values"},function(){return Promise.resolve(Qe(o,a)).then(function(h){var c;i=(c=h)[0],l=s=c[1]})}],[function(){return"entries"},function(){return Promise.resolve(Qe(o,a)).then(function(h){var c;s=(c=h)[1],l=(i=c[0])===void 0?void 0:[i,s]})}]]);return Promise.resolve(f&&f.then?f.then(u):u())}catch(u){return Promise.reject(u)}})}function Ae(t,r){var n=new le;return at.set(n,t),it.set(n,r),ue.set(n,nt),fe.set(n,void 0),n}le.prototype.return=function(){ue.set(this,void 0)},le.prototype.next=function(){var t=this,r=it.get(this);if(!r)return Promise.reject(new TypeError("Invalid this value"));var n,o=fe.get(this);return n=o!==void 0?o.then(function(){return et(t,r)}):et(this,r),fe.set(this,n),n},typeof Symbol=="function"&&Symbol.asyncIterator&&(le.prototype[Symbol.asyncIterator]=function(){return this});var q=function(t,r,n){try{return B.get(t)===null&&function(o){var a=Ce.get(o);B.set(o,new Promise(function(i,s){var l=self.indexedDB.open(a,1);l.onsuccess=function(){var f=l.result;(function(u,h,c){if(u.objectStoreNames.length!==1||u.objectStoreNames[0]!==L)return c(Se(h)),!1;var p=u.transaction(L,"readonly").objectStore(L);return!(p.autoIncrement||p.keyPath||p.indexNames.length)||(c(Se(h)),!1)})(f,a,s)&&(f.onclose=function(){B.set(o,null)},f.onversionchange=function(){f.close(),B.set(o,null)},i(f))},l.onerror=function(){return s(l.error)},l.onupgradeneeded=function(){try{l.result.createObjectStore(L)}catch(f){s(f)}}}))}(t),Promise.resolve(B.get(t)).then(function(o){var a=o.transaction(L,r),i=a.objectStore(L);return n(a,i)})}catch(o){return Promise.reject(o)}},Ce=new V,B=new V,L="store",P=function(t){var r="kv-storage:"+t;B.set(this,null),Ce.set(this,r),this.backingStore={database:r,store:L,version:1}};function Se(t){return new Error('kv-storage: database "'+t+'" corrupted')}P.prototype.set=function(t,r){try{return we(t),q(this,"readwrite",function(n,o){return r===void 0?o.delete(t):o.put(r,t),Je(n)})}catch(n){return Promise.reject(n)}},P.prototype.get=function(t){try{return we(t),q(this,"readonly",function(r,n){return xe(n.get(t))})}catch(r){return Promise.reject(r)}},P.prototype.delete=function(t){try{return we(t),q(this,"readwrite",function(r,n){return n.delete(t),Je(r)})}catch(r){return Promise.reject(r)}},P.prototype.clear=function(){try{let a=function(){function i(){return xe(self.indexedDB.deleteDatabase(Ce.get(t)))}var s=function(){if(r){try{r.close()}catch{}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return s&&s.then?s.then(i):i()};var t=this,r,n=B.get(t),o=function(){if(n!==null){let s=function(){B.set(t,null)};var i=function(l,f){try{var u=Promise.resolve(n).then(function(h){r=h})}catch{return}return u&&u.then?u.then(void 0,function(){}):u}();return i&&i.then?i.then(s):s()}}();return o&&o.then?o.then(a):a()}catch(a){return Promise.reject(a)}},P.prototype.keys=function(){var t=this;return Ae("keys",function(r){return q(t,"readonly",r)})},P.prototype.values=function(){var t=this;return Ae("values",function(r){return q(t,"readonly",r)})},P.prototype.entries=function(){var t=this;return Ae("entries",function(r){return q(t,"readonly",r)})},typeof Symbol=="function"&&Symbol.asyncIterator&&(P.prototype[Symbol.asyncIterator]=P.prototype.entries);var Ct=new P("default");var Z=44100,I=1024,H=t=>Math.floor(t*Z/I),Oe=t=>t*I/Z,st=t=>Math.ceil(H(t)/I),ee=t=>t*I,Ot=await(async()=>{let t=new Audio,r=OfflineAudioContext;return t.canPlayType("audio/ogg")||(r=(await import("./oggmented-bundle-PZW5FHYZ.js")).default.OggmentedAudioContext),new r({sampleRate:Z,length:60*60*44100})})();async function lt(t){console.time("fetch");let r=await fetch(t);if(!r.ok)throw new Error(`HTTP error: status=${r.status}`);let n=await r.arrayBuffer();return console.timeEnd("fetch"),n}async function ut(t,r){console.time("decode");let n;try{n=await Ot.decodeAudioData(t)}catch(o){console.log(o)}return console.timeEnd("decode"),n}async function ft(...t){console.time("wav encode");let r=Z,n=32,o=t[0].numberOfChannels,a=0;for(let d of t)a+=d.length;let i=new ArrayBuffer(44+a*o*(n>>3)),s=new DataView(i),l=0,f=d=>s.setUint8(l++,d),u=d=>(s.setUint16(l,d,!0),l+=2),h=d=>(s.setUint32(l,d,!0),l+=4),c=d=>{for(var v=0;v<d.length;++v)f(d.charCodeAt(v))};c("RIFF"),h(i.byteLength-8),c("WAVE"),c("fmt "),h(16),u(3),u(o),h(r),h(r*o*(n>>3)),u(o*(n>>3)),u(n),c("data"),h(i.byteLength-44);let p=new Float32Array(i,l);for(let d of t){let v=d.numberOfChannels,b=Array(v),N=d.length;for(let g=0;g<v;++g)b[g]=d.getChannelData(g);for(let g=0;g<N;++g)for(let y=0;y<v;++y)p[l++]=b[y][g]}return console.timeEnd("wav encode"),i}function ct(t){if(!t)return"";if(t._wf&&t._wf_first===t.getChannelData(0)[0])return t._wf;console.time("to waveform string");let r=t.getChannelData(0),n="",o=2;for(let a=0,i=I;a<r.length;){let s=0,l=0;for(;a<i;a++)s+=a>=r.length?0:r[a]**2;let f=Math.sqrt(s/I),u=Math.min(100,Math.ceil(f*100*o));n+=String.fromCharCode(256+u),i+=I}return t._wf=n,t._wf_first=t.getChannelData(0)[0],console.timeEnd("to waveform string"),n}function Ee(t,r=0,n=t.length){let o=new AudioBuffer({length:n-r,numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate});for(var a=0;a<o.numberOfChannels;a++)o.copyToChannel(t.getChannelData(a).subarray(r,n),a,0);return o}function ht(t,r){let n=new AudioBuffer({length:t.length+r.length,numberOfChannels:Math.max(t.numberOfChannels,r.numberOfChannels),sampleRate:t.sampleRate});for(let o=0;o<n.numberOfChannels;o++)n.copyToChannel(t.getChannelData(o),o,0),n.copyToChannel(r.getChannelData(o),o,t.length);return n}var he={};pt(he,{add:()=>Mt,br:()=>Dt,clip:()=>Bt,cp:()=>_t,del:()=>jt,insert:()=>Rt,join:()=>Pt,mute:()=>kt,norm:()=>Nt,src:()=>Et});var Et=async(t,r)=>{let n=await lt(r);return[await ut(n)]},Nt=t=>{let r=0,n=0;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);n+=f.length;for(let u=0;u<f.length;u++)r+=f[u]}let o=r/n;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);n+=f.length;for(let u=0;u<f.length;u++)f[u]-=o}let a=0;for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);for(let u=0;u<f.length;u++)a=Math.max(Math.abs(f[u]),a)}let i=Math.max(1/a,1);for(let s of t)for(let l=0;l<s.numberOfChannels;l++){let f=s.getChannelData(l);for(let u=0;u<f.length;u++)f[u]=Math.min(1,Math.max(-1,f[u]*i))}return t},Dt=(t,...r)=>{for(let n of r){let[o,a]=ce(t,ee(n)),i=t[o];if(a>0&&a<i.length){let s=Ee(i,0,a),l=Ee(i,a);t.splice(o,1,s,l)}}return t};function Pt(t,r){let[n,o]=ce(t,ee(r));if(o)return console.warn("Wrong buffer offset",r);let a=t[n-1],i=t[n];return t.splice(n-1,2,ht(a,i)),t}function jt(t,r,n){if(!n)return t;let o=ce(t,ee(r)),a=ce(t,ee(r+n));!a[1]&&a[0]&&(a[0]-=1,a[1]=t[a[0]].length);let i=t[o[0]],s=t[a[0]],l=new AudioBuffer({length:o[1]+(s.length-a[1]),sampleRate:Z,numberOfChannels:i.numberOfChannels});for(let f=0;f<i.numberOfChannels;f++){let u=0,h=l.getChannelData(f),c=i.getChannelData(f),p=s.getChannelData(f);for(u=0;u<o[1];u++)h[u]=c[u];for(let d=a[1];d<p.length;d++)h[u]=p[d],u++}return t.splice(o[0],a[0]-o[0]+1,l),t}function kt(t,r=2){let n=Array.from({length:r},()=>new Float32Array(t));return create(n)}var Bt=(t,r,n)=>{},Mt=(t,r,n)=>{},_t=(t,r,n,o)=>{};function Rt(t,r,n){for(var o=[],a,i=0;i<t.numberOfChannels;i++){o.push(a=new Float32Array(t.length+n.length));var s=t.getChannelData(i);a.set(s.subarray(0,r),0),a.set(n.getChannelData(i),r),a.set(s.subarray(r),r+n.length)}return create(o)}var ce=(t,r)=>{if(r===0)return[0,0];var n=0,o;for(let a=0;a<t.length;a++){if(o=n+t[a].length,r<o)return[a,r-n];n=o}return[t.length-1,t[t.length-1].length]};var Ne=document.querySelector(".waveplay"),U=Ne.querySelector(".w-wavearea"),E=Ne.querySelector(".w-playback"),de=[],Tt=new URL(location),Y=[],D=Ge(Ne,{loading:!1,recording:!1,playing:!1,selecting:!1,startFrame:0,volume:1,error:null,segments:[],lineWidth:215,isMouseDown:!1,handleCaret(t){D.startFrame=H(E.currentTime=Oe(O().start))},async handleEnter(t){let r=O();if(!r.startNode.dataset.id)throw Error("Segment id is not found, strange");(Y.at(-1)[0]==="br"?Y.pop():["br"]).push(r.start),await pe(["br",r.start]),O(r.start,r.start,1)},async handleDelete(t){let r=O();if(!r.startNode.dataset.id)throw Error("Segment id is not found, strange");let o=r.end-r.start,a=r.start-(t.key==="Delete"?0:1);if(!(a<0&&!o))if(!r.startNodeOffset&&r.isCollapsed)await pe(["join",r.start]),O(r.start);else{let i=o?["del",r.start,o]:["del",a,1];Y.push(i),await pe(i),O(a)}},timeChange(t){document.activeElement!==U&&(O(D.startFrame=H(E.currentTime)),U.focus())},play(t){D.playing=!0;let r=O();r||(r=O(0));let n=r.start,o=r.collapsed?H(E.duration):r.end,a,i=()=>{let s=H(E.currentTime)-D.startFrame,l=D.startFrame+s;D.isMouseDown||O(l),o&&l>=o?E.pause():a=requestAnimationFrame(i)};return i(),U.focus(),()=>{D.playing=!1,cancelAnimationFrame(a),a=null,r.start!==r.end&&O(n,o),E.currentTime>=E.duration&&O(st(E.duration).length),U.focus()}},timecode(t){let r=Oe(t);return`${Math.floor(r/60).toFixed(0)}:${(r%60).toFixed(0).padStart(2,0)}`}}),O=(t,r,n=0)=>{let o=window.getSelection();if(t!=null){t=Math.max(0,t),r==null&&(r=t);let u,h;o.removeAllRanges();let c=new Range,p=t;for(u=U.firstChild;p+n>u.firstChild.data.length;)p-=u.firstChild.data.length,u=u.nextSibling;c.setStart(u.firstChild,p);let d=r;for(h=U.firstChild;d+n>h.firstChild.data.length;)d-=h.firstChild.data.length,h=h.nextSibling;return c.setEnd(h.firstChild,d),o.addRange(c),{start:t,startNode:u,end:r,endNode:h,startNodeOffset:p,endNodeOffset:d,collapsed:o.isCollapsed}}if(!o.anchorNode||o.anchorNode.parentNode.parentNode!==U)return;t=o.anchorOffset,r=o.focusOffset;let a=o.anchorNode.parentNode;for(;a=a.previousSibling;)t+=a.firstChild.data.length;for(a=o.focusNode.parentNode;a=a.previousSibling;)r+=a.firstChild.data.length;let i=o.anchorNode.parentNode,s=o.anchorOffset,l=o.focusNode.parentNode,f=o.focusOffset;return t>r&&([r,l,f,t,i,s]=[t,i,s,r,l,f]),{start:t,startNode:i,startNodeOffset:s,end:r,endNode:l,endNodeOffset:f,collapsed:o.isCollapsed}},dt=["https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg"];async function Lt(){D.loading=!0;try{for(let[t,r]of Tt.searchParams)console.log(t,r);if(!Y.length){let t=dt[Math.floor(Math.random()*dt.length)];Y.push(["src",t],["norm"])}await pe(...Y)}catch(t){console.error(t),D.error=t.message}D.loading=!1}async function pe(...t){console.log("Apply ops",t);for(let[r,...n]of t){if(!he[r])throw Error("Unknown operation `"+r+"`");de=await he[r]?.(de,...n)}It(de),Ut(de)}var It=t=>{let r=[];for(let n of t){let o=ct(n);o=o.replaceAll("\u0100"," "),r.push(o)}D.segments=r},Ut=async t=>{URL.revokeObjectURL(E.src);let r=await ft(...t),n=new Blob([r],{type:"audio/wav"}),o=E.currentTime,a=E.src=URL.createObjectURL(n);E.currentTime=o};Lt();
//# sourceMappingURL=waveplay.js.map
