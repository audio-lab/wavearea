var he=Object.create;var At=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var ve=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty;var ye=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var ge=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of pe(e))!me.call(t,i)&&i!==r&&At(t,i,{get:()=>e[i],enumerable:!(o=de(e,i))||o.enumerable});return t};var we=(t,e,r)=>(r=t!=null?he(ve(t)):{},ge(e||!t||!t.__esModule?At(r,"default",{value:t,enumerable:!0}):r,t));var Jt=ye((pr,Zt)=>{"use strict";var _e={pcm8:(t,e,r,o,i)=>{let n=new Uint8Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=n[a++]-128;r[u][s]=f<0?f/128:f/127}},pcm16:(t,e,r,o,i)=>{let n=new Int16Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=n[a++];r[u][s]=f<0?f/32768:f/32767}},pcm24:(t,e,r,o,i)=>{let n=new Uint8Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=n[a++],c=n[a++],l=n[a++],d=f+(c<<8)+(l<<16),h=d>8388608?d-16777216:d;r[u][s]=h<0?h/8388608:h/8388607}},pcm32:(t,e,r,o,i)=>{let n=new Int32Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=n[a++];r[u][s]=f<0?f/2147483648:f/2147483647}},pcm32f:(t,e,r,o,i)=>{let n=new Float32Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u)r[u][s]=n[a++]},pcm64f:(t,e,r,o,i)=>{let n=new Float64Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u)r[u][s]=n[a++]}},Ue={pcm8:(t,e,r,o,i)=>{let n=new Uint8Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=Math.max(-1,Math.min(r[u][s],1));f=(f*.5+.5)*255|0,n[a++]=f}},pcm16:(t,e,r,o,i)=>{let n=new Int16Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=Math.max(-1,Math.min(r[u][s],1));f=(f<0?f*32768:f*32767)|0,n[a++]=f}},pcm24:(t,e,r,o,i)=>{let n=new Uint8Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=Math.max(-1,Math.min(r[u][s],1));f=(f<0?16777216+f*8388608:f*8388607)|0,n[a++]=f>>0&255,n[a++]=f>>8&255,n[a++]=f>>16&255}},pcm32:(t,e,r,o,i)=>{let n=new Int32Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=Math.max(-1,Math.min(r[u][s],1));f=(f<0?f*2147483648:f*2147483647)|0,n[a++]=f}},pcm32f:(t,e,r,o,i)=>{let n=new Float32Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=Math.max(-1,Math.min(r[u][s],1));n[a++]=f}},pcm64f:(t,e,r,o,i)=>{let n=new Float64Array(t,e),a=0;for(let s=0;s<i;++s)for(let u=0;u<o;++u){let f=Math.max(-1,Math.min(r[u][s],1));n[a++]=f}}};function Yt(t,e,r){let o="pcm"+e+(r?"f":""),i=t[o];if(!i)throw new TypeError("Unsupported data format: "+o);return i}function Re(t){let e=0,r=0;t.buffer?(e=t.byteOffset,r=t.length,t=t.buffer):(e=0,r=t.byteLength);let o=new DataView(t);function i(){let f=o.getUint8(e);return e++,f}function n(){let f=o.getUint16(e,!0);return e+=2,f}function a(){let f=o.getUint32(e,!0);return e+=4,f}function s(f){let c="";for(let l=0;l<f;++l)c+=String.fromCharCode(i());return c}if(s(4)!=="RIFF")throw new TypeError("Invalid WAV file");if(a(),s(4)!=="WAVE")throw new TypeError("Invalid WAV file");let u;for(;e<r;){let f=s(4),c=a(),l=e+c;switch(f){case"fmt ":let d=n();if(d!==1&&d!==3)throw new TypeError("Unsupported format in WAV file: "+d.toString(16));u={format:"lpcm",floatingPoint:d===3,channels:n(),sampleRate:a(),byteRate:a(),blockSize:n(),bitDepth:n()};break;case"data":if(!u)throw new TypeError('Missing "fmt " chunk.');let h=Math.floor(c/u.blockSize),p=u.channels,m=u.sampleRate,w=[];for(let B=0;B<p;++B)w[B]=new Float32Array(h);return Yt(_e,u.bitDepth,u.floatingPoint)(t,e,w,p,h),{sampleRate:m,channelData:w};break}e=l}}function Ie(t,e){let r=e.sampleRate||16e3,o=!!(e.float||e.floatingPoint),i=o?32:e.bitDepth|0||16,n=t.length,a=t[0].length,s=new ArrayBuffer(44+a*n*(i>>3)),u=new DataView(s),f=0;function c(p){u.setUint8(f++,p)}function l(p){u.setUint16(f,p,!0),f+=2}function d(p){u.setUint32(f,p,!0),f+=4}function h(p){for(var m=0;m<p.length;++m)c(p.charCodeAt(m))}return h("RIFF"),d(s.byteLength-8),h("WAVE"),h("fmt "),d(16),l(o?3:1),l(n),d(r),d(r*n*(i>>3)),l(n*(i>>3)),l(i),h("data"),d(s.byteLength-44),Yt(Ue,i,o)(s,f,t,n,a),Buffer(s)}Zt.exports={decode:Re,encode:Ie}});var P=class{constructor(e,r){this.file=e,this.directory=r,this.state="pending",this.id=null,this.href=null,this.name=null,this.percent=0}static traverse(e,r){return be(e,r)}static from(e){let r=[];for(let o of e)if(o instanceof File)r.push(new P(o));else if(o instanceof P)r.push(o);else throw new Error("Unexpected type");return r}get fullPath(){return this.directory?`${this.directory}/${this.file.name}`:this.file.name}isImage(){return["image/gif","image/png","image/jpg","image/jpeg","image/svg+xml"].indexOf(this.file.type)>-1}isVideo(){return["video/mp4","video/quicktime"].indexOf(this.file.type)>-1}saving(e){if(this.state!=="pending"&&this.state!=="saving")throw new Error(`Unexpected transition from ${this.state} to saving`);this.state="saving",this.percent=e}saved(e){var r,o,i;if(this.state!=="pending"&&this.state!=="saving")throw new Error(`Unexpected transition from ${this.state} to saved`);this.state="saved",this.id=(r=e?.id)!==null&&r!==void 0?r:null,this.href=(o=e?.href)!==null&&o!==void 0?o:null,this.name=(i=e?.name)!==null&&i!==void 0?i:null}isPending(){return this.state==="pending"}isSaving(){return this.state==="saving"}isSaved(){return this.state==="saved"}};function be(t,e){return e&&Ee(t)?Lt("",Pe(t)):Promise.resolve(Bt(Array.from(t.files||[])).map(r=>new P(r)))}function xe(t){return t.name.startsWith(".")}function Bt(t){return Array.from(t).filter(e=>!xe(e))}function Ae(t){return new Promise(function(e,r){t.file(e,r)})}function Se(t){return new Promise(function(e,r){let o=[],i=t.createReader(),n=()=>{i.readEntries(a=>{a.length>0?(o.push(...a),n()):e(o)},r)};n()})}async function Lt(t,e){let r=[];for(let o of Bt(e))if(o.isDirectory)r.push(...await Lt(o.fullPath,await Se(o)));else{let i=await Ae(o);r.push(new P(i,t))}return r}function Ee(t){return t.items&&Array.from(t.items).some(e=>{let r=e.webkitGetAsEntry&&e.webkitGetAsEntry();return r&&r.isDirectory})}function Pe(t){return Array.from(t.items).map(e=>e.webkitGetAsEntry()).filter(e=>e!=null)}var O=class extends HTMLElement{connectedCallback(){this.addEventListener("dragenter",G),this.addEventListener("dragover",G),this.addEventListener("dragleave",St),this.addEventListener("drop",Et),this.addEventListener("paste",Pt),this.addEventListener("change",kt)}disconnectedCallback(){this.removeEventListener("dragenter",G),this.removeEventListener("dragover",G),this.removeEventListener("dragleave",St),this.removeEventListener("drop",Et),this.removeEventListener("paste",Pt),this.removeEventListener("change",kt)}get directory(){return this.hasAttribute("directory")}set directory(e){e?this.setAttribute("directory",""):this.removeAttribute("directory")}async attach(e){let r=e instanceof DataTransfer?await P.traverse(e,this.directory):P.from(e);this.dispatchEvent(new CustomEvent("file-attachment-accept",{bubbles:!0,cancelable:!0,detail:{attachments:r}}))&&r.length&&this.dispatchEvent(new CustomEvent("file-attachment-accepted",{bubbles:!0,detail:{attachments:r}}))}};function Mt(t){return Array.from(t.types).indexOf("Files")>=0}var it=null;function G(t){let e=t.currentTarget;it&&clearTimeout(it),it=window.setTimeout(()=>e.removeAttribute("hover"),200);let r=t.dataTransfer;!r||!Mt(r)||(r.dropEffect="copy",e.setAttribute("hover",""),t.preventDefault())}function St(t){t.dataTransfer&&(t.dataTransfer.dropEffect="none"),t.currentTarget.removeAttribute("hover"),t.stopPropagation(),t.preventDefault()}function Et(t){let e=t.currentTarget;if(!(e instanceof O))return;e.removeAttribute("hover");let r=t.dataTransfer;!r||!Mt(r)||(e.attach(r),t.stopPropagation(),t.preventDefault())}var ke=/^image\/(gif|png|jpeg)$/;function Be(t){for(let e of t)if(e.kind==="file"&&ke.test(e.type))return e.getAsFile();return null}function Pt(t){if(!t.clipboardData||!t.clipboardData.items)return;let e=t.currentTarget;if(!(e instanceof O))return;let r=Be(t.clipboardData.items);if(!r)return;let o=[r];e.attach(o),t.preventDefault()}function kt(t){let e=t.currentTarget;if(!(e instanceof O))return;let r=t.target;if(!(r instanceof HTMLInputElement))return;let o=e.getAttribute("input");if(o&&r.id!==o)return;let i=r.files;!i||i.length===0||(e.attach(i),r.value="")}window.customElements.get("file-attachment")||(window.FileAttachmentElement=O,window.customElements.define("file-attachment",O));function Y(){throw new Error("Cycle detected")}function at(){if(_>1)_--;else{for(var t,e=!1;$!==void 0;){var r=$;for($=void 0,ot++;r!==void 0;){var o=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&jt(r))try{r.c()}catch(i){e||(t=i,e=!0)}r=o}}if(ot=0,_--,e)throw t}}var v=void 0,$=void 0,_=0,ot=0,H=0;function Ot(t){if(v!==void 0){var e=t.n;if(e===void 0||e.t!==v)return v.s=e={i:0,S:t,p:void 0,n:v.s,t:v,e:void 0,x:void 0,r:e},t.n=e,32&v.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.p!==void 0&&(e.p.n=e.n,e.n!==void 0&&(e.n.p=e.p),e.p=void 0,e.n=v.s,v.s.p=e,v.s=e),e}}function b(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}b.prototype.h=function(){return!0};b.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)};b.prototype.U=function(t){var e=t.e,r=t.x;e!==void 0&&(e.x=r,t.e=void 0),r!==void 0&&(r.e=e,t.x=void 0),t===this.t&&(this.t=r)};b.prototype.subscribe=function(t){var e=this;return ft(function(){var r=e.value,o=32&this.f;this.f&=-33;try{t(r)}finally{this.f|=o}})};b.prototype.valueOf=function(){return this.value};b.prototype.toString=function(){return this.value+""};b.prototype.peek=function(){return this.v};Object.defineProperty(b.prototype,"value",{get:function(){var t=Ot(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){ot>100&&Y(),this.v=t,this.i++,H++,_++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{at()}}}});function st(t){return new b(t)}function jt(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Dt(t){for(var e=t.s;e!==void 0;e=e.n){var r=e.S.n;r!==void 0&&(e.r=r),e.S.n=e,e.i=-1}}function Ct(t){for(var e=t.s,r=void 0;e!==void 0;){var o=e.n;e.i===-1?(e.S.U(e),e.n=void 0):(r!==void 0&&(r.p=e),e.p=void 0,e.n=r,r=e),e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=o}t.s=r}function j(t){b.call(this,void 0),this.x=t,this.s=void 0,this.g=H-1,this.f=4}(j.prototype=new b).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===H))return!0;if(this.g=H,this.f|=1,this.i>0&&!jt(this))return this.f&=-2,!0;var t=v;try{Dt(this),v=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return v=t,Ct(this),this.f&=-2,!0};j.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}b.prototype.S.call(this,t)};j.prototype.U=function(t){if(b.prototype.U.call(this,t),this.t===void 0){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};j.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};j.prototype.peek=function(){if(this.h()||Y(),16&this.f)throw this.v;return this.v};Object.defineProperty(j.prototype,"value",{get:function(){1&this.f&&Y();var t=Ot(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function Tt(t){return new j(t)}function _t(t){var e=t.u;if(t.u=void 0,typeof e=="function"){_++;var r=v;v=void 0;try{e()}catch(o){throw t.f&=-2,t.f|=8,ut(t),o}finally{v=r,at()}}}function ut(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,_t(t)}function Le(t){if(v!==this)throw new Error("Out-of-order effect");Ct(this),v=t,this.f&=-2,8&this.f&&ut(this),at()}function V(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}V.prototype.c=function(){var t=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{t()}};V.prototype.S=function(){1&this.f&&Y(),this.f|=1,this.f&=-9,_t(this),Dt(this),_++;var t=v;return v=this,Le.bind(this,t)};V.prototype.N=function(){2&this.f||(this.f|=2,this.o=$,$=this)};V.prototype.d=function(){this.f|=8,1&this.f||ut(this)};function ft(t){var e=new V(t);return e.c(),e.d.bind(e)}Symbol.observable||=Symbol("observable");var Ut=t=>t&&!!(t[Symbol.observable]||t[Symbol.asyncIterator]||t.call&&t.set||t.subscribe||t.then),Me=new FinalizationRegistry(t=>t.call?.()),Oe=t=>t&&(()=>t.unsubscribe?.()),Rt=(t,e,r,o,i,n)=>t&&(n=Oe((t[Symbol.observable]?.()||t).subscribe?.(e,r,o))||t.set&&t.call?.(i,e)||(t.then?.(a=>(!i&&e(a),o?.()),r)||(async a=>{try{for await(a of t){if(i)return;e(a)}o?.()}catch(s){r?.(s)}})())&&(a=>i=1),Me.register(t,n),n);var It=t=>t&&t.peek,lt=t=>t&&t[Ft],Ft=Symbol("signal-struct");S.isStruct=lt;function S(t,e){if(lt(t)&&!e)return t;let r,o;if(ct(t)){r=Object.create(e||Object.getPrototypeOf(t)),o={};let i=Object.getOwnPropertyDescriptors(t);if(lt(t))for(let n in i)Object.defineProperty(r,n,i[n]);else for(let n in i)o[n]=je(r,n,i[n].get?Tt(i[n].get.bind(r)):i[n].value);return Object.defineProperty(r,Ft,{configurable:!1,enumerable:!1,value:!0}),r}return Array.isArray(t)?t.map(i=>S(i)):t}function je(t,e,r){let o,i=It(r)?r:ct(r)||Array.isArray(r)?st(S(r)):st((o=Ut(r))?void 0:r);return o&&Rt(r,n=>i.value=n),Object.defineProperty(t,e,{get(){return i.value},set:!It(r)&&ct(r)?n=>n?Object.assign(i.value,n):i.value=S(n):n=>i.value=S(n),enumerable:!0,configurable:!1}),i}function ct(t){return t&&t.constructor===Object}var U=(t,e,r,o=null)=>{let i=0,n,a,s,u=r.length,f=e.length,{remove:c,same:l,insert:d,replace:h}=U;for(;i<u&&i<f&&l(e[i],r[i]);)i++;for(;i<u&&i<f&&l(r[u-1],e[f-1]);)o=r[--f,--u];if(i==f)for(;i<u;)d(o,r[i++],t);else{for(n=e[i];i<u;)s=r[i++],a=n?n.nextSibling:o,l(n,s)?n=a:i<u&&l(r[i],a)?(h(n,s,t),n=a):d(n,s,t);for(;!l(n,o);)a=n.nextSibling,c(n,t),n=a}return r};U.same=(t,e)=>t==e;U.replace=(t,e,r)=>r.replaceChild(e,t);U.insert=(t,e,r)=>r.insertBefore(e,t);U.remove=(t,e)=>e.removeChild(t);var Nt=U;var R={},De={},Ce={},Wt=t=>t===null?De:t===void 0?Ce:typeof t=="number"||t instanceof Number?R[t]||(R[t]=new Number(t)):typeof t=="string"||t instanceof String?R[t]||(R[t]=new String(t)):typeof t=="boolean"||t instanceof Boolean?R[t]||(R[t]=new Boolean(t)):t;var y={},$t=(t,e,r,o)=>{let i=o.startsWith("on")&&o.slice(2),n=g(t,e,":"+o),a;return i?s=>{a&&qt(t,i,a),a=n(s),a&&zt(t,i,a)}:s=>J(t,o,n(s))},J=(t,e,r)=>{r==null||r===!1?t.removeAttribute(e):t.setAttribute(e,r===!0?"":typeof r=="number"||typeof r=="string"?r:"")};y[""]=(t,e)=>{let r=g(t,e,":");return o=>{let i=r(o);for(let n in i)J(t,Gt(n),i[n])}};var Vt=Symbol(":each"),dt=Symbol(":ref");y.ref=(t,e,r)=>{if(t.hasAttribute(":each")){t[dt]=e;return}r[e]=t};y.with=(t,e,r)=>{let o=g(t,e,"with");D(t,S(o(r),r))};y.if=(t,e)=>{let r=document.createTextNode(""),o=[g(t,e,":if")],i=[t],n=t;for(;(n=t.nextElementSibling)&&n.hasAttribute(":else");)n.removeAttribute(":else"),(e=n.getAttribute(":if"))?(n.removeAttribute(":if"),n.remove(),i.push(n),o.push(g(t,e,":else :if"))):(n.remove(),i.push(n),o.push(()=>1));return t.replaceWith(n=r),a=>{let s=o.findIndex(u=>u(a));i[s]!=n&&((n[Vt]||n).replaceWith(n=i[s]||r),D(n,a))}};y.each=(t,e)=>{let r=Te(e);if(!r)return Z(new Error,t,e);let o=t[Vt]=document.createTextNode("");t.replaceWith(o);let i=g(t,r.items,":each"),n=new WeakMap,a=new WeakMap,s=[];return u=>{let f=i(u);f?typeof f=="number"?f=Array.from({length:f},(d,h)=>[h,h+1]):Array.isArray(f)?f=f.map((d,h)=>[h+1,d]):typeof f=="object"?f=Object.entries(f):Z(Error("Bad list value"),t,e,":each",f):f=[];let c=[],l=[];for(let[d,h]of f){let p=Wt(h),m=a.get(p);if(m||(m=t.cloneNode(!0),a.set(p,m)),c.push(m),!n.has(p)){let w=Object.create(u);w[r.item]=h,r.index&&(w[r.index]=d),t[dt]&&(w[t[dt]]=m),n.set(p,w)}l.push(n.get(p))}Nt(o.parentNode,s,c,o),s=c;for(let d=0;d<c.length;d++)D(c[d],l[d])}};function Te(t){let e=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,o=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,i=t.match(o);if(!i)return;let n={};n.items=i[2].trim();let a=i[1].replace(r,"").trim(),s=a.match(e);return s?(n.item=a.replace(e,"").trim(),n.index=s[1].trim()):n.item=a,n}y.id=(t,e)=>{let r=g(t,e,":id"),o=i=>t.id=i||i===0?i:"";return i=>o(r(i))};y.class=(t,e)=>{let r=g(t,e,":class"),o=t.className;return i=>{let n=r(i);t.className=o+typeof n=="string"?n:(Array.isArray(n)?n:Object.entries(n).map(([a,s])=>s?a:"")).filter(Boolean).join(" ")}};y.style=(t,e)=>{let r=g(t,e,":style"),o=t.getAttribute("style")||"";return o.endsWith(";")||(o+="; "),i=>{let n=r(i);if(typeof n=="string")t.setAttribute("style",o+n);else for(let a in n)t.style[a]=n[a]}};y.text=(t,e)=>{let r=g(t,e,":text");return o=>{let i=r(o);t.textContent=i??""}};y.value=(t,e)=>{let r=g(t,e,":value"),o=t.type==="text"||t.type===""?i=>t.setAttribute("value",t.value=i??""):t.type==="checkbox"?i=>(t.value=i?"on":"",J(t,"checked",i)):t.type==="select-one"?i=>{for(let n in t.options)n.removeAttribute("selected");t.value=i,t.selectedOptions[0]?.setAttribute("selected","")}:i=>t.value=i;return i=>o(r(i))};var Kt=Symbol("stop");y.on=(t,e)=>{let r=g(t,e,":on"),o={};return i=>{for(let n in o)qt(t,n,o[n]);o=r(i);for(let n in o)zt(t,n,o[n])}};var zt=(t,e,r)=>{if(e.indexOf("..")<0)t.addEventListener(e,r);else{let o=e.split("..").map(n=>n.startsWith("on")?n.slice(2):n),i=(n,a=0)=>{let s=u=>{t.removeEventListener(o[a],s),typeof(n=n.call(t,u))!="function"&&(n=()=>{}),++a<o.length?i(n,a):r[Kt]||(console.log("reset"),i(r))};t.addEventListener(o[a],s)};i(r)}},qt=(t,e,r)=>{e.indexOf("..")>=0&&(console.log("rewire"),r[Kt]=!0),t.removeEventListener(e,r)};y.data=(t,e)=>{let r=g(t,e,":data");return o=>{let i=r(o);for(let n in i)t.dataset[n]=i[n]}};y.aria=(t,e)=>{let r=g(t,e,":aria"),o=i=>{for(let n in i)J(t,"aria-"+Gt(n),i[n]==null?null:i[n]+"")};return i=>o(r(i))};var ht={};function g(t,e,r){if(ht[e])return ht[e];let o=/^[\n\s]*if.*\(.*\)/.test(e)||/^(let|const)\s/.test(e)?`(() => { ${e} })()`:e,i;try{i=new Function("__scope",`with (__scope) { return (${o}) };`).bind(t)}catch(n){return Z(n,t,e,r)}return ht[e]=n=>{let a;try{a=i(n)}catch(s){return Z(s,t,e,r)}return a}}function Z(t,e,r,o){Object.assign(t,{element:e,expression:r}),console.warn(`\u2234 ${t.message}

${o}=${r?`"${r}"

`:""}`,e),setTimeout(()=>{throw t},0)}function Gt(t){return t.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,e=>"-"+e.toLowerCase())}var Q=new WeakMap;function D(t,e){if(!t.children)return;if(Q.has(t))return Q.get(t);let r=S(e||{}),o=[],i=(n,a=n.parentNode)=>{if(n.attributes)for(let s=0;s<n.attributes.length;){let u=n.attributes[s];if(u.name[0]!==":"){s++;continue}n.removeAttribute(u.name);let f=u.value;if(!f)continue;let c=u.name.slice(1).split(":");for(let l of c){let d=y[l]||$t;if(o.push(d(n,f,r,l)||(()=>{})),Q.has(n)||n.parentNode!==a)return!1}}for(let s=0,u;u=n.children[s];s++)i(u,n)===!1&&s--};i(t);for(let n of o)ft(()=>n(r));return Object.seal(r),Q.set(t,r),r}var Ht=D;var We=we(Jt());var ee=function(){function t(){}return t.prototype.then=function(e,r){let o=new t,i=this.s;if(i){let n=1&i?e:r;if(n){try{x(o,1,n(this.v))}catch(a){x(o,2,a)}return o}return this}return this.o=function(n){try{let a=n.v;1&n.s?x(o,1,e?e(a):a):r?x(o,1,r(a)):x(o,2,a)}catch(a){x(o,2,a)}},o},t}();function x(t,e,r){if(!t.s){if(r instanceof ee){if(!r.s)return void(r.o=x.bind(null,t,e));1&e&&(e=r.s),r=r.v}if(r&&r.then)return void r.then(x.bind(null,t,e),x.bind(null,t,2));t.s=e,t.v=r;let o=t.o;o&&o(t)}}var Fe=0,F=typeof WeakMap=="function"?WeakMap:function(){var t=typeof Symbol=="function"?Symbol(0):"__weak$"+ ++Fe;this.set=function(e,r){e[t]=r},this.get=function(e){return e[t]}};function yt(t,e){return new Promise(function(r,o){t.onsuccess=function(){var i=t.result;e&&(i=e(i)),r(i)},t.onerror=function(){o(t.error)}})}function re(t,e){return yt(t.openCursor(e),function(r){return r?[r.key,r.value]:[]})}function Qt(t){return new Promise(function(e,r){t.oncomplete=function(){e()},t.onabort=function(){r(t.error)},t.onerror=function(){r(t.error)}})}function pt(t){if(!function(e){return!!(typeof e=="number"||typeof e=="string"||typeof e=="object"&&e&&(Array.isArray(e)||"setUTCFullYear"in e||typeof ArrayBuffer=="function"&&ArrayBuffer.isView(e)||"byteLength"in e&&"length"in e))}(t))throw Error("kv-storage: The given value is not allowed as a key")}var ne={};function Xt(t,e){return re(t,ie(e))}function ie(t){return t===ne?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(t,!0)}var oe=new F,tt=new F,et=new F,ae=new F,X=function(){};function te(t,e){return e(function(r,o){try{let f=function(){return tt.set(t,n),et.set(t,void 0),{value:s,done:n===void 0}};var i=tt.get(t);if(i===void 0)return Promise.resolve({value:void 0,done:!0});var n,a,s,u=function(c,l){var d,h=-1;t:{for(var p=0;p<l.length;p++){var m=l[p][0];if(m){var w=m();if(w&&w.then)break t;if(w===c){h=p;break}}else h=p}if(h!==-1){do{for(var B=l[h][1];!B;)B=l[++h][1];var z=B();if(z&&z.then){d=!0;break t}var bt=l[h][2];h++}while(bt&&!bt());return z}}let N=new ee,q=x.bind(null,N,2);return(d?z.then(nt):w.then(function T(L){for(;;){if(L===c){h=p;break}if(++p===l.length){if(h!==-1)break;return void x(N,1,W)}if(m=l[p][0]){if((L=m())&&L.then)return void L.then(T).then(void 0,q)}else h=p}do{for(var M=l[h][1];!M;)M=l[++h][1];var W=M();if(W&&W.then)return void W.then(nt).then(void 0,q);var xt=l[h][2];h++}while(xt&&!xt());x(N,1,W)})).then(void 0,q),N;function nt(T){for(;;){var L=l[h][2];if(!L||L())break;for(var M=l[++h][1];!M;)M=l[++h][1];if((T=M())&&T.then)return void T.then(nt).then(void 0,q)}x(N,1,T)}}(ae.get(t),[[function(){return"keys"},function(){return Promise.resolve(function(c,l){return re(c,ie(l)).then(function(d){return d[0]})}(o,i)).then(function(c){s=n=c})}],[function(){return"values"},function(){return Promise.resolve(Xt(o,i)).then(function(c){var l;n=(l=c)[0],s=a=l[1]})}],[function(){return"entries"},function(){return Promise.resolve(Xt(o,i)).then(function(c){var l;a=(l=c)[1],s=(n=l[0])===void 0?void 0:[n,a]})}]]);return Promise.resolve(u&&u.then?u.then(f):f())}catch(f){return Promise.reject(f)}})}function vt(t,e){var r=new X;return ae.set(r,t),oe.set(r,e),tt.set(r,ne),et.set(r,void 0),r}X.prototype.return=function(){tt.set(this,void 0)},X.prototype.next=function(){var t=this,e=oe.get(this);if(!e)return Promise.reject(new TypeError("Invalid this value"));var r,o=et.get(this);return r=o!==void 0?o.then(function(){return te(t,e)}):te(this,e),et.set(this,r),r},typeof Symbol=="function"&&Symbol.asyncIterator&&(X.prototype[Symbol.asyncIterator]=function(){return this});var I=function(t,e,r){try{return k.get(t)===null&&function(o){var i=gt.get(o);k.set(o,new Promise(function(n,a){var s=self.indexedDB.open(i,1);s.onsuccess=function(){var u=s.result;(function(f,c,l){if(f.objectStoreNames.length!==1||f.objectStoreNames[0]!==C)return l(mt(c)),!1;var d=f.transaction(C,"readonly").objectStore(C);return!(d.autoIncrement||d.keyPath||d.indexNames.length)||(l(mt(c)),!1)})(u,i,a)&&(u.onclose=function(){k.set(o,null)},u.onversionchange=function(){u.close(),k.set(o,null)},n(u))},s.onerror=function(){return a(s.error)},s.onupgradeneeded=function(){try{s.result.createObjectStore(C)}catch(u){a(u)}}}))}(t),Promise.resolve(k.get(t)).then(function(o){var i=o.transaction(C,e),n=i.objectStore(C);return r(i,n)})}catch(o){return Promise.reject(o)}},gt=new F,k=new F,C="store",E=function(t){var e="kv-storage:"+t;k.set(this,null),gt.set(this,e),this.backingStore={database:e,store:C,version:1}};function mt(t){return new Error('kv-storage: database "'+t+'" corrupted')}E.prototype.set=function(t,e){try{return pt(t),I(this,"readwrite",function(r,o){return e===void 0?o.delete(t):o.put(e,t),Qt(r)})}catch(r){return Promise.reject(r)}},E.prototype.get=function(t){try{return pt(t),I(this,"readonly",function(e,r){return yt(r.get(t))})}catch(e){return Promise.reject(e)}},E.prototype.delete=function(t){try{return pt(t),I(this,"readwrite",function(e,r){return r.delete(t),Qt(e)})}catch(e){return Promise.reject(e)}},E.prototype.clear=function(){try{let i=function(){function n(){return yt(self.indexedDB.deleteDatabase(gt.get(t)))}var a=function(){if(e){try{e.close()}catch{}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return a&&a.then?a.then(n):n()};var t=this,e,r=k.get(t),o=function(){if(r!==null){let a=function(){k.set(t,null)};var n=function(s,u){try{var f=Promise.resolve(r).then(function(c){e=c})}catch{return}return f&&f.then?f.then(void 0,function(){}):f}();return n&&n.then?n.then(a):a()}}();return o&&o.then?o.then(i):i()}catch(i){return Promise.reject(i)}},E.prototype.keys=function(){var t=this;return vt("keys",function(e){return I(t,"readonly",e)})},E.prototype.values=function(){var t=this;return vt("values",function(e){return I(t,"readonly",e)})},E.prototype.entries=function(){var t=this;return vt("entries",function(e){return I(t,"readonly",e)})},typeof Symbol=="function"&&Symbol.asyncIterator&&(E.prototype[Symbol.asyncIterator]=E.prototype.entries);var Ne=new E("default");var rt=48e3,K=1024,$e=new OfflineAudioContext(2,rt*60*60,rt),wt=t=>Math.floor(t*rt/K),se=t=>t*K/rt;async function ue(t){console.time("fetch");let e=await fetch(t);if(!e.ok)throw new Error(`HTTP error: status=${e.status}`);let r=await e.arrayBuffer();return console.timeEnd("fetch"),r}async function fe(t,e){console.time("decode");let r=await $e.decodeAudioData(t);return console.timeEnd("decode"),r}async function le(t){if(!t)return"";console.time("to waveform string");let e=t.getChannelData(0),r="",o=0;for(let a=0;a<e.length;a++)o=Math.max(Math.abs(e[a]),o);let i=Math.max(1/o,1);for(let a=0;a<e.length;a++)e[a]=Math.max(Math.min(i*e[a],1),-1);let n=2;for(let a=0,s=K;a<e.length;){let u=0,f=0;for(;a<s;a++)u+=a>e.length?0:e[a]**2;let c=Math.sqrt(u/K);r+=String.fromCharCode(256+Math.min(100,Math.ceil(c*100*n))),s+=K}return console.timeEnd("to waveform string"),r}window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;var A=Ht(document.querySelector(".waveedit"),{loading:!0,recording:!1,playing:!1,volume:1,waveform:"",wavURL:"",trackCaret(t){let{wavearea:e,audio:r}=A,o=n=>{A.playing||(r.currentTime=se(e.selectionStart))},i="keypress keydown mousedown click touchstart input select selectstart paste cut change".split(" ");return i.map(n=>e.addEventListener(n,o)),()=>i.map(n=>e.removeEventListener(n,o))},play(t){let{wavearea:e,audio:r}=A;A.playing=!0;let o=r.currentTime,i=wt(o),n=[e.selectionStart,e.selectionEnd],a=n[0]!==n[1]?n[1]:e.value.length,s,u=()=>{let f=wt(r.currentTime-o),c=i+f;e.selectionStart=e.selectionEnd=c,c>=a?r.pause():s=requestAnimationFrame(u)};return u(),e.focus(),()=>{A.playing=!1,cancelAnimationFrame(s),s=null,n[0]!==n[1]&&(e.selectionStart=i,e.selectionEnd=a)}}}),ce=["https://upload.wikimedia.org/wikipedia/commons/9/9c/Vivaldi_-_Magnificat_01_Magnificat.oga","https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg","https://upload.wikimedia.org/wikipedia/commons/9/96/Carcassi_Op_60_No_1.ogg"];async function Ke(){A.loading=!0;let t;if(!t){console.log("loading default audio");let o=ce[Math.floor(Math.random()*ce.length)];t=await ue(o)}let e=new Blob([t],{type:"audio/wav"});A.wavURL=URL.createObjectURL(e),A.audio.onload=o=>{URL.revokeObjectURL(A.wavURL)};let r=await fe(t);A.waveform=await le(r),A.loading=!1}Ke();
//# sourceMappingURL=waveplay.js.map
