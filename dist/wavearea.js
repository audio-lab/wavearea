function $(){throw new Error("Cycle detected")}function D(){if(T>1)T--;else{for(var t,e=!1;R!==void 0;){var r=R;for(R=void 0,z++;r!==void 0;){var i=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&tt(r))try{r.c()}catch(n){e||(t=n,e=!0)}r=i}}if(z=0,T--,e)throw t}}function J(t){if(T>0)return t();T++;try{return t()}finally{D()}}var p=void 0,R=void 0,T=0,z=0,U=0;function Q(t){if(p!==void 0){var e=t.n;if(e===void 0||e.t!==p)return e={i:0,S:t,p:p.s,n:void 0,t:p,e:void 0,x:void 0,r:e},p.s!==void 0&&(p.s.n=e),p.s=e,t.n=e,32&p.f&&t.S(e),e;if(e.i===-1)return e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=p.s,e.n=void 0,p.s.n=e,p.s=e),e}}function b(t){this.v=t,this.i=0,this.n=void 0,this.t=void 0}b.prototype.h=function(){return!0};b.prototype.S=function(t){this.t!==t&&t.e===void 0&&(t.x=this.t,this.t!==void 0&&(this.t.e=t),this.t=t)};b.prototype.U=function(t){if(this.t!==void 0){var e=t.e,r=t.x;e!==void 0&&(e.x=r,t.e=void 0),r!==void 0&&(r.e=e,t.x=void 0),t===this.t&&(this.t=r)}};b.prototype.subscribe=function(t){var e=this;return Z(function(){var r=e.value,i=32&this.f;this.f&=-33;try{t(r)}finally{this.f|=i}})};b.prototype.valueOf=function(){return this.value};b.prototype.toString=function(){return this.value+""};b.prototype.peek=function(){return this.v};Object.defineProperty(b.prototype,"value",{get:function(){var t=Q(this);return t!==void 0&&(t.i=this.i),this.v},set:function(t){if(t!==this.v){z>100&&$(),this.v=t,this.i++,U++,T++;try{for(var e=this.t;e!==void 0;e=e.x)e.t.N()}finally{D()}}}});function Y(t){return new b(t)}function tt(t){for(var e=t.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function et(t){for(var e=t.s;e!==void 0;e=e.n){var r=e.S.n;if(r!==void 0&&(e.r=r),e.S.n=e,e.i=-1,e.n===void 0){t.s=e;break}}}function rt(t){for(var e=t.s,r=void 0;e!==void 0;){var i=e.p;e.i===-1?(e.S.U(e),i!==void 0&&(i.n=e.n),e.n!==void 0&&(e.n.p=i)):r=e,e.S.n=e.r,e.r!==void 0&&(e.r=void 0),e=i}t.s=r}function E(t){b.call(this,void 0),this.x=t,this.s=void 0,this.g=U-1,this.f=4}(E.prototype=new b).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===U))return!0;if(this.g=U,this.f|=1,this.i>0&&!tt(this))return this.f&=-2,!0;var t=p;try{et(this),p=this;var e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return p=t,rt(this),this.f&=-2,!0};E.prototype.S=function(t){if(this.t===void 0){this.f|=36;for(var e=this.s;e!==void 0;e=e.n)e.S.S(e)}b.prototype.S.call(this,t)};E.prototype.U=function(t){if(this.t!==void 0&&(b.prototype.U.call(this,t),this.t===void 0)){this.f&=-33;for(var e=this.s;e!==void 0;e=e.n)e.S.U(e)}};E.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var t=this.t;t!==void 0;t=t.x)t.t.N()}};E.prototype.peek=function(){if(this.h()||$(),16&this.f)throw this.v;return this.v};Object.defineProperty(E.prototype,"value",{get:function(){1&this.f&&$();var t=Q(this);if(this.h(),t!==void 0&&(t.i=this.i),16&this.f)throw this.v;return this.v}});function it(t){return new E(t)}function ot(t){var e=t.u;if(t.u=void 0,typeof e=="function"){T++;var r=p;p=void 0;try{e()}catch(i){throw t.f&=-2,t.f|=8,H(t),i}finally{p=r,D()}}}function H(t){for(var e=t.s;e!==void 0;e=e.n)e.S.U(e);t.x=void 0,t.s=void 0,ot(t)}function wt(t){if(p!==this)throw new Error("Out-of-order effect");rt(this),p=t,this.f&=-2,8&this.f&&H(this),D()}function B(t){this.x=t,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}B.prototype.c=function(){var t=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{t()}};B.prototype.S=function(){1&this.f&&$(),this.f|=1,this.f&=-9,ot(this),et(this),T++;var t=p;return p=this,wt.bind(this,t)};B.prototype.N=function(){2&this.f||(this.f|=2,this.o=R,R=this)};B.prototype.d=function(){this.f|=8,1&this.f||H(this)};function Z(t){var e=new B(t);try{e.c()}catch(r){throw e.d(),r}return e.d.bind(e)}Symbol.observable||=Symbol("observable");var nt=t=>t&&!!(t[Symbol.observable]||t[Symbol.asyncIterator]||t.call&&t.set||t.subscribe||t.then),St=new FinalizationRegistry(t=>t.call?.()),kt=t=>t&&(()=>t.unsubscribe?.()),st=(t,e,r,i,n,o)=>t&&(o=kt((t[Symbol.observable]?.()||t).subscribe?.(e,r,i))||t.set&&t.call?.(n,e)||(t.then?.(s=>(!n&&e(s),i?.()),r)||(async s=>{try{for await(s of t){if(n)return;e(s)}i?.()}catch(l){r?.(l)}})())&&(s=>n=1),St.register(t,o),o);var Ot=t=>t&&t.peek,V=t=>t&&t[at],at=Symbol("signal-struct");g.isStruct=V;function g(t,e){if(V(t)&&!e)return t;if(I(t)){let r=Object.create(e||Object.getPrototypeOf(t)),i={},n=Object.getOwnPropertyDescriptors(t);for(let o in n){let s=n[o];if(s.get){let l=i[o]=it(s.get.bind(r));Object.defineProperty(r,o,{get(){return l.value},set:s.set?.bind(r),configurable:!1,enumerable:!0})}else{let l=s.value,f=nt(l),c=i[o]=Ot(l)?l:Y(f?void 0:I(l)?Object.seal(g(l)):Array.isArray(l)?g(l):l);f&&st(l,d=>c.value=d),Object.defineProperty(r,o,{get(){return c.value},set(d){if(I(d)){if(I(c.value))try{Object.assign(c.value,d);return}catch{}c.value=Object.seal(g(d))}else Array.isArray(d)?c.value=g(d):c.value=d},enumerable:!0,configurable:!1})}}return Object.defineProperty(r,at,{configurable:!1,enumerable:!1,value:!0}),r}if(Array.isArray(t)&&!V(t[0]))for(let r=0;r<t.length;r++)t[r]=g(t[r]);return t}function I(t){return t&&t.constructor===Object}function lt(t,e,r,i){let n=new Map,o=new Map,s,l;for(s=0;s<e.length;s++)n.set(e[s],s);for(s=0;s<r.length;s++)o.set(r[s],s);for(s=l=0;s!==e.length||l!==r.length;){var f=e[s],c=r[l];if(f===null)s++;else if(r.length<=l)t.removeChild(e[s]),s++;else if(e.length<=s)t.insertBefore(c,e[s]||i),l++;else if(f===c)s++,l++;else{var d=o.get(f),u=n.get(c);d===void 0?(t.removeChild(e[s]),s++):u===void 0?(t.insertBefore(c,e[s]||i),l++):(t.insertBefore(e[u],e[s]||i),e[u]=null,u>s+1&&s++,l++)}}return r}var M={},xt={},At={},ft=t=>t===null?xt:t===void 0?At:typeof t=="number"||t instanceof Number?M[t]||(M[t]=new Number(t)):typeof t=="string"||t instanceof String?M[t]||(M[t]=new String(t)):typeof t=="boolean"||t instanceof Boolean?M[t]||(M[t]=new Boolean(t)):t;var W={},w={};W.if=(t,e)=>{let r=document.createTextNode(""),i=[v(t,e,":if")],n=[t],o=t;for(;(o=t.nextElementSibling)&&o.hasAttribute(":else");)o.removeAttribute(":else"),(e=o.getAttribute(":if"))?(o.removeAttribute(":if"),o.remove(),n.push(o),i.push(v(t,e,":else :if"))):(o.remove(),n.push(o),i.push(()=>1));return t.replaceWith(o=r),s=>{let l=i.findIndex(f=>f(s));n[l]!=o&&((o[ut]||o).replaceWith(o=n[l]||r),j(o,s))}};W.with=(t,e,r)=>{let i=v(t,e,"with");j(t,g(i(r),r))};var ut=Symbol(":each");W.each=(t,e)=>{let r=Nt(e);if(!r)return F(new Error,t,e);let i=t[ut]=document.createTextNode("");t.replaceWith(i);let n=v(t,r[2],":each"),o=t.getAttribute(":key"),s=o?v(null,o):null;t.removeAttribute(":key");let l=new WeakMap,f=new WeakMap,c=[];return d=>{let u=n(d);u?typeof u=="number"?u=Array.from({length:u},(m,k)=>[k,k+1]):Array.isArray(u)?u=u.map((m,k)=>[k+1,m]):typeof u=="object"?u=Object.entries(u):F(Error("Bad list value"),t,e,":each",u):u=[];let y=[],A=[];for(let[m,k]of u){let N,L,x=s?.({[r[0]]:k,[r[1]]:m});jt(x)&&(x=ft(x)),x==null?N=t.cloneNode(!0):(N=f.get(x))||f.set(x,N=t.cloneNode(!0)),y.push(N),x==null||!(L=l.get(x))?(L=g({[r[0]]:k,[r[1]]:m},d),x!=null&&l.set(x,L)):L[r[0]]=k,A.push(L)}lt(i.parentNode,c,y,i),c=y;for(let m=0;m<y.length;m++)j(y[m],A[m])}};function Nt(t){let e=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,i=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,n=t.match(i);if(!n)return;let o=n[2].trim(),s=n[1].replace(r,"").trim(),l=s.match(e);return l?[s.replace(e,"").trim(),l[1].trim(),o]:[s,"",o]}w.ref=(t,e,r)=>{r[e]=t};w.id=(t,e)=>{let r=v(t,e,":id"),i=n=>t.id=n||n===0?n:"";return n=>i(r(n))};w.class=(t,e)=>{let r=v(t,e,":class"),i=t.className;return n=>{let o=r(n),s=typeof o=="string"?o:(Array.isArray(o)?o:Object.entries(o).map(([l,f])=>f?l:"")).filter(Boolean).join(" ");t.className=[i,s].filter(Boolean).join(" ")}};w.style=(t,e)=>{let r=v(t,e,":style"),i=t.getAttribute("style")||"";return i.endsWith(";")||(i+="; "),n=>{let o=r(n);if(typeof o=="string")t.setAttribute("style",i+o);else{t.setAttribute("style",i);for(let s in o)t.style.setProperty(s,o[s])}}};w.text=(t,e)=>{let r=v(t,e,":text");return i=>{let n=r(i);t.textContent=n??""}};w.data=(t,e)=>{let r=v(t,e,":data");return i=>{let n=r(i);for(let o in n)t.dataset[o]=n[o]}};w.aria=(t,e)=>{let r=v(t,e,":aria"),i=n=>{for(let o in n)K(t,"aria-"+pt(o),n[o]==null?null:n[o]+"")};return n=>i(r(n))};w[""]=(t,e)=>{let r=v(t,e,":");if(r)return i=>{let n=r(i);for(let o in n)K(t,pt(o),n[o])}};w.value=(t,e)=>{let r=v(t,e,":value"),i,n,o=t.type==="text"||t.type===""?s=>t.setAttribute("value",t.value=s??""):t.tagName==="TEXTAREA"||t.type==="text"||t.type===""?s=>(i=t.selectionStart,n=t.selectionEnd,t.setAttribute("value",t.value=s??""),i&&t.setSelectionRange(i,n)):t.type==="checkbox"?s=>(t.value=s?"on":"",K(t,"checked",s)):t.type==="select-one"?s=>{for(let l in t.options)l.removeAttribute("selected");t.value=s,t.selectedOptions[0]?.setAttribute("selected","")}:s=>t.value=s;return s=>o(r(s))};w.on=(t,e)=>{let r=v(t,e,":on");return i=>{let n=r(i),o=[];for(let s in n)o.push(ht(t,s,n[s]));return()=>{for(let s of o)s()}}};var dt=(t,e,r,i)=>{let n=i.startsWith("on")&&i.slice(2),o=v(t,e,":"+i);if(o)return n?s=>{let l=o(s)||(()=>{});return ht(t,n,l)}:s=>K(t,i,o(s))},ht=(t,e,r)=>{if(!r)return;let i=e.split("..").map(l=>{let f={evt:"",target:t,test:()=>!0};return f.evt=(l.startsWith("on")?l.slice(2):l).replace(/\.(\w+)?-?([-\w]+)?/g,(c,d,u="")=>(f.test=Ct[d]?.(f,...u.split("-"))||f.test,"")),f});if(i.length==1)return s(r,i[0]);let n=(l,f=0)=>{let c;return c=s(u=>{f&&c();let y=l.call(t,u);typeof y!="function"&&(y=()=>{}),f+1<i.length&&n(y,f?f+1:1)},i[f])},o=n(r);return()=>o();function s(l,{evt:f,target:c,test:d,defer:u,stop:y,prevent:A,...m}){u&&(l=u(l));let k=N=>d(N)&&(y&&N.stopPropagation(),A&&N.preventDefault(),l.call(c,N));return c.addEventListener(f,k,m),()=>c.removeEventListener(f,k,m)}},Ct={prevent(t){t.prevent=!0},stop(t){t.stop=!0},once(t){t.once=!0},passive(t){t.passive=!0},capture(t){t.capture=!0},window(t){t.target=window},document(t){t.target=document},toggle(t){t.defer=(e,r)=>i=>r?(r.call?.(t.target,i),r=null):r=e()},throttle(t,e){t.defer=r=>Tt(r,e?Number(e)||0:108)},debounce(t,e){t.defer=r=>Et(r,e?Number(e)||0:108)},outside:t=>e=>{let r=t.target;return!(r.contains(e.target)||e.target.isConnected===!1||r.offsetWidth<1&&r.offsetHeight<1)},self:t=>e=>e.target===t.target,ctrl:(t,...e)=>r=>h.ctrl(r)&&e.every(i=>h[i]?h[i](r):r.key===i),shift:(t,...e)=>r=>h.shift(r)&&e.every(i=>h[i]?h[i](r):r.key===i),alt:(t,...e)=>r=>h.alt(r)&&e.every(i=>h[i]?h[i](r):r.key===i),meta:(t,...e)=>r=>h.meta(r)&&e.every(i=>h[i]?h[i](r):r.key===i),arrow:t=>h.arrow,enter:t=>h.enter,escape:t=>h.escape,tab:t=>h.tab,space:t=>h.space,backspace:t=>h.backspace,delete:t=>h.delete,digit:t=>h.digit,letter:t=>h.letter,character:t=>h.character},h={ctrl:t=>t.ctrlKey||t.key==="Control"||t.key==="Ctrl",shift:t=>t.shiftKey||t.key==="Shift",alt:t=>t.altKey||t.key==="Alt",meta:t=>t.metaKey||t.key==="Meta"||t.key==="Command",arrow:t=>t.key.startsWith("Arrow"),enter:t=>t.key==="Enter",escape:t=>t.key.startsWith("Esc"),tab:t=>t.key==="Tab",space:t=>t.key==="\xA0"||t.key==="Space"||t.key===" ",backspace:t=>t.key==="Backspace",delete:t=>t.key==="Delete",digit:t=>/^\d$/.test(t.key),letter:t=>/^[a-zA-Z]$/.test(t.key),character:t=>/^\S$/.test(t.key)},Tt=(t,e)=>{let r,i,n=o=>{r=!0,setTimeout(()=>{if(r=!1,i)return i=!1,n(o),t(o)},e)};return o=>r?i=!0:(n(o),t(o))},Et=(t,e)=>{let r;return i=>{clearTimeout(r),r=setTimeout(()=>{r=null,t(i)},e)}},K=(t,e,r)=>{r==null||r===!1?t.removeAttribute(e):t.setAttribute(e,r===!0?"":typeof r=="number"||typeof r=="string"?r:"")},ct={};function v(t,e,r){let i=ct[e];if(!i){let n=/^[\n\s]*if.*\(.*\)/.test(e)||/\b(let|const)\s/.test(e)?`(() => { ${e} })()`:e;try{i=ct[e]=new Function("__scope",`with (__scope) { return ${n} };`)}catch(o){return F(o,t,e,r)}}return n=>{let o;try{o=i.call(t,n)}catch(s){return F(s,t,e,r)}return o}}function F(t,e,r,i){Object.assign(t,{element:e,expression:r}),console.warn(`\u2234 ${t.message}

${i}=${r?`"${r}"

`:""}`,e),setTimeout(()=>{throw t},0)}function pt(t){return t.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,e=>"-"+e.toLowerCase())}function jt(t){return typeof t=="string"||typeof t=="boolean"||typeof t=="number"}var P=new WeakMap;function j(t,e){if(!t.children)return;if(P.has(t)){let o=P.get(t);return J(()=>Object.assign(o,e)),o}let r=g(e||{}),i=[],n=(o,s=o.parentNode)=>{for(let l in W){let f=":"+l;if(o.hasAttribute?.(f)){let c=o.getAttribute(f);if(o.removeAttribute(f),i.push(W[l](o,c,r,l)),P.has(o)||o.parentNode!==s)return!1}}if(o.attributes)for(let l=0;l<o.attributes.length;){let f=o.attributes[l];if(f.name[0]!==":"){l++;continue}o.removeAttribute(f.name);let c=f.value,d=f.name.slice(1).split(":");for(let u of d){let y=w[u]||dt;if(i.push(y(o,c,r,u)),P.has(o)||o.parentNode!==s)return!1}}for(let l=0,f;f=o.children[l];l++)n(f,o)===!1&&l--};n(t);for(let o of i)if(o){let s;Z(()=>{typeof s=="function"&&s(),s=o(r)})}return Object.seal(r),P.set(t,r),r}var yt=j;history.scrollRestoration="manual";var q=document.querySelector(".wavearea"),O=q.querySelector(".w-editable"),Mt=q.querySelector(".w-play"),bt=q.querySelector(".w-caret-line"),S=new Audio,C=new Audio;C.loop=!0;var vt=new Worker("./dist/worker.js",{type:"module"}),a=yt(q,{isMouseDown:!1,isKeyDown:0,loading:"Initializing...",recording:!1,playing:!1,selecting:!1,playbackStart:0,loop:!1,playbackEnd:null,volume:1,segments:[],total:0,duration:0,caretOffscreen:0,caretOffset:0,caretLine:0,lineWidth:216,charWidth:0,measureCharWidth(t){let e=t.getClientRects()[0];if(!e||!a.loading)return;let i=e.width/t.textContent.length;a.charWidth?a.charWidth=(a.charWidth+i)/2:a.charWidth=i},async handleCaret(t){let e=_();e&&(a.caretOffset=e.start,a.caretLine=Math.floor(a.caretOffset/a.lineWidth),a.playing||(a.playbackStart=e.start,a.playbackEnd=e.collapsed?a.total:e.end,a.loop=!e.collapsed,a.loop&&mt.createLoop()),a.loop?C.currentTime=a.playing?C.duration*(Math.max(a.playbackStart,Math.min(e.start,a.playbackEnd))-a.playbackStart)/(a.playbackEnd-a.playbackStart):0:S.currentTime=S.duration*e.start/a.total)},updateTimecodes(){let t=0,e=0;for(let r of O.children){let i=r.textContent.trim(),n=Math.ceil(i.length/a.lineWidth);r.dataset.id=e++,r.dataset.offset=t,r.setAttribute("timecodes",Array.from({length:n},(o,s)=>Wt(s*a.lineWidth+t)).join(`
`)),t+=i.length}},async handleBeforeInput(t){let e=mt[t.inputType];e?e.call(this,t):t.preventDefault()},async handleDrop(t){let r=t.dataTransfer.files[0];if(!r.type.startsWith("audio"))return!1;a.loading=!0,a.segments=[];let i=await fileToArrayBuffer(r),n=await decodeAudio(i),o=await encodeAudio(n),s=new Blob([o],{type:"audio/wav"}),l=URL.createObjectURL(s);return await applyOp(["src",l]),a.loading=!1,i},timeChange(t){document.activeElement!==O&&(_(a.playbackStart=Math.floor(a.total*S.currentTime/a.duration)),O.focus())},scrollIntoCaret(){a.caretOffscreen&&bt.scrollIntoView({behavior:"smooth",block:"center"})},play(t){a.playing=!0,a.scrollIntoCaret();let e=a.playbackStart,r=a.playbackEnd,i=a.loop?C:S,n=()=>Mt.click(),o,s=()=>{let f=a.loop?a.playbackStart+Math.ceil((a.playbackEnd-a.playbackStart)*C.currentTime/C.duration):Math.max(Math.ceil(a.total*S.currentTime/S.duration),0);_(a.caretOffset=f);let c=Math.floor(a.caretOffset/a.lineWidth);c!==a.caretLine&&(a.caretLine=c,a.scrollIntoCaret()),o=requestAnimationFrame(s)};return s(),O.focus(),i.play(),i.addEventListener("ended",n,{once:!0}),()=>{i.removeEventListener("ended",n),i.pause(),a.playing=!1,cancelAnimationFrame(o),o=null,a.loop?_(e,r):S.currentTime>=a.duration&&_(a.total),O.focus()}},async goto(t){try{await G(t)}catch{await gt()}_(a.caretOffset)}}),mt={async deleteContentBackward(t){let e=t.getTargetRanges()[0],r=e.startOffset+Number(e.startContainer.parentNode.closest(".w-segment").dataset.offset),i=e.endOffset+Number(e.endContainer.parentNode.closest(".w-segment").dataset.offset);this._deleteTimeout?(clearTimeout(this._deleteTimeout),this._deleteOp[1]--):this._deleteOp=["del",r,i];let n=()=>{if(a.isKeyDown)return this._deleteTimeout=setTimeout(n,50);Rt(this._deleteOp),this._deleteOp=this._deleteTimeout=null};this._deleteTimeout=setTimeout(n,280)},createLoop(t){this._loopTimeout&&clearTimeout(this._loopTimeout);let e=async()=>{if(a.isMouseDown||a.isKeyDown)return this._loopTimeout=setTimeout(e,50);this._loopTimeout=null;let{url:r}=await X(["loop",a.playbackStart,a.playbackEnd]);C.src&&URL.revokeObjectURL(C.src),C.src=r};this._loopTimeout=setTimeout(e,280)}},_=(t,e,r=0)=>{let i=window.getSelection();if(t!=null){t=Math.max(0,t),e==null&&(e=t);let c,d;i.removeAllRanges();let u=new Range,y=t;for(c=O.firstChild;y+r>c.firstChild.data.length;)y-=c.firstChild.data.length,c=c.nextSibling;u.setStart(c.firstChild,y);let A=e;for(d=O.firstChild;A+r>d.firstChild.data.length;)A-=d.firstChild.data.length,d=d.nextSibling;return u.setEnd(d.firstChild,A),i.addRange(u),{start:t,startNode:c,end:e,endNode:d,startNodeOffset:y,endNodeOffset:A,collapsed:i.isCollapsed}}if(!i.anchorNode||!O.contains(i.anchorNode))return;t=i.anchorOffset,e=i.focusOffset;let n=i.anchorNode.parentNode.closest(".w-segment");for(;n=n.previousSibling;)t+=n.firstChild.data.length;for(n=i.focusNode.parentNode.closest(".w-segment");n=n.previousSibling;)e+=n.firstChild.data.length;let o=i.anchorNode.parentNode.closest(".w-segment"),s=i.anchorOffset,l=i.focusNode.parentNode.closest(".w-segment"),f=i.focusOffset;return t>e&&([e,l,f,t,o,s]=[t,o,s,e,l,f]),{start:t,startNode:o,startNodeOffset:s,end:e,endNode:l,endNodeOffset:f,collapsed:i.isCollapsed}},Wt=t=>{let e=t/a.total*a.duration;return`${Math.floor(e/60).toFixed(0)}:${(Math.floor(e)%60).toFixed(0).padStart(2,0)}`},_t=new IntersectionObserver(([t])=>{a.caretOffscreen=t.isIntersecting?0:t.intersectionRect.top<=t.rootBounds.top?1:t.intersectionRect.bottom>=t.rootBounds.bottom?-1:0},{root:document,threshold:1,rootMargin:"0px"});_t.observe(bt);var Lt=new ResizeObserver(t=>{let e=t[0].contentRect.width;a.lineWidth=Math.floor(e/a.charWidth)});Lt.observe(O);if(location.search.length<2){let t=["https://upload.wikimedia.org/wikipedia/commons/c/cf/Caja_de_m%C3%BAsica_%28PianoConcerto5_Beethoven%29.ogg"],e=t[Math.floor(Math.random()*t.length)];location.search=`?src=${e}`}gt();async function Rt(...t){let e=new URL(location);for(let i of t){let[n,...o]=i;e.searchParams.has(n)?e.searchParams.set(n,`${e.searchParams.get(n)}..${o.join("-")}`):e.searchParams.append(n,o.join("-"))}a.loading="Calculating audio...";let r=await X(...t);return history.pushState(r,"",decodeURI(e)),a.loading=!1,O.textContent&&console.assert(r.segments.join("")===O.textContent,"Rendered waveform is different from UI"),G(r)}function X(...t){return new Promise(e=>{vt.postMessage({id:history.state?.id||0,ops:t}),vt.addEventListener("message",r=>{e(r.data)},{once:!0})})}function G({url:t,segments:e,duration:r}){a.total=e.reduce((n,o)=>n+=o.length,0),a.duration=r,a.segments=e;let i=S.currentTime;return S.src=t,new Promise((n,o)=>{S.addEventListener("error",o),S.addEventListener("canplay",s=>n(S.currentTime=i),{once:!0})})}async function gt(t=new URL(location)){a.loading="Reconstructing audio...";let e=[];for(let[i,n]of t.searchParams)e.push(...n.split("..").map(o=>[i,...o.includes(":")?[o]:o.split("-")]));let r=await X(...e);history.replaceState(r,"",decodeURI(t)),G(r),a.loading=!1}
//# sourceMappingURL=wavearea.js.map
