var dt=Object.create;var Se=Object.defineProperty;var pt=Object.getOwnPropertyDescriptor;var mt=Object.getOwnPropertyNames;var yt=Object.getPrototypeOf,vt=Object.prototype.hasOwnProperty;var U=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var gt=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of mt(t))!vt.call(e,o)&&o!==r&&Se(e,o,{get:()=>t[o],enumerable:!(n=pt(t,o))||n.enumerable});return e};var wt=(e,t,r)=>(r=e!=null?dt(yt(e)):{},gt(t||!e||!e.__esModule?Se(r,"default",{value:e,enumerable:!0}):r,e));var qe=U((cr,$e)=>{"use strict";$e.exports=function(e){return!e||e.length<3?!1:e[0]===73&&e[1]===68&&e[2]===51||e[0]===255&&(e[1]===251||e[1]===250)}});var Ve=U((ur,Ke)=>{"use strict";Ke.exports=function(e){return!e||e.length<12?!1:e[0]===82&&e[1]===73&&e[2]===70&&e[3]===70&&e[8]===87&&e[9]===65&&e[10]===86&&e[11]===69}});var Ze=U((fr,ze)=>{"use strict";ze.exports=function(e){return!e||e.length<4?!1:e[0]===79&&e[1]===103&&e[2]===103&&e[3]===83}});var Ye=U((hr,He)=>{"use strict";He.exports=function(e){return!e||e.length<4?!1:e[0]===102&&e[1]===76&&e[2]===97&&e[3]===67}});var Xe=U((dr,Ge)=>{"use strict";Ge.exports=function(e){return!e||e.length<8?!1:e[4]===102&&e[5]===116&&e[6]===121&&e[7]===112||e[0]===77&&e[1]===52&&e[2]===65&&e[3]===32}});var Qe=U((pr,Je)=>{"use strict";Je.exports=function(e){return e?qe()(e)?"mp3":Ve()(e)?"wav":Ze()(e)?"oga":Ye()(e)?"flac":Xe()(e)?"m4a":!1:!1}});function J(){throw new Error("Cycle detected")}function Q(){if(N>1)N--;else{for(var e,t=!1;Z!==void 0;){var r=Z;for(Z=void 0,ue++;r!==void 0;){var n=r.o;if(r.o=void 0,r.f&=-3,!(8&r.f)&&ke(r))try{r.c()}catch(o){t||(e=o,t=!0)}r=n}}if(ue=0,N--,t)throw e}}function Ae(e){if(N>0)return e();N++;try{return e()}finally{Q()}}var v=void 0,Z=void 0,N=0,ue=0,X=0;function Oe(e){if(v!==void 0){var t=e.n;if(t===void 0||t.t!==v)return t={i:0,S:e,p:v.s,n:void 0,t:v,e:void 0,x:void 0,r:t},v.s!==void 0&&(v.s.n=t),v.s=t,e.n=t,32&v.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=v.s,t.n=void 0,v.s.n=t,v.s=t),t}}function S(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}S.prototype.h=function(){return!0};S.prototype.S=function(e){this.t!==e&&e.e===void 0&&(e.x=this.t,this.t!==void 0&&(this.t.e=e),this.t=e)};S.prototype.U=function(e){if(this.t!==void 0){var t=e.e,r=e.x;t!==void 0&&(t.x=r,e.e=void 0),r!==void 0&&(r.e=t,e.x=void 0),e===this.t&&(this.t=r)}};S.prototype.subscribe=function(e){var t=this;return he(function(){var r=t.value,n=32&this.f;this.f&=-33;try{e(r)}finally{this.f|=n}})};S.prototype.valueOf=function(){return this.value};S.prototype.toString=function(){return this.value+""};S.prototype.peek=function(){return this.v};Object.defineProperty(S.prototype,"value",{get:function(){var e=Oe(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){ue>100&&J(),this.v=e,this.i++,X++,N++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{Q()}}}});function xe(e){return new S(e)}function ke(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function Te(e){for(var t=e.s;t!==void 0;t=t.n){var r=t.S.n;if(r!==void 0&&(t.r=r),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function Re(e){for(var t=e.s,r=void 0;t!==void 0;){var n=t.p;t.i===-1?(t.S.U(t),n!==void 0&&(n.n=t.n),t.n!==void 0&&(t.n.p=n)):r=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=n}e.s=r}function j(e){S.call(this,void 0),this.x=e,this.s=void 0,this.g=X-1,this.f=4}(j.prototype=new S).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===X))return!0;if(this.g=X,this.f|=1,this.i>0&&!ke(this))return this.f&=-2,!0;var e=v;try{Te(this),v=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(r){this.v=r,this.f|=16,this.i++}return v=e,Re(this),this.f&=-2,!0};j.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}S.prototype.S.call(this,e)};j.prototype.U=function(e){if(this.t!==void 0&&(S.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};j.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};j.prototype.peek=function(){if(this.h()||J(),16&this.f)throw this.v;return this.v};Object.defineProperty(j.prototype,"value",{get:function(){1&this.f&&J();var e=Oe(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function Ee(e){return new j(e)}function De(e){var t=e.u;if(e.u=void 0,typeof t=="function"){N++;var r=v;v=void 0;try{t()}catch(n){throw e.f&=-2,e.f|=8,fe(e),n}finally{v=r,Q()}}}function fe(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,De(e)}function bt(e){if(v!==this)throw new Error("Out-of-order effect");Re(this),v=e,this.f&=-2,8&this.f&&fe(this),Q()}function H(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}H.prototype.c=function(){var e=this.S();try{!(8&this.f)&&this.x!==void 0&&(this.u=this.x())}finally{e()}};H.prototype.S=function(){1&this.f&&J(),this.f|=1,this.f&=-9,De(this),Te(this),N++;var e=v;return v=this,bt.bind(this,e)};H.prototype.N=function(){2&this.f||(this.f|=2,this.o=Z,Z=this)};H.prototype.d=function(){this.f|=8,1&this.f||fe(this)};function he(e){var t=new H(e);try{t.c()}catch(r){throw t.d(),r}return t.d.bind(t)}Symbol.observable||=Symbol("observable");var Ne=e=>e&&!!(e[Symbol.observable]||e[Symbol.asyncIterator]||e.call&&e.set||e.subscribe||e.then),Ct=new FinalizationRegistry(e=>e.call?.()),St=e=>e&&(()=>e.unsubscribe?.()),Pe=(e,t,r,n,o,i)=>e&&(i=St((e[Symbol.observable]?.()||e).subscribe?.(t,r,n))||e.set&&e.call?.(o,t)||(e.then?.(a=>(!o&&t(a),n?.()),r)||(async a=>{try{for await(a of e){if(o)return;t(a)}n?.()}catch(s){r?.(s)}})())&&(a=>o=1),Ct.register(e,i),i);var At=e=>e&&e.peek,de=e=>e&&e[_e],_e=Symbol("signal-struct");O.isStruct=de;function O(e,t){if(de(e)&&!t)return e;if(ee(e)){let r=Object.create(t||Object.getPrototypeOf(e)),n={},o=Object.getOwnPropertyDescriptors(e);for(let i in o){let a=o[i];if(a.get){let s=n[i]=Ee(a.get.bind(r));Object.defineProperty(r,i,{get(){return s.value},set:a.set?.bind(r),configurable:!1,enumerable:!0})}else{let s=a.value,c=Ne(s),f=n[i]=At(s)?s:xe(c?void 0:ee(s)?Object.seal(O(s)):Array.isArray(s)?O(s):s);c&&Pe(s,h=>f.value=h),Object.defineProperty(r,i,{get(){return f.value},set(h){if(ee(h)){if(ee(f.value))try{Object.assign(f.value,h);return}catch{}f.value=Object.seal(O(h))}else Array.isArray(h)?f.value=O(h):f.value=h},enumerable:!0,configurable:!1})}}return Object.defineProperty(r,_e,{configurable:!1,enumerable:!1,value:!0}),r}if(Array.isArray(e)&&!de(e[0]))for(let r=0;r<e.length;r++)e[r]=O(e[r]);return e}function ee(e){return e&&e.constructor===Object}function Be(e,t,r,n){let o=new Map,i=new Map,a,s;for(a=0;a<t.length;a++)o.set(t[a],a);for(a=0;a<r.length;a++)i.set(r[a],a);for(a=s=0;a!==t.length||s!==r.length;){var c=t[a],f=r[s];if(c===null)a++;else if(r.length<=s)e.removeChild(t[a]),a++;else if(t.length<=a)e.insertBefore(f,t[a]||n),s++;else if(c===f)a++,s++;else{var h=i.get(c),u=o.get(f);h===void 0?(e.removeChild(t[a]),a++):u===void 0?(e.insertBefore(f,t[a]||n),s++):(e.insertBefore(t[u],t[a]||n),t[u]=null,u>a+1&&a++,s++)}}return r}var I={},Ot={},xt={},je=e=>e===null?Ot:e===void 0?xt:typeof e=="number"||e instanceof Number?I[e]||(I[e]=new Number(e)):typeof e=="string"||e instanceof String?I[e]||(I[e]=new String(e)):typeof e=="boolean"||e instanceof Boolean?I[e]||(I[e]=new Boolean(e)):e;var F={},x={};F.if=(e,t)=>{let r=document.createTextNode(""),n=[b(e,t,":if")],o=[e],i=e;for(;(i=e.nextElementSibling)&&i.hasAttribute(":else");)i.removeAttribute(":else"),(t=i.getAttribute(":if"))?(i.removeAttribute(":if"),i.remove(),o.push(i),n.push(b(e,t,":else :if"))):(i.remove(),o.push(i),n.push(()=>1));return e.replaceWith(i=r),a=>{let s=n.findIndex(c=>c(a));o[s]!=i&&((i[Me]||i).replaceWith(i=o[s]||r),L(i,a))}};F.with=(e,t,r)=>{let n=b(e,t,"with");L(e,O(n(r),r))};var Me=Symbol(":each");F.each=(e,t)=>{let r=kt(t);if(!r)return te(new Error,e,t);let n=e[Me]=document.createTextNode("");e.replaceWith(n);let o=b(e,r[2],":each"),i=e.getAttribute(":key"),a=i?b(null,i):null;e.removeAttribute(":key");let s=new WeakMap,c=new WeakMap,f=[];return h=>{let u=o(h);u?typeof u=="number"?u=Array.from({length:u},(m,g)=>[g,g+1]):Array.isArray(u)?u=u.map((m,g)=>[g+1,m]):typeof u=="object"?u=Object.entries(u):te(Error("Bad list value"),e,t,":each",u):u=[];let d=[],p=[];for(let[m,g]of u){let C,E,w=a?.({[r[0]]:g,[r[1]]:m});Dt(w)&&(w=je(w)),w==null?C=e.cloneNode(!0):(C=c.get(w))||c.set(w,C=e.cloneNode(!0)),d.push(C),w==null||!(E=s.get(w))?(E=O({[r[0]]:g,[r[1]]:m},h),w!=null&&s.set(w,E)):E[r[0]]=g,p.push(E)}Be(n.parentNode,f,d,n),f=d;for(let m=0;m<d.length;m++)L(d[m],p[m])}};function kt(e){let t=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,r=/^\s*\(|\)\s*$/g,n=/([\s\S]*?)\s+(?:in|of)\s+([\s\S]*)/,o=e.match(n);if(!o)return;let i=o[2].trim(),a=o[1].replace(r,"").trim(),s=a.match(t);return s?[a.replace(t,"").trim(),s[1].trim(),i]:[a,"",i]}x.ref=(e,t,r)=>{r[t]=e};x.id=(e,t)=>{let r=b(e,t,":id"),n=o=>e.id=o||o===0?o:"";return o=>n(r(o))};x.class=(e,t)=>{let r=b(e,t,":class"),n=e.className;return o=>{let i=r(o),a=typeof i=="string"?i:(Array.isArray(i)?i:Object.entries(i).map(([s,c])=>c?s:"")).filter(Boolean).join(" ");e.className=[n,a].filter(Boolean).join(" ")}};x.style=(e,t)=>{let r=b(e,t,":style"),n=e.getAttribute("style")||"";return n.endsWith(";")||(n+="; "),o=>{let i=r(o);if(typeof i=="string")e.setAttribute("style",n+i);else{e.setAttribute("style",n);for(let a in i)e.style.setProperty(a,i[a])}}};x.text=(e,t)=>{let r=b(e,t,":text");return n=>{let o=r(n);e.textContent=o??""}};x.data=(e,t)=>{let r=b(e,t,":data");return n=>{let o=r(n);for(let i in o)e.dataset[i]=o[i]}};x.aria=(e,t)=>{let r=b(e,t,":aria"),n=o=>{for(let i in o)re(e,"aria-"+Ie(i),o[i]==null?null:o[i]+"")};return o=>n(r(o))};x[""]=(e,t)=>{let r=b(e,t,":");if(r)return n=>{let o=r(n);for(let i in o)re(e,Ie(i),o[i])}};x.value=(e,t)=>{let r=b(e,t,":value"),n,o,i=e.type==="text"||e.type===""?a=>e.setAttribute("value",e.value=a??""):e.tagName==="TEXTAREA"||e.type==="text"||e.type===""?a=>(n=e.selectionStart,o=e.selectionEnd,e.setAttribute("value",e.value=a??""),n&&e.setSelectionRange(n,o)):e.type==="checkbox"?a=>(e.value=a?"on":"",re(e,"checked",a)):e.type==="select-one"?a=>{for(let s in e.options)s.removeAttribute("selected");e.value=a,e.selectedOptions[0]?.setAttribute("selected","")}:a=>e.value=a;return a=>i(r(a))};x.on=(e,t)=>{let r=b(e,t,":on");return n=>{let o=r(n),i=[];for(let a in o)i.push(Ue(e,a,o[a]));return()=>{for(let a of i)a()}}};var We=(e,t,r,n)=>{let o=n.startsWith("on")&&n.slice(2),i=b(e,t,":"+n);if(i)return o?a=>{let s=i(a)||(()=>{});return Ue(e,o,s)}:a=>re(e,n,i(a))},Ue=(e,t,r)=>{if(!r)return;let n=t.split("..").map(s=>{let c={evt:"",target:e,test:()=>!0};return c.evt=(s.startsWith("on")?s.slice(2):s).replace(/\.(\w+)?-?([-\w]+)?/g,(f,h,u="")=>(c.test=Tt[h]?.(c,...u.split("-"))||c.test,"")),c});if(n.length==1)return a(r,n[0]);let o=(s,c=0)=>{let f;return f=a(u=>{c&&f();let d=s.call(e,u);typeof d!="function"&&(d=()=>{}),c+1<n.length&&o(d,c?c+1:1)},n[c])},i=o(r);return()=>i();function a(s,{evt:c,target:f,test:h,defer:u,stop:d,prevent:p,...m}){u&&(s=u(s));let g=C=>h(C)&&(d&&C.stopPropagation(),p&&C.preventDefault(),s.call(f,C));return f.addEventListener(c,g,m),()=>f.removeEventListener(c,g,m)}},Tt={prevent(e){e.prevent=!0},stop(e){e.stop=!0},once(e){e.once=!0},passive(e){e.passive=!0},capture(e){e.capture=!0},window(e){e.target=window},document(e){e.target=document},toggle(e){e.defer=(t,r)=>n=>r?(r.call?.(e.target,n),r=null):r=t()},throttle(e,t){e.defer=r=>Rt(r,t?Number(t)||0:108)},debounce(e,t){e.defer=r=>Et(r,t?Number(t)||0:108)},outside:e=>t=>{let r=e.target;return!(r.contains(t.target)||t.target.isConnected===!1||r.offsetWidth<1&&r.offsetHeight<1)},self:e=>t=>t.target===e.target,ctrl:(e,...t)=>r=>y.ctrl(r)&&t.every(n=>y[n]?y[n](r):r.key===n),shift:(e,...t)=>r=>y.shift(r)&&t.every(n=>y[n]?y[n](r):r.key===n),alt:(e,...t)=>r=>y.alt(r)&&t.every(n=>y[n]?y[n](r):r.key===n),meta:(e,...t)=>r=>y.meta(r)&&t.every(n=>y[n]?y[n](r):r.key===n),arrow:e=>y.arrow,enter:e=>y.enter,escape:e=>y.escape,tab:e=>y.tab,space:e=>y.space,backspace:e=>y.backspace,delete:e=>y.delete,digit:e=>y.digit,letter:e=>y.letter,character:e=>y.character},y={ctrl:e=>e.ctrlKey||e.key==="Control"||e.key==="Ctrl",shift:e=>e.shiftKey||e.key==="Shift",alt:e=>e.altKey||e.key==="Alt",meta:e=>e.metaKey||e.key==="Meta"||e.key==="Command",arrow:e=>e.key.startsWith("Arrow"),enter:e=>e.key==="Enter",escape:e=>e.key.startsWith("Esc"),tab:e=>e.key==="Tab",space:e=>e.key==="\xA0"||e.key==="Space"||e.key===" ",backspace:e=>e.key==="Backspace",delete:e=>e.key==="Delete",digit:e=>/^\d$/.test(e.key),letter:e=>/^[a-zA-Z]$/.test(e.key),character:e=>/^\S$/.test(e.key)},Rt=(e,t)=>{let r,n,o=i=>{r=!0,setTimeout(()=>{if(r=!1,n)return n=!1,o(i),e(i)},t)};return i=>r?n=!0:(o(i),e(i))},Et=(e,t)=>{let r;return n=>{clearTimeout(r),r=setTimeout(()=>{r=null,e(n)},t)}},re=(e,t,r)=>{r==null||r===!1?e.removeAttribute(t):e.setAttribute(t,r===!0?"":typeof r=="number"||typeof r=="string"?r:"")},Le={};function b(e,t,r){let n=Le[t];if(!n){let o=/^[\n\s]*if.*\(.*\)/.test(t)||/\b(let|const)\s/.test(t)?`(() => { ${t} })()`:t;try{n=Le[t]=new Function("__scope",`with (__scope) { return ${o} };`)}catch(i){return te(i,e,t,r)}}return o=>{let i;try{i=n.call(e,o)}catch(a){return te(a,e,t,r)}return i}}function te(e,t,r,n){Object.assign(e,{element:t,expression:r}),console.warn(`\u2234 ${e.message}

${n}=${r?`"${r}"

`:""}`,t),setTimeout(()=>{throw e},0)}function Ie(e){return e.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,t=>"-"+t.toLowerCase())}function Dt(e){return typeof e=="string"||typeof e=="boolean"||typeof e=="number"}var Y=new WeakMap;function L(e,t){if(!e.children)return;if(Y.has(e)){let i=Y.get(e);return Ae(()=>Object.assign(i,t)),i}let r=O(t||{}),n=[],o=(i,a=i.parentNode)=>{for(let s in F){let c=":"+s;if(i.hasAttribute?.(c)){let f=i.getAttribute(c);if(i.removeAttribute(c),n.push(F[s](i,f,r,s)),Y.has(i)||i.parentNode!==a)return!1}}if(i.attributes)for(let s=0;s<i.attributes.length;){let c=i.attributes[s];if(c.name[0]!==":"){s++;continue}i.removeAttribute(c.name);let f=c.value,h=c.name.slice(1).split(":");for(let u of h){let d=x[u]||We;if(n.push(d(i,f,r,u)),Y.has(i)||i.parentNode!==a)return!1}}for(let s=0,c;c=i.children[s];s++)o(c,i)===!1&&s--};o(e);for(let i of n)if(i){let a;he(()=>{typeof a=="function"&&a(),a=i(r)})}return Object.seal(r),Y.set(e,r),r}var Fe=L;var Pt=wt(Qe());var nt=function(){function e(){}return e.prototype.then=function(t,r){let n=new e,o=this.s;if(o){let i=1&o?t:r;if(i){try{A(n,1,i(this.v))}catch(a){A(n,2,a)}return n}return this}return this.o=function(i){try{let a=i.v;1&i.s?A(n,1,t?t(a):a):r?A(n,1,r(a)):A(n,2,a)}catch(a){A(n,2,a)}},n},e}();function A(e,t,r){if(!e.s){if(r instanceof nt){if(!r.s)return void(r.o=A.bind(null,e,t));1&t&&(t=r.s),r=r.v}if(r&&r.then)return void r.then(A.bind(null,e,t),A.bind(null,e,2));e.s=t,e.v=r;let n=e.o;n&&n(e)}}var _t=0,q=typeof WeakMap=="function"?WeakMap:function(){var e=typeof Symbol=="function"?Symbol(0):"__weak$"+ ++_t;this.set=function(t,r){t[e]=r},this.get=function(t){return t[e]}};function ve(e,t){return new Promise(function(r,n){e.onsuccess=function(){var o=e.result;t&&(o=t(o)),r(o)},e.onerror=function(){n(e.error)}})}function it(e,t){return ve(e.openCursor(t),function(r){return r?[r.key,r.value]:[]})}function et(e){return new Promise(function(t,r){e.oncomplete=function(){t()},e.onabort=function(){r(e.error)},e.onerror=function(){r(e.error)}})}function pe(e){if(!function(t){return!!(typeof t=="number"||typeof t=="string"||typeof t=="object"&&t&&(Array.isArray(t)||"setUTCFullYear"in t||typeof ArrayBuffer=="function"&&ArrayBuffer.isView(t)||"byteLength"in t&&"length"in t))}(e))throw Error("kv-storage: The given value is not allowed as a key")}var ot={};function tt(e,t){return it(e,at(t))}function at(e){return e===ot?IDBKeyRange.lowerBound(-1/0):IDBKeyRange.lowerBound(e,!0)}var st=new q,ie=new q,oe=new q,lt=new q,ne=function(){};function rt(e,t){return t(function(r,n){try{let f=function(){return ie.set(e,i),oe.set(e,void 0),{value:s,done:i===void 0}};var o=ie.get(e);if(o===void 0)return Promise.resolve({value:void 0,done:!0});var i,a,s,c=function(h,u){var d,p=-1;e:{for(var m=0;m<u.length;m++){var g=u[m][0];if(g){var C=g();if(C&&C.then)break e;if(C===h){p=m;break}}else p=m}if(p!==-1){do{for(var E=u[p][1];!E;)E=u[++p][1];var w=E();if(w&&w.then){d=!0;break e}var be=u[p][2];p++}while(be&&!be());return w}}let V=new nt,G=A.bind(null,V,2);return(d?w.then(ce):C.then(function W(_){for(;;){if(_===h){p=m;break}if(++m===u.length){if(p!==-1)break;return void A(V,1,z)}if(g=u[m][0]){if((_=g())&&_.then)return void _.then(W).then(void 0,G)}else p=m}do{for(var B=u[p][1];!B;)B=u[++p][1];var z=B();if(z&&z.then)return void z.then(ce).then(void 0,G);var Ce=u[p][2];p++}while(Ce&&!Ce());A(V,1,z)})).then(void 0,G),V;function ce(W){for(;;){var _=u[p][2];if(!_||_())break;for(var B=u[++p][1];!B;)B=u[++p][1];if((W=B())&&W.then)return void W.then(ce).then(void 0,G)}A(V,1,W)}}(lt.get(e),[[function(){return"keys"},function(){return Promise.resolve(function(h,u){return it(h,at(u)).then(function(d){return d[0]})}(n,o)).then(function(h){s=i=h})}],[function(){return"values"},function(){return Promise.resolve(tt(n,o)).then(function(h){var u;i=(u=h)[0],s=a=u[1]})}],[function(){return"entries"},function(){return Promise.resolve(tt(n,o)).then(function(h){var u;a=(u=h)[1],s=(i=u[0])===void 0?void 0:[i,a]})}]]);return Promise.resolve(c&&c.then?c.then(f):f())}catch(f){return Promise.reject(f)}})}function me(e,t){var r=new ne;return lt.set(r,e),st.set(r,t),ie.set(r,ot),oe.set(r,void 0),r}ne.prototype.return=function(){ie.set(this,void 0)},ne.prototype.next=function(){var e=this,t=st.get(this);if(!t)return Promise.reject(new TypeError("Invalid this value"));var r,n=oe.get(this);return r=n!==void 0?n.then(function(){return rt(e,t)}):rt(this,t),oe.set(this,r),r},typeof Symbol=="function"&&Symbol.asyncIterator&&(ne.prototype[Symbol.asyncIterator]=function(){return this});var $=function(e,t,r){try{return P.get(e)===null&&function(n){var o=ge.get(n);P.set(n,new Promise(function(i,a){var s=self.indexedDB.open(o,1);s.onsuccess=function(){var c=s.result;(function(f,h,u){if(f.objectStoreNames.length!==1||f.objectStoreNames[0]!==M)return u(ye(h)),!1;var d=f.transaction(M,"readonly").objectStore(M);return!(d.autoIncrement||d.keyPath||d.indexNames.length)||(u(ye(h)),!1)})(c,o,a)&&(c.onclose=function(){P.set(n,null)},c.onversionchange=function(){c.close(),P.set(n,null)},i(c))},s.onerror=function(){return a(s.error)},s.onupgradeneeded=function(){try{s.result.createObjectStore(M)}catch(c){a(c)}}}))}(e),Promise.resolve(P.get(e)).then(function(n){var o=n.transaction(M,t),i=o.objectStore(M);return r(o,i)})}catch(n){return Promise.reject(n)}},ge=new q,P=new q,M="store",R=function(e){var t="kv-storage:"+e;P.set(this,null),ge.set(this,t),this.backingStore={database:t,store:M,version:1}};function ye(e){return new Error('kv-storage: database "'+e+'" corrupted')}R.prototype.set=function(e,t){try{return pe(e),$(this,"readwrite",function(r,n){return t===void 0?n.delete(e):n.put(t,e),et(r)})}catch(r){return Promise.reject(r)}},R.prototype.get=function(e){try{return pe(e),$(this,"readonly",function(t,r){return ve(r.get(e))})}catch(t){return Promise.reject(t)}},R.prototype.delete=function(e){try{return pe(e),$(this,"readwrite",function(t,r){return r.delete(e),et(t)})}catch(t){return Promise.reject(t)}},R.prototype.clear=function(){try{let o=function(){function i(){return ve(self.indexedDB.deleteDatabase(ge.get(e)))}var a=function(){if(t){try{t.close()}catch{}return Promise.resolve(new Promise(setTimeout)).then(function(){})}}();return a&&a.then?a.then(i):i()};var e=this,t,r=P.get(e),n=function(){if(r!==null){let a=function(){P.set(e,null)};var i=function(s,c){try{var f=Promise.resolve(r).then(function(h){t=h})}catch{return}return f&&f.then?f.then(void 0,function(){}):f}();return i&&i.then?i.then(a):a()}}();return n&&n.then?n.then(o):o()}catch(o){return Promise.reject(o)}},R.prototype.keys=function(){var e=this;return me("keys",function(t){return $(e,"readonly",t)})},R.prototype.values=function(){var e=this;return me("values",function(t){return $(e,"readonly",t)})},R.prototype.entries=function(){var e=this;return me("entries",function(t){return $(e,"readonly",t)})},typeof Symbol=="function"&&Symbol.asyncIterator&&(R.prototype[Symbol.asyncIterator]=R.prototype.entries);var Bt=new R("default");var we=e=>new Promise((t,r)=>{let n=new FileReader;n.addEventListener("loadend",o=>{t(o.target.result)}),n.addEventListener("error",r),n.readAsArrayBuffer(e)});history.scrollRestoration="manual";var ae=document.querySelector(".wavearea"),T=ae.querySelector(".w-editable"),jt=ae.querySelector(".w-play"),ft=ae.querySelector(".w-caret-line"),k=new Audio,D=new Audio;D.loop=!0;var ct=new Worker("./dist/worker.js",{type:"module"}),Lt=new AudioContext,l=Fe(ae,{isMouseDown:!1,isKeyDown:0,loading:!1,recording:!1,playing:!1,selecting:!1,playbackStart:0,loop:!1,playbackEnd:null,volume:1,segments:[],total:0,duration:0,caretOffscreen:0,caretOffset:0,caretLine:0,lineWidth:216,charWidth:0,measureCharWidth(e){let t=e.getClientRects()[0];if(!t||!l.loading)return;let n=t.width/e.textContent.length;l.charWidth?l.charWidth=(l.charWidth+n)/2:l.charWidth=n},async handleCaret(e){let t=K();t&&(l.caretOffset=t.start,l.caretLine=Math.floor(l.caretOffset/l.lineWidth),l.playing||(l.playbackStart=t.start,l.playbackEnd=t.collapsed?l.total:t.end,l.loop=!t.collapsed,l.loop&&ut.createLoop()),l.loop?D.currentTime=l.playing?D.duration*(Math.max(l.playbackStart,Math.min(t.start,l.playbackEnd))-l.playbackStart)/(l.playbackEnd-l.playbackStart):0:k.currentTime=k.duration*t.start/l.total)},updateTimecodes(){let e=0,t=0;for(let r of T.children){let n=r.textContent.trim(),o=Math.ceil(n.length/l.lineWidth)||0;r.dataset.id=t++,r.dataset.offset=e,r.setAttribute("timecodes",Array.from({length:o||1},(i,a)=>Mt(a*(l.lineWidth||0)+e)).join(`
`)),e+=n.length}},async handleBeforeInput(e){let t=ut[e.inputType];t?t.call(this,e):e.preventDefault()},async handleDrop(e){let r=e.dataTransfer.files[0];if(!r.type.startsWith("audio"))return!1;l.loading=!0,l.segments=[];let n=await we(r),o=await decodeAudio(n),i=await encodeAudio(o),a=new Blob([i],{type:"audio/wav"}),s=URL.createObjectURL(a);return await applyOp(["src",s]),l.loading=!1,n},async handleFile(e){l.loading="Decoding...";let t=e.target.files[0],r=await we(t),n=await Lt.decodeAudioData(r),o=Array.from({length:n.numberOfChannels},i=>n.getChannelData(i));await ht(["file",{file:t,numberOfChannels:n.numberOfChannels,sampleRate:n.sampleRate,length:n.length,channelData:o}]),l.loading=!1},timeChange(e){document.activeElement!==T&&(K(l.playbackStart=Math.floor(l.total*k.currentTime/l.duration)),T.focus())},scrollIntoCaret(){l.caretOffscreen&&ft.scrollIntoView({behavior:"smooth",block:"center"})},play(e){l.playing=!0,l.scrollIntoCaret();let t=l.playbackStart,r=l.playbackEnd,n=l.loop?D:k,o=()=>jt.click(),i,a=()=>{let c=l.loop?l.playbackStart+Math.ceil((l.playbackEnd-l.playbackStart)*D.currentTime/D.duration):Math.max(Math.ceil(l.total*k.currentTime/k.duration),0);K(l.caretOffset=c);let f=Math.floor(l.caretOffset/l.lineWidth);f!==l.caretLine&&(l.caretLine=f,l.scrollIntoCaret()),i=requestAnimationFrame(a)};return a(),T.focus(),n.play(),n.addEventListener("ended",o,{once:!0}),()=>{n.removeEventListener("ended",o),n.pause(),l.playing=!1,cancelAnimationFrame(i),i=null,l.loop?K(t,r):k.currentTime>=l.duration&&K(l.total),T.focus()}},async goto(e){try{await le(e)}catch{await It()}K(l.caretOffset)}}),ut={insertFromDrop(e){console.log("insert from drop",e)},async deleteContentBackward(e){let t=e.getTargetRanges()[0],r=t.startOffset+Number(t.startContainer.parentNode.closest(".w-segment").dataset.offset),n=t.endOffset+Number(t.endContainer.parentNode.closest(".w-segment").dataset.offset);this._deleteTimeout?(clearTimeout(this._deleteTimeout),this._deleteOp[1]--):this._deleteOp=["del",r,n];let o=()=>{if(l.isKeyDown)return this._deleteTimeout=setTimeout(o,50);ht(this._deleteOp),this._deleteOp=this._deleteTimeout=null};this._deleteTimeout=setTimeout(o,280)},createLoop(e){this._loopTimeout&&clearTimeout(this._loopTimeout);let t=async()=>{if(l.isMouseDown||l.isKeyDown)return this._loopTimeout=setTimeout(t,50);this._loopTimeout=null;let{url:r}=await se(["loop",l.playbackStart,l.playbackEnd]);D.src&&URL.revokeObjectURL(D.src),D.src=r};this._loopTimeout=setTimeout(t,280)}},K=(e,t,r=0)=>{let n=window.getSelection();if(e!=null){e=Math.max(0,e),t==null&&(t=e);let f,h;n.removeAllRanges();let u=new Range,d=e;for(f=T.firstChild;d+r>f.firstChild.data.length;)d-=f.firstChild.data.length,f=f.nextSibling;u.setStart(f.firstChild,d);let p=t;for(h=T.firstChild;p+r>h.firstChild.data.length;)p-=h.firstChild.data.length,h=h.nextSibling;return u.setEnd(h.firstChild,p),n.addRange(u),{start:e,startNode:f,end:t,endNode:h,startNodeOffset:d,endNodeOffset:p,collapsed:n.isCollapsed}}if(!n.anchorNode||!T.contains(n.anchorNode))return;e=n.anchorOffset,t=n.focusOffset;let o=n.anchorNode.parentNode.closest(".w-segment");for(;o=o.previousSibling;)e+=o.firstChild.data.length;for(o=n.focusNode.parentNode.closest(".w-segment");o=o.previousSibling;)t+=o.firstChild.data.length;let i=n.anchorNode.parentNode.closest(".w-segment"),a=n.anchorOffset,s=n.focusNode.parentNode.closest(".w-segment"),c=n.focusOffset;return e>t&&([t,s,c,e,i,a]=[e,i,a,t,s,c]),{start:e,startNode:i,startNodeOffset:a,end:t,endNode:s,endNodeOffset:c,collapsed:n.isCollapsed}},Mt=e=>{let t=(e/l.total||0)*l.duration;return`${Math.floor(t/60).toFixed(0)}:${(Math.floor(t)%60).toFixed(0).padStart(2,0)}`},Wt=new IntersectionObserver(([e])=>{l.caretOffscreen=e.isIntersecting?0:e.intersectionRect.top<=e.rootBounds.top?1:e.intersectionRect.bottom>=e.rootBounds.bottom?-1:0},{root:document,threshold:1,rootMargin:"0px"});Wt.observe(ft);var Ut=new ResizeObserver(e=>{let t=e[0].contentRect.width;l.lineWidth=l.charWidth?Math.floor(t/l.charWidth):0});Ut.observe(T);async function ht(...e){let t=new URL(location);for(let n of e){let[o,...i]=n;i[0].file?t.searchParams.set(o,i[0].file.name):t.searchParams.has(o)?t.searchParams.set(o,`${t.searchParams.get(o)}..${i.join("-")}`):t.searchParams.append(o,i.join("-"))}l.loading="Calculating audio...";let r=await se(...e);return history.pushState(r,"",decodeURI(t)),l.loading=!1,T.textContent&&console.assert(r.segments.join("")===T.textContent,"Rendered waveform is different from UI"),le(r)}function se(...e){return new Promise(t=>{ct.postMessage({id:history.state?.id||0,ops:e}),ct.addEventListener("message",r=>{t(r.data)},{once:!0})})}function le({url:e,segments:t,duration:r}){l.total=t.reduce((o,i)=>o+=i.length,0),l.duration=r,l.segments=t;let n=k.currentTime;return k.src=e,new Promise((o,i)=>{k.addEventListener("error",i),k.addEventListener("canplay",a=>o(k.currentTime=n),{once:!0})})}async function It(e=new URL(location)){l.loading="Reconstructing audio...";let t=[];for(let[n,o]of e.searchParams)t.push(...o.split("..").map(i=>[n,...i.includes(":")?[i]:i.split("-")]));let r=await se(...t);history.replaceState(r,"",decodeURI(e)),le(r),l.loading=!1}async function Ft(){l.loading="Loading recent audio...";let e=await se(["load"]);le(e),l.loading=!1}Ft();
//# sourceMappingURL=wavearea.js.map
