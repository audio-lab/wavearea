<!-- Main waveedit demo. See use-case. -->
<!DOCTYPE html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Wavearea</title>

<link href="./main.css" rel="stylesheet"/>

<body>
  <div class="wavearea"
    :onmousedown.document..onmouseup.document="e=> (isMouseDown = true, e=> isMouseDown = false)"
    :onkeydown.document..onkeyup.document="e => (isKeyDown = true, e=> isKeyDown = false)"
    >
    <div class="w-container"
      :onkeydown.arrow="e=>requestAnimationFrame(handleCaret)"
      :onselectstart..onselectionchange.document.once="e => handleCaret"
      :onselectionchange.document.debounce-108="/*debounce prevents programmatic selectionchanges*/handleCaret">
      <!-- <file-attachment class="w-file" :if="!wavURL" directory :onfile-attachment-accepted="e=>console.log(e)">
        <input type="file" multiple />
      </file-attachment> -->
      <div class="w-waveform">
        <button class="w-play" :title="`${playing ? 'Pause' : 'Play'} ⌘-↵`"
          :hidden="loading"
          :onclick..onclick="play"
          :onkeydown.document.meta-enter="e=>this.click(e)"
          :style="{
            '--carety': caretLine,
            position: !caretOffscreen ? 'absolute' : 'fixed',
            ...(!caretOffscreen ? {} : caretOffscreen > 0 ? {top:0} : {bottom:0,top:'auto'})
          }">
          <span class="w-play-clickarea"></span>
          <svg :hidden="playing" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M8 5v14l11-7L8 5z"/></svg>
          <svg :hidden="!playing" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="#000000"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
        </button>
        <span class="w-caret-line" :style="{'--carety': caretLine}"></span>
        <div class="w-loader wavefont"
          :if="loading"
          :with="{id:null, str:''}"
          :="if (loading) id=setInterval(()=>str+='.', 50); else clearInterval(id), str = '';"
          :text="str"
        >...</div>
        <div contenteditable class="w-editable wavefont"
          :oninput="e=>(updateTimecodes(e),handleCaret(e))"
          :onbeforeinput="handleBeforeInput"
          :ondblclick.prevent
          :ondragenter..ondragleave:ondragenter..ondrop="e=>(this.classList.add('dragover'),e=>this.classList.remove('dragover'))"
          :ondrop.prevent="handleDrop"
          :style="{'--linew': lineWidth}"
          :="segments, requestAnimationFrame(updateTimecodes)"
        ><p class="w-segment" :each="segment, id1 in segments" :key="id1" :text="segment"></p></div>
      </div>
    </div>
  </div>

  <script type="importmap">
    {
      "decoder/mp3": "./dist/decoder/mp3.js",
      "decoder/ogg": "./dist/decoder/ogg.js"
    }
  </script>
  <script type="module" src="./dist/wavearea.js"></script>
</body>