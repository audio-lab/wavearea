<!-- Main waveedit demo. See use-case. -->
<!DOCTYPE html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AU</title>

<style>
@font-face {
	font-family: wavefont;
	font-display: block;
	src: url(./asset/wavefont.woff2) format('woff2');
}
.wavefont {
	--wght: 10;
	font-family: wavefont;
  letter-spacing: 1ch;
	font-variation-settings: 'wght' var(--wght), 'ROND' 30, 'ALGN' 0.5;
}
body {
  margin: 0;
}
.waveform {
  width: 100%;
  height: 100%;
  font-size: 100px;
}
.playback {
  position: fixed;
  bottom: 0
}
</style>

<body>
  <div class="waveedit">
    <textarea class="waveform wavefont" spellcheck="false" autofocus
      :onfocus-onblur="trackCaret" cols="500" :init="autosize(this)"
    >abcdef</textarea>

    <div class="playback">
      <button class="record">
        <span :if="recording" title="Stop">x</span>
        <span :else title="Start recording">*</span>
      </button>
      <button class="play">
        <span :if="playing" title="Play">></span>
        <span :else title="Pause">||</span>
      </button>
      <input class="volume" type="range" min="0" max="100" step="1" value="90" :value="volume" :oninput:onchange="e => volume.value = e.target.value" />
      <button class="download">_</button>
    </div>
  </div>

  <script type="importmap">
    {
      "imports": {
        "sprae": "/node_modules/sprae/sprae.min.js",
        "autosize": "/node_modules/@github/textarea-autosize/dist/index.js"
      }
    }
  </script>
  <script type="module">
    import sprae from 'sprae';
    import autosize from 'autosize';

    let state = sprae(document, {
      recording: false,
      playing: false,
      volume: 1,

      // current selection
      selection: [0,0],

      autosize,

      // reflect selection
      trackCaret(e) {
        const wavearea = e.target
        const track = () => console.log(state.selection = [wavearea.selectionStart, wavearea.selectionEnd])
        const evts = 'keypress mousedown touchstart input paste cut mousemove select selectstart change focus blur'.split(' ')
        evts.map(evt => el.addEventListener(track))
        return () => evts.map(evt => el.removeEventListener(track))
      }
    });
  </script>
</body>